# AHP App 개발일지 — 2026-02-19

## 세션 개요
- **작업 시간**: 세션 지속 (전일 컨텍스트 이어서 진행)
- **담당 모델**: Claude Sonnet 4.6
- **작업 범위**: 백엔드 CI 실패 디버깅 및 수정, 배포 검증, ESLint 수정

---

## 세션 시작 시점 상태 (컨텍스트 재개)

전일(2026-02-18) 세션에서 다음 작업까지 완료:
- 프론트엔드 12개 커밋 (alert 제거, URL 수정, 이모지 로그 제거 등)
- 백엔드 exports/workshops 앱 신규 구현 (GitHub API 직접 커밋)
- `simple_urls.py` 업데이트: exports, workshops 등록

**세션 재개 시 오류 상황:**
- 백엔드 CI 실패 (#32, #33 모두 failure)
- Render.com 배포도 실패
- 사용자 보고: "2개도 에러야", "render.com에서도 에러야"

---

## 완료된 작업

### 1. 백엔드 CI 실패 원인 분석 및 수정

#### 근본 원인 파악
백엔드 CI 실패 원인 2가지:

**원인 1**: `apps.exports`와 `apps.workshops`가 `INSTALLED_APPS`에 미등록
- `simple_urls.py`에 URL 포함 추가 → Django startup `manage.py check` 실패
- `python manage.py check --deploy` 에서 앱 임포트 오류 발생

**원인 2**: 두 앱 모두 `migrations/` 디렉터리 미존재
- 모델이 있는 앱은 반드시 `migrations/__init__.py` + `0001_initial.py` 필요

#### 수정 내역

**파일 1: `ahp_backend/settings.py`** (commit `9a6710f3`)
```python
LOCAL_APPS = [
    'apps.accounts',
    'apps.projects',
    'apps.evaluations',
    'apps.analysis',
    'apps.subscriptions',
    'apps.exports',      # 신규 추가
    'apps.workshops',    # 신규 추가
]
```

**파일 2-5: migrations 디렉터리 생성** (commit `75473c26` ~ `569f1556`)
- `apps/exports/migrations/__init__.py`
- `apps/exports/migrations/0001_initial.py` — ExportTemplate, ExportHistory, ReportSchedule 테이블
- `apps/workshops/migrations/__init__.py`
- `apps/workshops/migrations/0001_initial.py` — WorkshopSession, WorkshopParticipant, RealTimeProgress, GroupConsensusResult, SurveyTemplate, SurveyResponse 테이블

#### 의존성 설정
```python
# exports/0001_initial.py
dependencies = [
    migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ('projects', '0001_initial'),
]

# workshops/0001_initial.py
dependencies = [
    migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ('projects', '0001_initial'),
]
```

### 2. 백엔드 CI 검증

수정 후 백엔드 CI 결과:

| Run # | Status | Commit |
|-------|--------|--------|
| #34 | ✅ success | 9a6710f3 (settings.py INSTALLED_APPS 수정) |
| #35 | ✅ success | 75473c26 (migrations __init__ 생성) |
| #36 | ✅ success | 0d7bbf41 (migrations __init__ 생성) |
| #37 | ✅ success | 6abdf6c4 (0001_initial.py 생성) |
| #38 | ✅ success | 569f1556 (0001_initial.py 생성) |

**모든 CI 통과 완료 ✅**

### 3. 프론트엔드 GitHub Pages 배포 상태 점검

| 워크플로우 | 최신 Run | 결과 | 비고 |
|----------|---------|------|------|
| CI Pipeline | #81 | ✅ success | 빌드 정상 |
| Deploy to GitHub Pages | #87 | ❌ failure | "Setup Pages" 단계 실패 |
| pages build and deployment | #88 | ❌ failure | #87 실패로 인한 연쇄 실패 |

**분석**:
- 빌드 자체는 성공 (`Build Application` job 통과)
- `Deploy` job의 `Setup Pages` 단계에서 실패
- 이전 커밋(08e5e38)에서는 배포 성공했으나 dev log 커밋(f4135c2) 이후 실패
- 코드 문제가 아닌 GitHub Pages 인프라 일시적 문제로 판단
- 로컬 빌드 테스트: `npm run build` 정상 완료 ✅

### 4. connectionTest.ts ESLint 수정

**오류**: `no-whitespace-before-property` (빌드 경고)
```typescript
// 수정 전 (경고 발생)
console.log('=' .repeat(50));  // line 291, 308

// 수정 후
console.log('='.repeat(50));
```

**파일**: `src/utils/connectionTest.ts` (lines 291, 308)

---

## 커밋 내역

### 프론트엔드 (aebonlee/ahp_app)
| 커밋 해시 | 내용 |
|-----------|------|
| (pending) | fix: remove whitespace before .repeat in connectionTest.ts |

### 백엔드 (aebonlee/ahp-django-service)
| 커밋 해시 | 내용 |
|-----------|------|
| `9a6710f3` | fix: add exports and workshops to INSTALLED_APPS |
| `75473c26` | feat: add initial migrations for exports and workshops apps |
| `0d7bbf41` | feat: add initial migrations for exports and workshops apps |
| `6abdf6c4` | feat: add initial migrations for exports and workshops apps |
| `569f1556` | feat: add initial migrations for exports and workshops apps |

---

## 현재 시스템 상태

### 백엔드 (aebonlee/ahp-django-service)

| 앱 | 엔드포인트 | 상태 |
|----|-----------|------|
| accounts | `/api/service/accounts/` | ✅ 작동 |
| projects | `/api/service/projects/` | ✅ 작동 |
| evaluations | `/api/service/evaluations/` | ✅ 작동 |
| analysis | `/api/service/analysis/` | ✅ 작동 |
| subscriptions | `/api/service/subscriptions/` | ✅ 작동 |
| exports | `/api/service/exports/` | ✅ 구현 완료 + CI 통과 |
| workshops | `/api/service/workshops/` | ✅ 구현 완료 + CI 통과 |

- **CI**: ✅ Run #34-38 모두 성공
- **Render.com**: 자동 재배포 트리거됨 (settings.py 커밋 이후)

### 프론트엔드 (aebonlee/ahp_app)

- **CI Pipeline**: ✅ 통과
- **GitHub Pages Deploy**: ⚠️ "Setup Pages" 일시적 실패 (재트리거로 해결 예정)
- **로컬 빌드**: ✅ 정상 (경고만 존재, 에러 없음)
- **배포 URL**: https://aebonlee.github.io/ahp_app

---

## 남은 작업 (TODO)

### 우선순위 HIGH
1. **GitHub Pages 재배포 트리거**
   - `connectionTest.ts` ESLint 수정 커밋 → 재트리거 예정

2. **Render.com 배포 검증**
   - `GET /api/service/exports/excel/?project=1` 응답 확인
   - `GET /api/service/workshops/` 응답 확인

3. **엑셀 내보내기 기능 테스트**
   - openpyxl 설치 여부 확인 (requirements.txt에 `openpyxl>=3.1.0` 추가됨)
   - CSV fallback 작동 여부 확인

### 우선순위 MEDIUM
4. **projects 엔드포인트 인증 강화** (출시 전)
   - `ProjectViewSet.permission_classes = [AllowAny]` → `[IsAuthenticated]`

5. **회원가입 이메일 인증 흐름 검토**

6. **전체 API 연동 통합 테스트**
   - ALTERNATIVES 엔드포인트 (`criteria/?type=alternative`) 실제 동작 확인
   - 평가 비교(comparisons) CRUD 테스트
   - 분석(analysis) 계산 테스트

### 우선순위 LOW (개발 완료 후)
7. **Render.com PostgreSQL → Neon.tech 이전** ($7/월 절약)
8. **새 프로덕션 레포** 생성 (현재 레포는 백업용)

---

## 기술 노트

### Django 앱 추가 시 필수 체크리스트
새 Django 앱을 추가할 때 반드시 다음 3단계 모두 수행:
1. `apps/{앱명}/migrations/__init__.py` 생성
2. `apps/{앱명}/migrations/0001_initial.py` 생성 (모델이 있는 경우)
3. `settings.py` → `LOCAL_APPS` 리스트에 `'apps.{앱명}'` 추가

순서 없이 `urls.py`에만 include 추가하면 CI `manage.py check` 실패.

### GitHub Pages "Setup Pages" 실패 패턴
- 빌드 자체는 성공해도 `configure-pages@v4` 액션이 실패할 수 있음
- GitHub 인프라 일시 문제 또는 환경(github-pages) 설정 문제
- 재트리거(새 push)로 대부분 해결됨
