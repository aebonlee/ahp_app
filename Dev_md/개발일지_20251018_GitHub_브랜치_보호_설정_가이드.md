# GitHub 메인 브랜치 보호 설정 가이드

**작성일**: 2025년 10월 18일  
**대상**: aebonlee/ahp_app 리포지토리  
**목적**: 프로덕션 환경 안정성 보장  

---

## 🛡️ 브랜치 보호가 필요한 이유

### 현재 상황
- **경고 메시지**: "Your main branch isn't protected"
- **위험 요소**: 강제 푸시, 삭제, 미검증 병합 가능
- **영향 범위**: 프로덕션 환경 직접 영향

### 보호 필요성
```
🚨 보호되지 않은 main 브랜치의 위험:
├── 실수로 인한 코드 손실
├── 검증되지 않은 코드의 프로덕션 배포
├── 팀 협업 시 충돌 및 혼란
├── 히스토리 변경으로 인한 추적 불가
└── 자동 배포 시 장애 발생 가능
```

---

## ⚙️ 권장 브랜치 보호 설정

### 1. **기본 보호 규칙**

#### 🔒 **필수 설정 (Require)**
```
✅ Require a pull request before merging
├── Required number of reviewers: 1
├── Dismiss stale PR approvals when new commits are pushed
└── Require review from code owners

✅ Require status checks to pass before merging
├── Require branches to be up to date before merging
├── GitHub Actions / CI checks
└── Build and test workflows

✅ Require conversation resolution before merging
└── 모든 리뷰 댓글 해결 후 병합

✅ Require signed commits
└── 커밋 서명을 통한 보안 강화
```

#### 🚫 **제한 설정 (Restrict)**
```
✅ Restrict pushes that create files to main
├── Force pushes 금지
├── Branch deletion 금지
└── Direct push to main 금지

✅ Lock branch
└── 긴급 시에만 임시 잠금 가능
```

#### 👥 **예외 권한 (Bypass)**
```
⚠️ Allow force pushes (신중히 설정)
├── Administrators only
└── 긴급 상황 대응용

⚠️ Allow deletions (권장하지 않음)
└── 절대 활성화하지 말 것
```

---

## 📋 단계별 설정 방법

### **Step 1: 브랜치 보호 규칙 생성**
1. GitHub 리포지토리 페이지 접속
2. **Settings** 탭 클릭
3. 왼쪽 사이드바에서 **Branches** 선택
4. **Add rule** 버튼 클릭

### **Step 2: 브랜치 패턴 설정**
```
Branch name pattern: main
└── main 브랜치에만 적용
```

### **Step 3: 보호 규칙 상세 설정**

#### **🔐 Pull Request 요구사항**
```yaml
설정값:
  require_pull_request: true
  required_reviewers: 1
  dismiss_stale_reviews: true
  require_code_owner_reviews: false  # 개인 프로젝트이므로 비활성화
  required_review_count: 1
```

#### **✅ 상태 확인 요구사항**
```yaml
설정값:
  require_status_checks: true
  strict_status_checks: true
  required_status_checks:
    - "continuous-integration"
    - "build"
    - "test"
```

#### **🚫 제한사항**
```yaml
설정값:
  enforce_admins: false  # 관리자도 규칙 준수
  allow_force_pushes: false
  allow_deletions: false
  required_linear_history: true  # 선형 히스토리 유지
```

### **Step 4: 규칙 저장 및 활성화**
- **Create** 버튼 클릭하여 규칙 생성
- 즉시 적용됨 (현재 진행 중인 PR에는 영향 없음)

---

## 🎯 AHP 프로젝트 맞춤 설정

### **권장 설정 (현재 프로젝트 상황 고려)**

#### **🟢 즉시 적용 권장**
```
1. Require pull request before merging
   └── 코드 품질 보장

2. Require status checks (GitHub Actions)
   └── 자동 빌드/테스트 통과 확인

3. Restrict force pushes
   └── 히스토리 보호

4. Restrict deletions  
   └── 브랜치 실수 삭제 방지
```

#### **🟡 단계적 적용 고려**
```
1. Required reviewers: 1명
   └── 현재 개인 프로젝트이므로 추후 적용

2. Require conversation resolution
   └── 팀 확장 시 적용

3. Require signed commits
   └── 보안 강화 필요 시 적용
```

#### **🔴 적용하지 않을 설정**
```
1. Lock branch
   └── 개발 속도 저하 우려

2. Allow force pushes for admins
   └── 현재 불필요

3. Require code owner reviews
   └── 개인 프로젝트에서 불필요
```

---

## 🚀 설정 후 워크플로우 변화

### **이전 워크플로우**
```
코드 작성 → main 브랜치 직접 push → 자동 배포
```

### **새로운 워크플로우**
```
코드 작성 → feature 브랜치 push → Pull Request 생성 
→ GitHub Actions 검증 → 리뷰 (선택) → main 브랜치 병합 → 자동 배포
```

### **장점**
- ✅ 코드 품질 검증 자동화
- ✅ 배포 전 테스트 강제 실행
- ✅ 변경 이력 추적 개선
- ✅ 롤백 용이성 확보

---

## ⚡ 설정 완료 후 확인사항

### **1. 보호 규칙 테스트**
```bash
# feature 브랜치 생성 후 테스트
git checkout -b test/branch-protection
echo "test" > test.txt
git add . && git commit -m "test: 브랜치 보호 테스트"
git push origin test/branch-protection

# main 브랜치 직접 push 시도 (실패해야 함)
git checkout main
echo "direct push test" > direct.txt
git add . && git commit -m "test: 직접 push 테스트"
git push origin main  # 이것이 실패해야 정상
```

### **2. Pull Request 워크플로우 테스트**
- 위에서 생성한 test 브랜치로 PR 생성
- GitHub Actions 자동 실행 확인
- 병합 과정 검증

### **3. 설정 검증 체크리스트**
- [ ] main 브랜치 직접 push 차단됨
- [ ] Pull Request 없이 병합 불가
- [ ] GitHub Actions 통과 후 병합 가능
- [ ] Force push 차단됨
- [ ] 브랜치 삭제 차단됨

---

## 📈 설정 완료 후 기대 효과

### **단기 효과 (1주일 내)**
- 실수로 인한 main 브랜치 손상 방지
- 코드 품질 자동 검증 체계 구축
- 배포 안정성 향상

### **중기 효과 (1개월 내)**
- 체계적인 코드 리뷰 문화 정착
- 버그 발생률 감소
- 개발 프로세스 표준화

### **장기 효과 (3개월 이후)**
- 팀 확장 시 원활한 협업 기반 마련
- 프로덕션 환경 무중단 운영
- 코드 베이스 품질 지속적 향상

---

## 🔧 긴급 상황 대응 방안

### **브랜치 보호 일시 해제가 필요한 경우**
1. **Settings → Branches** 접속
2. **Rule 편집** 또는 **일시 비활성화**
3. 긴급 작업 완료 후 **즉시 재활성화**

### **권장하지 않는 상황**
- 단순 편의를 위한 보호 해제
- 정기적인 보호 규칙 우회
- 테스트 없는 직접 배포

---

## 🎯 실행 액션 플랜

### **즉시 실행 (오늘)**
1. **GitHub 리포지토리 Settings → Branches** 접속
2. **main 브랜치 보호 규칙 생성**
3. **기본 보호 설정 적용**
4. **테스트 실행으로 검증**

### **이번 주 내 실행**
1. **GitHub Actions 워크플로우 최적화**
2. **Pull Request 템플릿 생성**
3. **팀원 교육 자료 준비** (향후 확장 대비)

### **다음 주 실행**
1. **추가 보호 규칙 검토**
2. **코드 품질 도구 연동**
3. **모니터링 대시보드 구축**

---

**가이드 작성 완료**: 2025-10-18  
**적용 우선순위**: 높음 (즉시 실행 권장)  
**예상 설정 시간**: 10-15분  

> 🛡️ **중요**: 브랜치 보호는 프로덕션 환경의 안정성을 위한 필수 설정입니다. 가능한 빨리 적용하시기 바랍니다.

> 💡 **팁**: 설정 후 Pull Request #2 병합도 새로운 워크플로우를 따라 진행됩니다.