<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="/ahp_app/public/styles/layout.css">
    <style>
        /* ë‹¤í¬ ëª¨ë“œ ì¶”ê°€ */
        [data-theme="dark"] {
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-subtle: #0f172a;
            --bg-elevated: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --border-light: #374151;
            --border-medium: #4b5563;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 2rem;
            background-color: var(--bg-secondary);
            min-height: calc(100vh - var(--header-height));
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .admin-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .admin-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .admin-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-card-icon {
            font-size: 1.5rem;
        }

        .admin-card-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
        }

        .admin-card-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .change-positive {
            color: #10b981;
        }

        .change-negative {
            color: #ef4444;
        }

        .management-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .management-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .management-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .management-card:hover {
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .management-card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .management-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .management-card-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .recent-activity {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .activity-icon.user { background: #dbeafe; color: #2563eb; }
        .activity-icon.project { background: #dcfce7; color: #16a34a; }
        .activity-icon.system { background: #fef3c7; color: #d97706; }
        .activity-icon.alert { background: #fee2e2; color: #dc2626; }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .theme-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-right: 1rem;
        }

        .theme-toggle {
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-light);
            background: var(--bg-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            background: var(--accent-light);
            border-color: var(--accent-primary);
        }

        .quick-actions {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--accent-primary);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(200, 169, 104, 0.4);
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .management-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                bottom: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="header">
        <div class="header-left">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <span id="toggle-icon">â—€</span>
            </button>
            <div class="header-logo">
                <span class="logo-icon">A</span>
                <span class="logo-text">AHP System</span>
                <span class="header-subtitle">ìŠˆí¼ ê´€ë¦¬ì</span>
            </div>
        </div>
        
        <div class="header-center">
            <nav class="header-nav">
                <a href="/ahp_app/super-admin-dashboard.html" class="nav-item active" data-page="admin">ìŠˆí¼ ê´€ë¦¬ì</a>
                <a href="/ahp_app/personal-service-enhanced.html" class="nav-item" data-page="personal">ê°œì¸ ì„œë¹„ìŠ¤</a>
                <a href="/ahp_app/public/system-monitoring.html" class="nav-item" data-page="system">ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</a>
                <a href="/ahp_app/public/analytics.html" class="nav-item" data-page="analytics">ë¶„ì„</a>
            </nav>
        </div>
        
        <div class="header-right">
            <div class="theme-controls">
                <button class="theme-toggle" onclick="toggleColorTheme()" title="ì»¬ëŸ¬í…Œë§ˆ ë³€ê²½">ğŸ¨</button>
                <button class="theme-toggle" onclick="toggleDarkMode()" title="ë‹¤í¬ëª¨ë“œ ì „í™˜">ğŸŒ“</button>
            </div>
            <div class="header-notifications">
                <button class="notification-btn">
                    <span>ğŸ””</span>
                    <span class="notification-badge">3</span>
                </button>
            </div>
            <div class="header-user">
                <div class="user-avatar">ğŸ‘¤</div>
                <div class="user-info">
                    <div class="user-name">ìŠˆí¼ ê´€ë¦¬ì</div>
                    <div class="user-role">System Admin</div>
                </div>
                <button class="user-menu-btn" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </header>

    <!-- ì‚¬ì´ë“œë°” -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-content">
            <!-- ê´€ë¦¬ì ë©”ë‰´ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ì‹œìŠ¤í…œ ê´€ë¦¬</div>
                <a href="/ahp_app/public/user-management.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ‘¥</span>
                    <span class="sidebar-text">ì‚¬ìš©ì ê´€ë¦¬</span>
                </a>
                <a href="/ahp_app/public/project-overview.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ“Š</span>
                    <span class="sidebar-text">í”„ë¡œì íŠ¸ í˜„í™©</span>
                </a>
                <a href="/ahp_app/public/admin/system-settings.html" class="sidebar-item">
                    <span class="sidebar-icon">âš™ï¸</span>
                    <span class="sidebar-text">ì‹œìŠ¤í…œ ì„¤ì •</span>
                </a>
                <a href="/ahp_app/public/admin/audit-log.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ“‹</span>
                    <span class="sidebar-text">ê°ì‚¬ ë¡œê·¸</span>
                </a>
            </div>

            <!-- ë°ì´í„° ê´€ë¦¬ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ë°ì´í„° ê´€ë¦¬</div>
                <a href="/ahp_app/public/admin/backup-restore.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ’¾</span>
                    <span class="sidebar-text">ë°±ì—… ë° ë³µì›</span>
                </a>
                <a href="/ahp_app/public/admin/database-management.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ—„ï¸</span>
                    <span class="sidebar-text">ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬</span>
                </a>
                <a href="/ahp_app/public/admin/data-migration.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ“¤</span>
                    <span class="sidebar-text">ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜</span>
                </a>
            </div>

            <!-- ë³´ì•ˆ ê´€ë¦¬ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ë³´ì•ˆ ê´€ë¦¬</div>
                <a href="/ahp_app/public/admin/security-settings.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ”’</span>
                    <span class="sidebar-text">ë³´ì•ˆ ì„¤ì •</span>
                </a>
                <a href="/ahp_app/public/admin/access-control.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ›¡ï¸</span>
                    <span class="sidebar-text">ì ‘ê·¼ ì œì–´</span>
                </a>
                <a href="/ahp_app/public/admin/security-log.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸš¨</span>
                    <span class="sidebar-text">ë³´ì•ˆ ë¡œê·¸</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <!-- ëŒ€ì‹œë³´ë“œ í†µê³„ -->
        <div class="dashboard-grid">
            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">ğŸ‘¥</span>
                        ì´ ì‚¬ìš©ì
                    </div>
                </div>
                <div class="admin-card-value">1,247</div>
                <div class="admin-card-change change-positive">
                    â†‘ +12% (ì´ë²ˆ ë‹¬)
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">ğŸ“Š</span>
                        í™œì„± í”„ë¡œì íŠ¸
                    </div>
                </div>
                <div class="admin-card-value">89</div>
                <div class="admin-card-change change-positive">
                    â†‘ +8% (ì´ë²ˆ ì£¼)
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">âš¡</span>
                        ì‹œìŠ¤í…œ ì„±ëŠ¥
                    </div>
                </div>
                <div class="admin-card-value">98.7%</div>
                <div class="admin-card-change change-positive">
                    â†‘ ì•ˆì •ì 
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">ğŸ’¾</span>
                        ì €ì¥ì†Œ ì‚¬ìš©ë¥ 
                    </div>
                </div>
                <div class="admin-card-value">67.3%</div>
                <div class="admin-card-change change-negative">
                    â†‘ +5% (ì´ë²ˆ ë‹¬)
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ ì„¹ì…˜ -->
        <div class="management-section">
            <div class="section-header">
                <h2 class="section-title">í•µì‹¬ ê´€ë¦¬ ê¸°ëŠ¥</h2>
            </div>
            <div class="management-grid">
                <div class="management-card" onclick="window.location.href='/ahp_app/public/user-management.html'">
                    <div class="management-card-icon">ğŸ‘¥</div>
                    <div class="management-card-title">ì‚¬ìš©ì ê´€ë¦¬</div>
                    <div class="management-card-desc">
                        ì‚¬ìš©ì ê³„ì •, ê¶Œí•œ, í”„ë¡œí•„ ê´€ë¦¬ ë° ì ‘ê·¼ ì œì–´
                    </div>
                </div>

                <div class="management-card" onclick="window.location.href='/ahp_app/public/project-overview.html'">
                    <div class="management-card-icon">ğŸ“Š</div>
                    <div class="management-card-title">í”„ë¡œì íŠ¸ ê´€ë¦¬</div>
                    <div class="management-card-desc">
                        ëª¨ë“  AHP í”„ë¡œì íŠ¸ í˜„í™© ëª¨ë‹ˆí„°ë§ ë° ê´€ë¦¬
                    </div>
                </div>

                <div class="management-card" onclick="window.location.href='/ahp_app/public/system-monitoring.html'">
                    <div class="management-card-icon">ğŸ“ˆ</div>
                    <div class="management-card-title">ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</div>
                    <div class="management-card-desc">
                        ì„œë²„ ì„±ëŠ¥, ë°ì´í„°ë² ì´ìŠ¤, API ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
                    </div>
                </div>

                <div class="management-card" onclick="window.location.href='/ahp_app/public/backup-restore.html'">
                    <div class="management-card-icon">ğŸ’¾</div>
                    <div class="management-card-title">ë°±ì—… ê´€ë¦¬</div>
                    <div class="management-card-desc">
                        ë°ì´í„° ë°±ì—…, ë³µì› ë° ì¬í•´ ë³µêµ¬ ê´€ë¦¬
                    </div>
                </div>

                <div class="management-card" onclick="window.location.href='/ahp_app/public/security-settings.html'">
                    <div class="management-card-icon">ğŸ”’</div>
                    <div class="management-card-title">ë³´ì•ˆ ì„¤ì •</div>
                    <div class="management-card-desc">
                        ì‹œìŠ¤í…œ ë³´ì•ˆ ì •ì±…, ì¸ì¦ ë° ì•”í˜¸í™” ì„¤ì •
                    </div>
                </div>

                <div class="management-card" onclick="window.location.href='/ahp_app/public/analytics.html'">
                    <div class="management-card-icon">ğŸ“‹</div>
                    <div class="management-card-title">ë¶„ì„ ë¦¬í¬íŠ¸</div>
                    <div class="management-card-desc">
                        ì‚¬ìš©ì í™œë™, ì‹œìŠ¤í…œ ì‚¬ìš©ë¥  ë° ì„±ëŠ¥ ë¶„ì„
                    </div>
                </div>
            </div>
        </div>

        <!-- ìµœê·¼ í™œë™ -->
        <div class="recent-activity">
            <div class="section-header">
                <h2 class="section-title">ìµœê·¼ ì‹œìŠ¤í…œ í™œë™</h2>
            </div>
            <ul class="activity-list">
                <li class="activity-item">
                    <div class="activity-icon user">ğŸ‘¤</div>
                    <div class="activity-content">
                        <div class="activity-title">ìƒˆ ì‚¬ìš©ì ë“±ë¡: ê¹€ì² ìˆ˜ (kim.cs@company.com)</div>
                        <div class="activity-time">5ë¶„ ì „</div>
                    </div>
                </li>
                <li class="activity-item">
                    <div class="activity-icon system">âš™ï¸</div>
                    <div class="activity-content">
                        <div class="activity-title">ì‹œìŠ¤í…œ ë°±ì—… ì™„ë£Œ (DB: 2.3GB, Files: 856MB)</div>
                        <div class="activity-time">1ì‹œê°„ ì „</div>
                    </div>
                </li>
                <li class="activity-item">
                    <div class="activity-icon project">ğŸ“Š</div>
                    <div class="activity-content">
                        <div class="activity-title">ëŒ€ê·œëª¨ AHP í”„ë¡œì íŠ¸ ìƒì„±: "ì œí’ˆ ì„ íƒ ë¶„ì„" (15ê°œ ê¸°ì¤€, 8ê°œ ëŒ€ì•ˆ)</div>
                        <div class="activity-time">2ì‹œê°„ ì „</div>
                    </div>
                </li>
                <li class="activity-item">
                    <div class="activity-icon alert">ğŸš¨</div>
                    <div class="activity-content">
                        <div class="activity-title">CPU ì‚¬ìš©ë¥  ì„ê³„ì¹˜ ì´ˆê³¼ ê²½ê³  (85% â†’ ì •ìƒ ë³µêµ¬)</div>
                        <div class="activity-time">3ì‹œê°„ ì „</div>
                    </div>
                </li>
                <li class="activity-item">
                    <div class="activity-icon user">ğŸ‘¤</div>
                    <div class="activity-content">
                        <div class="activity-title">ê´€ë¦¬ì ê¶Œí•œ ë³€ê²½: ì´ì˜í¬ â†’ í”„ë¡œì íŠ¸ ë§¤ë‹ˆì €</div>
                        <div class="activity-time">4ì‹œê°„ ì „</div>
                    </div>
                </li>
            </ul>
        </div>
    </main>

    <!-- ë¹ ë¥¸ ì‘ì—… ë²„íŠ¼ -->
    <div class="quick-actions">
        <button class="fab" title="ìƒˆ ì‚¬ìš©ì ì¶”ê°€" onclick="window.location.href='/ahp_app/public/user-management.html'">
            ğŸ‘¤
        </button>
        <button class="fab" title="ì‹œìŠ¤í…œ ì„¤ì •" onclick="window.location.href='/ahp_app/public/system-settings.html'">
            âš™ï¸
        </button>
    </div>

    <script src="/ahp_app/public/scripts/layout.js"></script>
    <script src="/ahp_app/public/scripts/api-service.js"></script>
    <script>
        // í˜ì´ì§€ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
            const loginResult = await checkLoginStatus();
            if (!loginResult) {
                return;
            }
            
            // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
            const adminResult = await checkAdminPermission();
            if (!adminResult) {
                alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '/ahp_app/public/personal-service-enhanced.html';
                return;
            }
            
            // í…Œë§ˆ ì ìš©
            loadSavedTheme();
            
            // ë‹¤í¬ëª¨ë“œ ì„¤ì • ë³µì›
            try {
                const result = await window.ahpApi.getUserSettings();
                if (result.success && result.data.theme) {
                    document.documentElement.setAttribute('data-theme', result.data.theme);
                }
            } catch (error) {
                console.log('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ ì„¤ì • ì‚¬ìš©');
            }
            
            initializePage({
                menuId: 'admin-dashboard',
                pageId: 'admin',
                title: 'ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ'
            });
            
            // Django API ì—°ë™ ì´ˆê¸°í™”
            initializeDjangoAPI();
            
            console.log('âœ… ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì™„ë£Œ');
        });

        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
        async function checkAdminPermission() {
            try {
                const result = await window.ahpApi.getCurrentUser();
                return result.success && result.user.role === 'admin';
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        async function checkLoginStatus() {
            try {
                const result = await window.ahpApi.getCurrentUser();
                if (!result.success) {
                    window.location.href = '/ahp_app/public/login.html';
                    return false;
                }
                
                const user = result.user;
                const userNameElement = document.querySelector('.header-user .user-name');
                if (userNameElement && user.name) {
                    userNameElement.textContent = user.name;
                }
                
                return true;
            } catch (error) {
                console.error('ì‚¬ìš©ì ì¸ì¦ í™•ì¸ ì˜¤ë¥˜:', error);
                window.location.href = '/ahp_app/public/login.html';
                return false;
            }
        }

        // ì‚¬ì´ë“œë°” í† ê¸€
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('toggle-icon');
            
            sidebar.classList.toggle('collapsed');
            toggleIcon.textContent = sidebar.classList.contains('collapsed') ? 'â–¶' : 'â—€';
        }

        // ì»¬ëŸ¬ í…Œë§ˆ ë³€ê²½
        function toggleColorTheme() {
            const themes = [
                { name: 'default', primary: '#C8A968', secondary: '#A98C4B', light: '#E5D5AA', hover: '#B59A4D' },
                { name: 'blue', primary: '#3B82F6', secondary: '#2563EB', light: '#DBEAFE', hover: '#1D4ED8' },
                { name: 'green', primary: '#10B981', secondary: '#059669', light: '#D1FAE5', hover: '#047857' },
                { name: 'purple', primary: '#8B5CF6', secondary: '#7C3AED', light: '#EDE9FE', hover: '#6D28D9' },
                { name: 'rose', primary: '#F43F5E', secondary: '#E11D48', light: '#FFE4E6', hover: '#BE123C' }
            ];
            
            const currentTheme = localStorage.getItem('colorTheme') || 'default';
            const currentIndex = themes.findIndex(t => t.name === currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            const nextTheme = themes[nextIndex];
            
            // CSS ë³€ìˆ˜ ì—…ë°ì´íŠ¸
            const root = document.documentElement;
            root.style.setProperty('--accent-primary', nextTheme.primary);
            root.style.setProperty('--accent-secondary', nextTheme.secondary);
            root.style.setProperty('--accent-light', nextTheme.light);
            root.style.setProperty('--accent-hover', nextTheme.hover);
            
            // í…Œë§ˆ ì €ì¥
            localStorage.setItem('colorTheme', nextTheme.name);
            
            console.log(`ì»¬ëŸ¬ í…Œë§ˆ ë³€ê²½: ${nextTheme.name}`);
        }

        // ì €ì¥ëœ í…Œë§ˆ ì ìš©
        function loadSavedTheme() {
            const themes = [
                { name: 'default', primary: '#C8A968', secondary: '#A98C4B', light: '#E5D5AA', hover: '#B59A4D' },
                { name: 'blue', primary: '#3B82F6', secondary: '#2563EB', light: '#DBEAFE', hover: '#1D4ED8' },
                { name: 'green', primary: '#10B981', secondary: '#059669', light: '#D1FAE5', hover: '#047857' },
                { name: 'purple', primary: '#8B5CF6', secondary: '#7C3AED', light: '#EDE9FE', hover: '#6D28D9' },
                { name: 'rose', primary: '#F43F5E', secondary: '#E11D48', light: '#FFE4E6', hover: '#BE123C' }
            ];
            
            const savedTheme = localStorage.getItem('colorTheme') || 'default';
            const theme = themes.find(t => t.name === savedTheme);
            
            if (theme) {
                const root = document.documentElement;
                root.style.setProperty('--accent-primary', theme.primary);
                root.style.setProperty('--accent-secondary', theme.secondary);
                root.style.setProperty('--accent-light', theme.light);
                root.style.setProperty('--accent-hover', theme.hover);
            }
        }

        // ë‹¤í¬ëª¨ë“œ í† ê¸€
        async function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            
            // ì„œë²„ì— ì‚¬ìš©ì ì„¤ì • ì €ì¥
            try {
                const settings = { theme: newTheme };
                await window.ahpApi.saveUserSettings(settings);
                console.log(`ë‹¤í¬ëª¨ë“œ ë³€ê²½: ${newTheme}`);
            } catch (error) {
                console.error('í…Œë§ˆ ì„¤ì • ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        // API ê¸°ë³¸ ì„¤ì •
        const API_BASE_URL = 'https://ahp-django-backend.onrender.com';
        
        // Django API ì´ˆê¸°í™”
        async function initializeDjangoAPI() {
            const loginMethod = localStorage.getItem('login_method');
            
            if (loginMethod === 'django') {
                try {
                    // ë°±ì—”ë“œ ìƒíƒœ í™•ì¸
                    const healthResponse = await fetch(`${API_BASE_URL}/api/health/`);
                    if (healthResponse.ok) {
                        const healthData = await healthResponse.json();
                        console.log('âœ… Django ë°±ì—”ë“œ ì •ìƒ ì—°ê²°');
                        console.log('ğŸ“Š PostgreSQL ì—°ê²° ìƒíƒœ:', healthData.database?.status);
                        
                        // ê´€ë¦¬ì í†µê³„ ë°ì´í„° ë¡œë“œ
                        await loadAdminStatistics();
                        
                        // ì‹œìŠ¤í…œ í™œë™ ë¡œê·¸ ë¡œë“œ
                        await loadSystemActivities();
                        
                    }
                } catch (error) {
                    console.error('âŒ Django API ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                }
            } else {
                console.log('ğŸ“ ë°ëª¨ ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘');
            }
        }
        
        // ê´€ë¦¬ì í†µê³„ ë°ì´í„° ë¡œë“œ
        async function loadAdminStatistics() {
            try {
                const token = localStorage.getItem('ahp_token');
                const headers = {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                };
                
                // ì „ì²´ ì‚¬ìš©ì ìˆ˜ ì¡°íšŒ (ì˜ˆì‹œ)
                const usersResponse = await fetch(`${API_BASE_URL}/api/admin/users/count/`, {
                    headers
                });
                
                // ì „ì²´ í”„ë¡œì íŠ¸ ìˆ˜ ì¡°íšŒ
                const projectsResponse = await fetch(`${API_BASE_URL}/api/service/projects/`, {
                    headers
                });
                
                if (usersResponse.ok && projectsResponse.ok) {
                    const userData = await usersResponse.json();
                    const projectData = await projectsResponse.json();
                    
                    // UI ì—…ë°ì´íŠ¸
                    updateAdminStatistics({
                        totalUsers: userData.count || 0,
                        activeProjects: projectData.length || 0
                    });
                    
                    console.log('ğŸ“Š Django ê´€ë¦¬ì í†µê³„ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                }
            } catch (error) {
                console.log('âš ï¸ ê´€ë¦¬ì í†µê³„ ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©:', error);
            }
        }
        
        // ì‹œìŠ¤í…œ í™œë™ ë¡œê·¸ ë¡œë“œ
        async function loadSystemActivities() {
            try {
                const token = localStorage.getItem('ahp_token');
                const response = await fetch(`${API_BASE_URL}/api/admin/activities/`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const activities = await response.json();
                    updateActivityLog(activities);
                    console.log('ğŸ“‹ ì‹œìŠ¤í…œ í™œë™ ë¡œê·¸ ë¡œë“œ ì™„ë£Œ');
                }
            } catch (error) {
                console.log('âš ï¸ í™œë™ ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©:', error);
            }
        }
        
        // ê´€ë¦¬ì í†µê³„ UI ì—…ë°ì´íŠ¸
        function updateAdminStatistics(stats) {
            const userCountElement = document.querySelector('.admin-card:first-child .admin-card-value');
            const projectCountElement = document.querySelector('.admin-card:nth-child(2) .admin-card-value');
            
            if (userCountElement && stats.totalUsers > 0) {
                userCountElement.textContent = stats.totalUsers.toLocaleString();
            }
            
            if (projectCountElement && stats.activeProjects > 0) {
                projectCountElement.textContent = stats.activeProjects.toString();
            }
        }
        
        // í™œë™ ë¡œê·¸ UI ì—…ë°ì´íŠ¸
        function updateActivityLog(activities) {
            const activityList = document.querySelector('.activity-list');
            if (!activityList || !activities || activities.length === 0) return;
            
            // ì‹¤ì œ Django ë°ì´í„°ë¡œ í™œë™ ë¡œê·¸ ì—…ë°ì´íŠ¸
            activityList.innerHTML = '';
            
            activities.slice(0, 5).forEach(activity => {
                const activityItem = document.createElement('li');
                activityItem.className = 'activity-item';
                activityItem.innerHTML = `
                    <div class="activity-icon ${activity.type || 'system'}">
                        ${getActivityIcon(activity.type)}
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.description || activity.message}</div>
                        <div class="activity-time">${formatActivityTime(activity.timestamp || activity.created_at)}</div>
                    </div>
                `;
                activityList.appendChild(activityItem);
            });
        }
        
        // í™œë™ íƒ€ì…ë³„ ì•„ì´ì½˜
        function getActivityIcon(type) {
            const icons = {
                'user': 'ğŸ‘¤',
                'project': 'ğŸ“Š', 
                'system': 'âš™ï¸',
                'alert': 'ğŸš¨'
            };
            return icons[type] || 'ğŸ“‹';
        }
        
        // ì‹œê°„ í¬ë§·íŒ…
        function formatActivityTime(timestamp) {
            if (!timestamp) return 'ë°©ê¸ˆ ì „';
            
            const now = new Date();
            const activityTime = new Date(timestamp);
            const diffMs = now - activityTime;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            
            if (diffMins < 60) {
                return `${diffMins}ë¶„ ì „`;
            } else if (diffHours < 24) {
                return `${diffHours}ì‹œê°„ ì „`;
            } else {
                return activityTime.toLocaleDateString('ko-KR');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        async function handleLogout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    await window.ahpApi.logout();
                    window.location.href = '/ahp_app/public/login.html?message=logout';
                } catch (error) {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                    window.location.href = '/ahp_app/public/login.html?message=logout';
                }
            }
        }
    </script>
</body>
</html>