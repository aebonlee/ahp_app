<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="styles/layout.css">
    <style>
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 2rem;
            background-color: var(--bg-secondary);
            min-height: calc(100vh - var(--header-height));
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .admin-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .admin-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .admin-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-card-icon {
            font-size: 1.5rem;
        }

        .admin-card-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
        }

        .admin-card-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .change-positive {
            color: #10b981;
        }

        .change-negative {
            color: #ef4444;
        }

        .management-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .management-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .management-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .management-card:hover {
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .management-card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .management-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .management-card-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .recent-activity {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .activity-icon.user { background: #dbeafe; color: #2563eb; }
        .activity-icon.project { background: #dcfce7; color: #16a34a; }
        .activity-icon.system { background: #fef3c7; color: #d97706; }
        .activity-icon.alert { background: #fee2e2; color: #dc2626; }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .quick-actions {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--accent-primary);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(200, 169, 104, 0.4);
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .management-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                bottom: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="header">
        <div class="header-left">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <span id="toggle-icon">â—€</span>
            </button>
            <div class="header-logo">
                <span class="logo-icon">A</span>
                <span class="logo-text">AHP System</span>
                <span class="header-subtitle">ìŠˆí¼ ê´€ë¦¬ì</span>
            </div>
        </div>
        
        <div class="header-center">
            <nav class="header-nav">
                <a href="super-admin-dashboard.html" class="nav-item active" data-page="admin">ê´€ë¦¬ì</a>
                <a href="personal-service-enhanced.html" class="nav-item" data-page="personal">ê°œì¸ì„œë¹„ìŠ¤</a>
                <a href="system-monitoring.html" class="nav-item" data-page="system">ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</a>
                <a href="analytics.html" class="nav-item" data-page="analytics">ë¶„ì„</a>
            </nav>
        </div>
        
        <div class="header-right">
            <div class="header-notifications">
                <button class="notification-btn">
                    <span>ğŸ””</span>
                    <span class="notification-badge">3</span>
                </button>
            </div>
            <div class="header-user">
                <div class="user-avatar">ğŸ‘¤</div>
                <div class="user-info">
                    <div class="user-name">ìŠˆí¼ ê´€ë¦¬ì</div>
                    <div class="user-role">System Admin</div>
                </div>
                <button class="user-menu-btn" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </header>

    <!-- ì‚¬ì´ë“œë°” -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-content">
            <!-- ê´€ë¦¬ì ë©”ë‰´ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ì‹œìŠ¤í…œ ê´€ë¦¬</div>
                <a href="user-management.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ‘¥</span>
                    <span class="sidebar-text">ì‚¬ìš©ì ê´€ë¦¬</span>
                </a>
                <a href="project-overview.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ“Š</span>
                    <span class="sidebar-text">í”„ë¡œì íŠ¸ í˜„í™©</span>
                </a>
                <a href="admin/system-settings.html" class="sidebar-item">
                    <span class="sidebar-icon">âš™ï¸</span>
                    <span class="sidebar-text">ì‹œìŠ¤í…œ ì„¤ì •</span>
                </a>
                <a href="admin/audit-log.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ“‹</span>
                    <span class="sidebar-text">ê°ì‚¬ ë¡œê·¸</span>
                </a>
            </div>

            <!-- ë°ì´í„° ê´€ë¦¬ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ë°ì´í„° ê´€ë¦¬</div>
                <a href="admin/backup-restore.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ’¾</span>
                    <span class="sidebar-text">ë°±ì—… ë° ë³µì›</span>
                </a>
                <a href="admin/database-management.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ—„ï¸</span>
                    <span class="sidebar-text">ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬</span>
                </a>
                <a href="admin/data-migration.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ“¤</span>
                    <span class="sidebar-text">ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜</span>
                </a>
            </div>

            <!-- ë³´ì•ˆ ê´€ë¦¬ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ë³´ì•ˆ ê´€ë¦¬</div>
                <a href="admin/security-settings.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ”’</span>
                    <span class="sidebar-text">ë³´ì•ˆ ì„¤ì •</span>
                </a>
                <a href="admin/access-control.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸ›¡ï¸</span>
                    <span class="sidebar-text">ì ‘ê·¼ ì œì–´</span>
                </a>
                <a href="admin/security-log.html" class="sidebar-item">
                    <span class="sidebar-icon">ğŸš¨</span>
                    <span class="sidebar-text">ë³´ì•ˆ ë¡œê·¸</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <!-- ëŒ€ì‹œë³´ë“œ í†µê³„ -->
        <div class="dashboard-grid">
            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">ğŸ‘¥</span>
                        ì´ ì‚¬ìš©ì
                    </div>
                </div>
                <div class="admin-card-value" id="totalUsers">ë¡œë”©...</div>
                <div class="admin-card-change change-positive" id="userChange">
                    ë°ì´í„° ë¡œë”© ì¤‘...
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">ğŸ“Š</span>
                        í™œì„± í”„ë¡œì íŠ¸
                    </div>
                </div>
                <div class="admin-card-value" id="activeProjects">ë¡œë”©...</div>
                <div class="admin-card-change change-positive" id="projectChange">
                    ë°ì´í„° ë¡œë”© ì¤‘...
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">âš¡</span>
                        ì‹œìŠ¤í…œ ì„±ëŠ¥
                    </div>
                </div>
                <div class="admin-card-value" id="systemPerformance">ë¡œë”©...</div>
                <div class="admin-card-change change-positive" id="performanceStatus">
                    ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì¤‘...
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">ğŸ’¾</span>
                        ì €ì¥ì†Œ ì‚¬ìš©ë¥ 
                    </div>
                </div>
                <div class="admin-card-value" id="storageUsage">ë¡œë”©...</div>
                <div class="admin-card-change change-positive" id="storageStatus">
                    ì €ì¥ì†Œ ìƒíƒœ í™•ì¸ ì¤‘...
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ ì„¹ì…˜ -->
        <div class="management-section">
            <div class="section-header">
                <h2 class="section-title">í•µì‹¬ ê´€ë¦¬ ê¸°ëŠ¥</h2>
            </div>
            <div class="management-grid">
                <div class="management-card" onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')">
                    <div class="management-card-icon">ğŸ‘¥</div>
                    <div class="management-card-title">Django ìŠˆí¼ ê´€ë¦¬ì</div>
                    <div class="management-card-desc">
                        ğŸ”¥ ì‹¤ì œ PostgreSQL ì‚¬ìš©ì ê´€ë¦¬, ê²°ì œ ê´€ë¦¬, í”„ë¡œì íŠ¸ ê´€ë¦¬ - ì™„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ
                    </div>
                </div>

                <div class="management-card" onclick="loadRealUserData()">
                    <div class="management-card-icon">ğŸ“Š</div>
                    <div class="management-card-title">ì‹¤ì‹œê°„ ì‚¬ìš©ì í˜„í™©</div>
                    <div class="management-card-desc">
                        ğŸ”¥ PostgreSQL ì‹¤ì‹œê°„ ì‚¬ìš©ì ë°ì´í„°, ê°€ì… í˜„í™©, í™œë™ í†µê³„
                    </div>
                </div>

                <div class="management-card" onclick="window.location.href='admin/system-settings.html'">
                    <div class="management-card-icon">ğŸ“ˆ</div>
                    <div class="management-card-title">ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</div>
                    <div class="management-card-desc">
                        ì„œë²„ ì„±ëŠ¥, ë°ì´í„°ë² ì´ìŠ¤, API ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
                    </div>
                </div>

                <div class="management-card" onclick="window.location.href='admin/backup-restore.html'">
                    <div class="management-card-icon">ğŸ’¾</div>
                    <div class="management-card-title">ë°±ì—… ê´€ë¦¬</div>
                    <div class="management-card-desc">
                        ë°ì´í„° ë°±ì—…, ë³µì› ë° ì¬í•´ ë³µêµ¬ ê´€ë¦¬
                    </div>
                </div>

                <div class="management-card" onclick="window.location.href='admin/security-settings.html'">
                    <div class="management-card-icon">ğŸ”’</div>
                    <div class="management-card-title">ë³´ì•ˆ ì„¤ì •</div>
                    <div class="management-card-desc">
                        ì‹œìŠ¤í…œ ë³´ì•ˆ ì •ì±…, ì¸ì¦ ë° ì•”í˜¸í™” ì„¤ì •
                    </div>
                </div>

                <div class="management-card" onclick="window.location.href='admin/audit-log.html'">
                    <div class="management-card-icon">ğŸ“‹</div>
                    <div class="management-card-title">ë¶„ì„ ë¦¬í¬íŠ¸</div>
                    <div class="management-card-desc">
                        ì‚¬ìš©ì í™œë™, ì‹œìŠ¤í…œ ì‚¬ìš©ë¥  ë° ì„±ëŠ¥ ë¶„ì„
                    </div>
                </div>
            </div>
        </div>

        <!-- ìµœê·¼ í™œë™ -->
        <div class="recent-activity">
            <div class="section-header">
                <h2 class="section-title">ìµœê·¼ ì‹œìŠ¤í…œ í™œë™</h2>
            </div>
            <ul class="activity-list" id="activityList">
                <li class="activity-item">
                    <div class="activity-icon system">ğŸ“¡</div>
                    <div class="activity-content">
                        <div class="activity-title">ìµœê·¼ í™œë™ ë°ì´í„°ë¥¼ ë¡œë”©í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
                        <div class="activity-time">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
                    </div>
                </li>
            </ul>
        </div>
    </main>

    <!-- ë¹ ë¥¸ ì‘ì—… ë²„íŠ¼ -->
    <div class="quick-actions">
        <button class="fab" title="ìƒˆ ì‚¬ìš©ì ì¶”ê°€" onclick="window.location.href='user-management.html'">
            ğŸ‘¤
        </button>
        <button class="fab" title="ì‹œìŠ¤í…œ ì„¤ì •" onclick="window.location.href='admin/system-settings.html'">
            âš™ï¸
        </button>
    </div>

    <script src="scripts/layout.js"></script>
    <script>
        // í˜ì´ì§€ ì´ˆê¸°í™” (async/await)
        document.addEventListener('DOMContentLoaded', async function() {
            // ë¡œê·¸ì¸ ìƒíƒœ ë° ê¶Œí•œ í™•ì¸
            const loginResult = await checkLoginStatus();
            if (!loginResult) {
                return;
            }
            
            // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”©
            await loadDashboardData();
            
            console.log('âœ… ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì™„ë£Œ');
        });

        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ (Django API ê¸°ë°˜)
        async function checkAdminPermission() {
            try {
                const response = await window.ahpApi.getCurrentUser();
                if (response.success && response.user) {
                    return response.user.role === 'admin' || response.user.is_superuser;
                }
                return false;
            } catch (error) {
                console.error('ê¶Œí•œ í™•ì¸ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ (Django API ê¸°ë°˜)
        async function checkLoginStatus() {
            try {
                const response = await window.ahpApi.getCurrentUser();
                
                if (!response.success || !response.user) {
                    window.location.href = 'login.html?message=session_expired';
                    return false;
                }
                
                // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
                if (response.user.role !== 'admin' && !response.user.is_superuser) {
                    alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    window.location.href = 'personal-service-enhanced.html';
                    return false;
                }
                
                // ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ
                const userNameElement = document.querySelector('.header-user .user-name');
                if (userNameElement && response.user.name) {
                    userNameElement.textContent = response.user.name;
                }
                
                return true;
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
                window.location.href = 'login.html?message=session_expired';
                return false;
            }
        }

        // ì‚¬ì´ë“œë°” í† ê¸€
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('toggle-icon');
            
            sidebar.classList.toggle('collapsed');
            toggleIcon.textContent = sidebar.classList.contains('collapsed') ? 'â–¶' : 'â—€';
        }

        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”©
        async function loadDashboardData() {
            try {
                // ë³‘ë ¬ë¡œ ë°ì´í„° ë¡œë”©
                await Promise.all([
                    loadSystemStats(),
                    loadRecentActivity()
                ]);
            } catch (error) {
                console.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
            }
        }

        // ì‹œìŠ¤í…œ í†µê³„ ë°ì´í„° ë¡œë”© (ê°•í™”ëœ retry ë¡œì§)
        async function loadSystemStats() {
            const maxRetries = 3;
            let currentTry = 0;
            
            while (currentTry < maxRetries) {
                try {
                    console.log(`ğŸ”„ Django API í˜¸ì¶œ ì‹œë„ ${currentTry + 1}/${maxRetries}`);
                    
                    const response = await fetch(`https://ahp-django-backend.onrender.com/super-admin/api/dashboard/stats/?_t=${Date.now()}`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        cache: 'no-cache'
                    });

                    if (response.ok) {
                        const stats = await response.json();
                        console.log('âœ… Django PostgreSQL ë°ì´í„° ë¡œë“œ ì„±ê³µ:', stats);
                        updateSystemStats(stats);
                        return; // ì„±ê³µì‹œ ì¢…ë£Œ
                    } else if (response.status === 403) {
                        console.warn(`âš ï¸ 403 Forbidden - Render ì—…ë°ì´íŠ¸ ì¤‘... (ì‹œë„ ${currentTry + 1})`);
                        if (currentTry < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, 2000 * (currentTry + 1))); // ì ì§„ì  ì§€ì—°
                        }
                    } else {
                        console.error('API ì˜¤ë¥˜:', response.status, response.statusText);
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    console.error(`ì‹œë„ ${currentTry + 1} ì‹¤íŒ¨:`, error);
                    if (currentTry < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, 1000 * (currentTry + 1)));
                    }
                }
                currentTry++;
            }
            
            // ëª¨ë“  ì‹œë„ ì‹¤íŒ¨ì‹œ fallback ë°ì´í„°
            console.warn('ğŸ”„ ëª¨ë“  API ì‹œë„ ì‹¤íŒ¨ - Render ì—…ë°ì´íŠ¸ ëŒ€ê¸° ì¤‘');
            updateSystemStats({
                total_users: 'Render ì—…ë°ì´íŠ¸ ì¤‘...',
                active_projects: 'Django ì¬ì‹œì‘ ì¤‘...', 
                system_performance: 'ë°±ì—”ë“œ ë¡œë”© ì¤‘...',
                storage_usage: 'ë°ì´í„° ì¤€ë¹„ ì¤‘...'
            });
            }
        }

        // ì‹œìŠ¤í…œ í†µê³„ ì—…ë°ì´íŠ¸
        function updateSystemStats(stats) {
            console.log('ğŸ“Š ì‹¤ì œ Django ë°±ì—”ë“œ ë°ì´í„°:', stats);
            
            // ì‹¤ì œ PostgreSQL ë°ì´í„° í‘œì‹œ
            document.getElementById('totalUsers').textContent = stats.total_users || '0';
            document.getElementById('activeProjects').textContent = stats.active_projects || '0';
            document.getElementById('systemPerformance').textContent = stats.system_performance ? `${stats.system_performance}%` : 'ì •ìƒ';
            document.getElementById('storageUsage').textContent = stats.storage_usage ? `${stats.storage_usage}%` : 'ì •ìƒ';

            // Django ê³„ì‚°ëœ ì‹¤ì œ ì¦ê°€ìœ¨ í‘œì‹œ
            document.getElementById('userChange').textContent = stats.user_growth ? `â†‘ +${stats.user_growth}% (ì´ë²ˆ ë‹¬)` : 'ì‹¤ì‹œê°„ PostgreSQL ë°ì´í„°';
            document.getElementById('projectChange').textContent = stats.project_growth ? `â†‘ +${stats.project_growth}% (ì´ë²ˆ ì£¼)` : 'ì‹¤ì‹œê°„ Django í†µê³„';
            document.getElementById('performanceStatus').textContent = stats.performance_status || 'ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™';
            document.getElementById('storageStatus').textContent = stats.storage_status || 'ì—¬ìœ  ê³µê°„ ì¶©ë¶„';
            
            // Django ë°±ì—”ë“œ ì„±ê³µ í‘œì‹œ
            const statusEl = document.querySelector('.admin-card-value');
            if (statusEl) {
                statusEl.style.color = '#10b981'; // ë…¹ìƒ‰ìœ¼ë¡œ ì„±ê³µ í‘œì‹œ
            }
        }

        // ìµœê·¼ í™œë™ ë°ì´í„° ë¡œë”©
        async function loadRecentActivity() {
            try {
                const response = await fetch(`https://ahp-django-backend.onrender.com/super-admin/api/audit/logs/?limit=5&_t=${Date.now()}`, {
                    credentials: 'include',
                    cache: 'no-cache'
                });

                if (response.ok) {
                    const activities = await response.json();
                    updateRecentActivity(activities.results || activities);
                } else {
                    updateRecentActivity([]);
                }
            } catch (error) {
                console.error('ìµœê·¼ í™œë™ ë¡œë”© ì‹¤íŒ¨:', error);
                updateRecentActivity([]);
            }
        }

        // ìµœê·¼ í™œë™ ì—…ë°ì´íŠ¸
        function updateRecentActivity(activities) {
            const activityList = document.getElementById('activityList');
            
            if (!activities || activities.length === 0) {
                activityList.innerHTML = `
                    <li class="activity-item">
                        <div class="activity-icon system">ğŸ“Š</div>
                        <div class="activity-content">
                            <div class="activity-title">ì•„ì§ í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
                            <div class="activity-time">ì„œë¹„ìŠ¤ ì‚¬ìš©ì´ ì‹œì‘ë˜ë©´ í™œë™ ë‚´ì—­ì´ í‘œì‹œë©ë‹ˆë‹¤</div>
                        </div>
                    </li>
                `;
                return;
            }

            const activityHtml = activities.map(activity => {
                const iconMap = {
                    'user_created': { icon: 'ğŸ‘¤', class: 'user' },
                    'project_created': { icon: 'ğŸ“Š', class: 'project' },
                    'system_backup': { icon: 'ğŸ’¾', class: 'system' },
                    'login_success': { icon: 'ğŸ”“', class: 'user' },
                    'admin_action': { icon: 'âš™ï¸', class: 'system' },
                    'security_alert': { icon: 'ğŸš¨', class: 'alert' }
                };

                const iconData = iconMap[activity.action_type] || { icon: 'ğŸ“‹', class: 'system' };

                return `
                    <li class="activity-item">
                        <div class="activity-icon ${iconData.class}">${iconData.icon}</div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.description || activity.action}</div>
                            <div class="activity-time">${formatTimeAgo(activity.timestamp || activity.created_at)}</div>
                        </div>
                    </li>
                `;
            }).join('');

            activityList.innerHTML = activityHtml;
        }

        // ì‹œê°„ ì°¨ì´ ê³„ì‚° 
        function formatTimeAgo(timestamp) {
            if (!timestamp) return 'ì‹œê°„ ë¶ˆëª…';
            
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
            if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
            if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
            return `${diffDays}ì¼ ì „`;
        }

        // ì‹¤ì‹œê°„ ì‚¬ìš©ì ë°ì´í„° ë¡œë”© - Django PostgreSQL ì§ì ‘ ì—°ë™
        async function loadRealUserData() {
            try {
                const response = await fetch('https://ahp-django-backend.onrender.com/api/users/list/', {
                    credentials: 'include'
                });

                if (response.ok) {
                    const userData = await response.json();
                    showUserDataModal(userData);
                } else {
                    alert('ì‚¬ìš©ì ë°ì´í„° ë¡œë”© ì‹¤íŒ¨. ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ìš©ì ë°ì´í„° ëª¨ë‹¬ í‘œì‹œ
        function showUserDataModal(data) {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="
                    position: fixed; 
                    top: 0; left: 0; 
                    width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.8); 
                    display: flex; 
                    justify-content: center; 
                    align-items: center;
                    z-index: 10000;
                " onclick="this.remove()">
                    <div style="
                        background: white; 
                        padding: 2rem; 
                        border-radius: 12px; 
                        max-width: 800px; 
                        max-height: 80vh; 
                        overflow-y: auto;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                    " onclick="event.stopPropagation()">
                        <h2>ğŸ”¥ ì‹¤ì‹œê°„ PostgreSQL ì‚¬ìš©ì ë°ì´í„°</h2>
                        <div style="margin-bottom: 1rem;">
                            <strong>ì´ ì‚¬ìš©ì:</strong> ${data.total || 0}ëª…<br>
                            <strong>í™œì„± ì‚¬ìš©ì:</strong> ${data.stats?.active_users || 0}ëª…<br>
                            <strong>ê´€ë¦¬ì:</strong> ${data.stats?.staff_users || 0}ëª…<br>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${data.users ? data.users.map(user => `
                                <div style="
                                    border: 1px solid #eee; 
                                    padding: 1rem; 
                                    margin: 0.5rem 0; 
                                    border-radius: 8px;
                                    background: #f9f9f9;
                                ">
                                    <strong>${user.email}</strong> (${user.username})<br>
                                    <small>
                                        íƒ€ì…: ${user.user_type} | 
                                        êµ¬ë…: ${user.subscription_tier} | 
                                        ê°€ì…ì¼: ${new Date(user.date_joined).toLocaleDateString('ko-KR')}
                                        ${user.last_login ? ` | ìµœì¢…ë¡œê·¸ì¸: ${new Date(user.last_login).toLocaleDateString('ko-KR')}` : ''}
                                    </small>
                                </div>
                            `).join('') : 'ë°ì´í„° ì—†ìŒ'}
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')" 
                                style="
                                    background: #C8A968; 
                                    color: white; 
                                    border: none; 
                                    padding: 0.7rem 1.5rem; 
                                    border-radius: 6px; 
                                    cursor: pointer;
                                    margin-right: 1rem;
                                ">Django ê´€ë¦¬ì íŒ¨ë„</button>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="
                                    background: #6b7280; 
                                    color: white; 
                                    border: none; 
                                    padding: 0.7rem 1.5rem; 
                                    border-radius: 6px; 
                                    cursor: pointer;
                                ">ë‹«ê¸°</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ë¡œê·¸ì•„ì›ƒ (Django API ê¸°ë°˜)
        async function handleLogout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    await window.ahpApi.logout();
                    window.location.href = 'login.html?message=logout';
                } catch (error) {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                    window.location.href = 'login.html';
                }
            }
        }
    </script>
</body>
</html>