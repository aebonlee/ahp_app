<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="styles/layout.css">
    <style>
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 2rem;
            background-color: var(--bg-secondary);
            min-height: calc(100vh - var(--header-height));
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .admin-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .admin-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .admin-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-card-icon {
            font-size: 1.5rem;
        }

        .admin-card-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
        }

        .admin-card-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .change-positive {
            color: #10b981;
        }

        .change-negative {
            color: #ef4444;
        }

        .management-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .admin-mode-toggle {
            padding: 0.5rem 1rem;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .admin-mode-toggle:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        .admin-badge {
            display: inline-block;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 0.5rem;
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        }

        .user-role {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            color: var(--text-primary);
        }

        /* ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ìƒíƒœ í‘œì‹œ */
        .status-indicator {
            position: relative;
            display: inline-block;
        }

        .status-indicator::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-indicator.offline::after {
            background: #ef4444;
        }

        /* í”„ë¦¬ë¯¸ì—„ ê·¸ë¼ë°ì´ì…˜ */
        .premium-gradient {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 50%, #8B5A2B 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .management-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .management-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .management-card:hover {
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .management-card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .management-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .management-card-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .recent-activity {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .activity-icon.user { background: #dbeafe; color: #2563eb; }
        .activity-icon.project { background: #dcfce7; color: #16a34a; }
        .activity-icon.system { background: #fef3c7; color: #d97706; }
        .activity-icon.alert { background: #fee2e2; color: #dc2626; }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .quick-actions {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--accent-primary);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(200, 169, 104, 0.4);
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .management-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                bottom: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="header">
        <div class="header-left">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <span id="toggle-icon">â—€</span>
            </button>
            <div class="header-logo">
                <span class="logo-icon">A</span>
                <span class="logo-text">AHP System</span>
                <span class="header-subtitle">ìŠˆí¼ ê´€ë¦¬ì</span>
            </div>
        </div>
        
        <div class="header-center">
            <nav class="header-nav">
                <a href="./super-admin-dashboard.html" class="nav-item active" data-page="admin">ê´€ë¦¬ì</a>
                <a href="./personal-service-enhanced.html" class="nav-item" data-page="personal">ê°œì¸ì„œë¹„ìŠ¤</a>
                <a href="#" class="nav-item" data-page="system" onclick="loadContent('system-settings', this); return false;">ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</a>
                <a href="#" class="nav-item" data-page="analytics" onclick="loadContent('audit-log', this); return false;">ë¶„ì„</a>
            </nav>
        </div>
        
        <div class="header-right">
            <!-- ê°œì¸ ì„œë¹„ìŠ¤ ëª¨ë“œ ì „í™˜ ë²„íŠ¼ (ìŠˆí¼ ê´€ë¦¬ìì—ê²Œë§Œ í‘œì‹œ) -->
            <button id="personalServiceToggle" class="admin-mode-toggle" onclick="switchToPersonalService()" style="background: var(--accent-secondary); margin-right: 1rem;">
                ğŸ‘¤ ê°œì¸ ì„œë¹„ìŠ¤
            </button>
            
            <div class="header-notifications">
                <button class="notification-btn">
                    <span>ğŸ””</span>
                    <span class="notification-badge">3</span>
                </button>
            </div>
            <div class="header-user">
                <div class="user-avatar status-indicator" id="userAvatar">ğŸ‘¤</div>
                <div class="user-info">
                    <div class="user-name" id="userName">ìŠˆí¼ ê´€ë¦¬ì</div>
                    <div class="user-role" id="userRole">
                        <span id="userRoleText" class="premium-gradient">System Admin</span>
                        <span id="adminBadge" class="admin-badge">ğŸ›¡ï¸ ìŠˆí¼ ê´€ë¦¬ì</span>
                    </div>
                </div>
                <button class="user-menu-btn" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </header>

    <!-- ì‚¬ì´ë“œë°” -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-content">
            <!-- ê´€ë¦¬ì ë©”ë‰´ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ì‹œìŠ¤í…œ ê´€ë¦¬</div>
                <div class="sidebar-item active" data-content="dashboard" style="cursor: pointer;" onclick="handleMenuClick('dashboard', this)">
                    <span class="sidebar-icon">ğŸ </span>
                    <span class="sidebar-text">ëŒ€ì‹œë³´ë“œ</span>
                </div>
                <div class="sidebar-item" data-content="user-management" style="cursor: pointer;" onclick="handleMenuClick('user-management', this)">
                    <span class="sidebar-icon">ğŸ‘¥</span>
                    <span class="sidebar-text">ì‚¬ìš©ì ê´€ë¦¬</span>
                </div>
                <div class="sidebar-item" data-content="project-overview" style="cursor: pointer;" onclick="handleMenuClick('project-overview', this)">
                    <span class="sidebar-icon">ğŸ“Š</span>
                    <span class="sidebar-text">í”„ë¡œì íŠ¸ í˜„í™©</span>
                </div>
                <div class="sidebar-item" data-content="system-settings" style="cursor: pointer;" onclick="handleMenuClick('system-settings', this)">
                    <span class="sidebar-icon">âš™ï¸</span>
                    <span class="sidebar-text">ì‹œìŠ¤í…œ ì„¤ì •</span>
                </div>
                <div class="sidebar-item" data-content="audit-log" style="cursor: pointer;" onclick="handleMenuClick('audit-log', this)">
                    <span class="sidebar-icon">ğŸ“‹</span>
                    <span class="sidebar-text">ê°ì‚¬ ë¡œê·¸</span>
                </div>
            </div>

            <!-- ë°ì´í„° ê´€ë¦¬ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ë°ì´í„° ê´€ë¦¬</div>
                <div class="sidebar-item" data-content="backup-restore" style="cursor: pointer;" onclick="handleMenuClick('backup-restore', this)">
                    <span class="sidebar-icon">ğŸ’¾</span>
                    <span class="sidebar-text">ë°±ì—… ë° ë³µì›</span>
                </div>
                <div class="sidebar-item" data-content="database-management" style="cursor: pointer;" onclick="handleMenuClick('database-management', this)">
                    <span class="sidebar-icon">ğŸ—„ï¸</span>
                    <span class="sidebar-text">ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬</span>
                </div>
                <div class="sidebar-item" data-content="data-migration" style="cursor: pointer;" onclick="handleMenuClick('data-migration', this)">
                    <span class="sidebar-icon">ğŸ“¤</span>
                    <span class="sidebar-text">ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜</span>
                </div>
            </div>

            <!-- ë³´ì•ˆ ê´€ë¦¬ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ë³´ì•ˆ ê´€ë¦¬</div>
                <div class="sidebar-item" data-content="security-settings" style="cursor: pointer;" onclick="handleMenuClick('security-settings', this)">
                    <span class="sidebar-icon">ğŸ”’</span>
                    <span class="sidebar-text">ë³´ì•ˆ ì„¤ì •</span>
                </div>
                <div class="sidebar-item" data-content="access-control" style="cursor: pointer;" onclick="handleMenuClick('access-control', this)">
                    <span class="sidebar-icon">ğŸ›¡ï¸</span>
                    <span class="sidebar-text">ì ‘ê·¼ ì œì–´</span>
                </div>
                <div class="sidebar-item" data-content="security-log" style="cursor: pointer;" onclick="handleMenuClick('security-log', this)">
                    <span class="sidebar-icon">ğŸš¨</span>
                    <span class="sidebar-text">ë³´ì•ˆ ë¡œê·¸</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <!-- ëŒ€ì‹œë³´ë“œ í†µê³„ -->
        <div class="dashboard-grid">
            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">ğŸ‘¥</span>
                        ì´ ì‚¬ìš©ì
                    </div>
                </div>
                <div class="admin-card-value" id="totalUsers">ë¡œë”©...</div>
                <div class="admin-card-change change-positive" id="userChange">
                    ë°ì´í„° ë¡œë”© ì¤‘...
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">ğŸ“Š</span>
                        í™œì„± í”„ë¡œì íŠ¸
                    </div>
                </div>
                <div class="admin-card-value" id="activeProjects">ë¡œë”©...</div>
                <div class="admin-card-change change-positive" id="projectChange">
                    ë°ì´í„° ë¡œë”© ì¤‘...
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">âš¡</span>
                        ì‹œìŠ¤í…œ ì„±ëŠ¥
                    </div>
                </div>
                <div class="admin-card-value" id="systemPerformance">ë¡œë”©...</div>
                <div class="admin-card-change change-positive" id="performanceStatus">
                    ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì¤‘...
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">ğŸ’¾</span>
                        ì €ì¥ì†Œ ì‚¬ìš©ë¥ 
                    </div>
                </div>
                <div class="admin-card-value" id="storageUsage">ë¡œë”©...</div>
                <div class="admin-card-change change-positive" id="storageStatus">
                    ì €ì¥ì†Œ ìƒíƒœ í™•ì¸ ì¤‘...
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ ì„¹ì…˜ -->
        <div class="management-section">
            <div class="section-header">
                <h2 class="section-title">í•µì‹¬ ê´€ë¦¬ ê¸°ëŠ¥</h2>
            </div>
            <div class="management-grid">
                <div class="management-card" onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')">
                    <div class="management-card-icon">ğŸ‘¥</div>
                    <div class="management-card-title">Django ìŠˆí¼ ê´€ë¦¬ì</div>
                    <div class="management-card-desc">
                        ğŸ”¥ ì‹¤ì œ PostgreSQL ì‚¬ìš©ì ê´€ë¦¬, ê²°ì œ ê´€ë¦¬, í”„ë¡œì íŠ¸ ê´€ë¦¬ - ì™„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ
                    </div>
                </div>

                <div class="management-card" onclick="loadRealUserData()">
                    <div class="management-card-icon">ğŸ“Š</div>
                    <div class="management-card-title">ì‹¤ì‹œê°„ ì‚¬ìš©ì í˜„í™©</div>
                    <div class="management-card-desc">
                        ğŸ”¥ PostgreSQL ì‹¤ì‹œê°„ ì‚¬ìš©ì ë°ì´í„°, ê°€ì… í˜„í™©, í™œë™ í†µê³„
                    </div>
                </div>

                <div class="management-card" onclick="loadContent('system-settings', null)">
                    <div class="management-card-icon">ğŸ“ˆ</div>
                    <div class="management-card-title">ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</div>
                    <div class="management-card-desc">
                        ì„œë²„ ì„±ëŠ¥, ë°ì´í„°ë² ì´ìŠ¤, API ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
                    </div>
                </div>

                <div class="management-card" onclick="loadContent('backup-restore', null)">
                    <div class="management-card-icon">ğŸ’¾</div>
                    <div class="management-card-title">ë°±ì—… ê´€ë¦¬</div>
                    <div class="management-card-desc">
                        ë°ì´í„° ë°±ì—…, ë³µì› ë° ì¬í•´ ë³µêµ¬ ê´€ë¦¬
                    </div>
                </div>

                <div class="management-card" onclick="loadContent('security-settings', null)">
                    <div class="management-card-icon">ğŸ”’</div>
                    <div class="management-card-title">ë³´ì•ˆ ì„¤ì •</div>
                    <div class="management-card-desc">
                        ì‹œìŠ¤í…œ ë³´ì•ˆ ì •ì±…, ì¸ì¦ ë° ì•”í˜¸í™” ì„¤ì •
                    </div>
                </div>

                <div class="management-card" onclick="loadContent('audit-log', null)">
                    <div class="management-card-icon">ğŸ“‹</div>
                    <div class="management-card-title">ë¶„ì„ ë¦¬í¬íŠ¸</div>
                    <div class="management-card-desc">
                        ì‚¬ìš©ì í™œë™, ì‹œìŠ¤í…œ ì‚¬ìš©ë¥  ë° ì„±ëŠ¥ ë¶„ì„
                    </div>
                </div>
            </div>
        </div>

        <!-- ìµœê·¼ í™œë™ -->
        <div class="recent-activity">
            <div class="section-header">
                <h2 class="section-title">ìµœê·¼ ì‹œìŠ¤í…œ í™œë™</h2>
            </div>
            <ul class="activity-list" id="activityList">
                <li class="activity-item">
                    <div class="activity-icon system">ğŸ“¡</div>
                    <div class="activity-content">
                        <div class="activity-title">ìµœê·¼ í™œë™ ë°ì´í„°ë¥¼ ë¡œë”©í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
                        <div class="activity-time">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
                    </div>
                </li>
            </ul>
        </div>
    </main>

    <!-- ë¹ ë¥¸ ì‘ì—… ë²„íŠ¼ -->
    <div class="quick-actions">
        <button class="fab" title="ì‚¬ìš©ì ê´€ë¦¬" onclick="loadContent('user-management', null)">
            ğŸ‘¤
        </button>
        <button class="fab" title="ì‹œìŠ¤í…œ ì„¤ì •" onclick="loadContent('system-settings', null)">
            âš™ï¸
        </button>
    </div>

    <script>
        // API ì„œë¹„ìŠ¤ì˜ ìë™ ì¸ì¦ í™•ì¸ ë¹„í™œì„±í™” í”Œë˜ê·¸
        window.SKIP_AUTO_AUTH_CHECK = true;
    </script>
    <script src="scripts/api-service.js"></script>
    <script src="scripts/layout.js"></script>
    <script>
        // í˜ì´ì§€ ì´ˆê¸°í™” (async/await)
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸ›¡ï¸ ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘');
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            showLoadingState();
            
            // ì‚¬ìš©ì ì •ë³´ ìºì‹± ì´ˆê¸°í™”
            window.currentUser = null;
            window.sessionChecked = false;
            window.authenticationInProgress = false;
            
            // API ì„œë¹„ìŠ¤ ë¡œë“œ ëŒ€ê¸°
            let apiLoadAttempts = 0;
            while (typeof window.ahpApi === 'undefined' && apiLoadAttempts < 10) {
                console.log('â³ API ì„œë¹„ìŠ¤ ë¡œë“œ ëŒ€ê¸° ì¤‘...');
                await new Promise(resolve => setTimeout(resolve, 100));
                apiLoadAttempts++;
            }
            
            if (typeof window.ahpApi === 'undefined') {
                console.error('âŒ API ì„œë¹„ìŠ¤ ë¡œë“œ ì‹¤íŒ¨');
                showErrorState('API ì„œë¹„ìŠ¤ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¡œê·¸ì¸ ìƒíƒœ ë° ê¶Œí•œ í™•ì¸
            try {
                const loginResult = await checkLoginStatus();
                if (!loginResult) {
                    console.error('âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ');
                    showAuthErrorState('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', './login.html');
                    return;
                }
                
                // ê´€ë¦¬ì ê¶Œí•œ ì¬í™•ì¸
                if (!window.currentUser || (window.currentUser.role !== 'admin' && !window.currentUser.is_superuser)) {
                    console.error('âŒ ê´€ë¦¬ì ê¶Œí•œ ì—†ìŒ');
                    showAuthErrorState('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.', './personal-service-enhanced.html');
                    return;
                }
                
                // ì¸ì¦ ì„±ê³µ - ë¡œë”© ìƒíƒœ í•´ì œí•˜ê³  ì •ìƒ í˜ì´ì§€ í‘œì‹œ
                hideLoadingState();
                console.log('âœ… ì¸ì¦ ì„±ê³µ - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í‘œì‹œ');
                
            } catch (error) {
                console.error('âŒ ì¸ì¦ í™•ì¸ ì‹¤íŒ¨:', error);
                showAuthErrorState('ì¸ì¦ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', './login.html');
                return;
            }
            
            // ì„¸ì…˜ ì²´í¬ ì™„ë£Œ í”Œë˜ê·¸ ì„¤ì •
            window.sessionChecked = true;
            console.log('âœ… ì¸ì¦ ì™„ë£Œ - ì´í›„ ë©”ë‰´ í´ë¦­ì—ì„œ ì¬ì¸ì¦ ì•ˆí•¨');
            
            // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”©
            await loadDashboardData();
            
            console.log('âœ… ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì™„ë£Œ - SPA ëª¨ë“œ í™œì„±í™”');
            
            // ì‚¬ì´ë“œë°” ë©”ë‰´ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            setupSidebarEventListeners();
        });

        // ë¡œë”© ë° ì—ëŸ¬ ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function showLoadingState() {
            // ê¸°ì¡´ ë¡œë”© ì˜¤ë²„ë ˆì´ê°€ ìˆë‹¤ë©´ ì œê±°
            const existingOverlay = document.getElementById('loading-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }
            
            // ë¡œë”© ì˜¤ë²„ë ˆì´ë¥¼ bodyì— ì¶”ê°€ (ê¸°ì¡´ ì½˜í…ì¸ ëŠ” ìœ ì§€)
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'loading-overlay';
            loadingOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(249, 250, 251, 0.98);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
            `;
            
            loadingOverlay.innerHTML = `
                <div style="text-align: center;">
                    <div style="
                        width: 50px;
                        height: 50px;
                        border: 4px solid #e5e7eb;
                        border-top: 4px solid #C8A968;
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                        margin: 0 auto 1rem;
                    "></div>
                    <h2 style="color: #1f2937; margin-bottom: 0.5rem;">AHP ì‹œìŠ¤í…œ ë¡œë”© ì¤‘...</h2>
                    <p style="color: #6b7280;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
            
            document.body.appendChild(loadingOverlay);
            console.log('ğŸ”„ ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ');
        }

        function showErrorState(message) {
            document.body.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #f9fafb;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                ">
                    <div style="text-align: center; max-width: 500px; padding: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">âš ï¸</div>
                        <h2 style="color: #dc2626; margin-bottom: 1rem;">ì‹œìŠ¤í…œ ì˜¤ë¥˜</h2>
                        <p style="color: #6b7280; margin-bottom: 2rem;">${message}</p>
                        <button onclick="window.location.reload()" style="
                            background: #C8A968;
                            color: white;
                            border: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 6px;
                            cursor: pointer;
                            font-size: 1rem;
                        ">í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>
            `;
        }

        function showAuthErrorState(message, redirectUrl) {
            document.body.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #f9fafb;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                ">
                    <div style="text-align: center; max-width: 500px; padding: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ”</div>
                        <h2 style="color: #dc2626; margin-bottom: 1rem;">ì ‘ê·¼ ê¶Œí•œ í•„ìš”</h2>
                        <p style="color: #6b7280; margin-bottom: 2rem;">${message}</p>
                        <div>
                            <button onclick="window.location.href='${redirectUrl}'" style="
                                background: #C8A968;
                                color: white;
                                border: none;
                                padding: 0.75rem 1.5rem;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 1rem;
                                margin-right: 1rem;
                            ">ë¡œê·¸ì¸í•˜ê¸°</button>
                            <button onclick="window.location.href='/ahp_app/'" style="
                                background: #6b7280;
                                color: white;
                                border: none;
                                padding: 0.75rem 1.5rem;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 1rem;
                            ">í™ˆìœ¼ë¡œ</button>
                        </div>
                    </div>
                </div>
            `;
            
            // 3ì´ˆ í›„ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸
            setTimeout(() => {
                window.location.href = redirectUrl;
            }, 3000);
        }

        function hideLoadingState() {
            // ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.remove();
                console.log('âœ… ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±° ì™„ë£Œ');
            }
            
            // bodyê°€ ìˆ¨ê²¨ì ¸ ìˆë‹¤ë©´ í‘œì‹œ
            if (document.body.style.display === 'none') {
                document.body.style.display = '';
                console.log('âœ… í˜ì´ì§€ ì½˜í…ì¸  í‘œì‹œ');
            }
        }
        
        // ì§ì ‘ ì˜¨í´ë¦­ í•¸ë“¤ëŸ¬ (fallback) - ê°„ì†Œí™” ë²„ì „
        // windowì— ë“±ë¡í•˜ì—¬ HTML onclickì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•¨
        window.handleMenuClick = async function(contentType, element) {
            console.log(`ğŸ–±ï¸ ë©”ë‰´ í´ë¦­: ${contentType}`);
            
            // ì´ë²¤íŠ¸ ì „íŒŒ ì¤‘ì§€
            if (typeof event !== 'undefined' && event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const mainContent = document.querySelector('.main-content');
            if (!mainContent) {
                console.error('âŒ main-content ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ì‹œê°ì  í”¼ë“œë°±
            if (element) {
                // ëª¨ë“  ë©”ë‰´ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.remove('active');
                });
                // í´ë¦­ëœ ë©”ë‰´ì— active í´ë˜ìŠ¤ ì¶”ê°€
                element.classList.add('active');
            }
            
            // ê°„ë‹¨í•œ ì½˜í…ì¸  ì§ì ‘ í‘œì‹œ (loadContent ìš°íšŒ)
            let content = '';
            switch(contentType) {
                case 'user-management':
                    content = `
                        <div style="padding: 2rem;">
                            <h1 style="color: #C8A968; margin-bottom: 2rem;">ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</h1>
                            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <p>ì‚¬ìš©ì ê´€ë¦¬ í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
                                <button onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')" 
                                        style="margin-top: 1rem; padding: 0.75rem 1.5rem; background: #C8A968; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                    Django ê´€ë¦¬ì íŒ¨ë„ ì—´ê¸°
                                </button>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'project-overview':
                    content = `
                        <div style="padding: 2rem;">
                            <h1 style="color: #C8A968; margin-bottom: 2rem;">ğŸ“Š í”„ë¡œì íŠ¸ í˜„í™©</h1>
                            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <p>í”„ë¡œì íŠ¸ í˜„í™© í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
                                <p style="margin-top: 1rem;">í˜„ì¬ ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸: 5ê°œ</p>
                                <p>ì™„ë£Œëœ í”„ë¡œì íŠ¸: 12ê°œ</p>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'system-settings':
                    content = `
                        <div style="padding: 2rem;">
                            <h1 style="color: #C8A968; margin-bottom: 2rem;">âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •</h1>
                            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <p>ì‹œìŠ¤í…œ ì„¤ì • í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
                                <div style="margin-top: 1rem;">
                                    <p><strong>ì„œë²„ ìƒíƒœ:</strong> ì •ìƒ ì‘ë™ ì¤‘</p>
                                    <p><strong>ë°ì´í„°ë² ì´ìŠ¤:</strong> PostgreSQL ì—°ê²°ë¨</p>
                                    <p><strong>API ìƒíƒœ:</strong> í™œì„±</p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'dashboard':
                    // ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                    window.location.reload();
                    return;
                    
                default:
                    content = `
                        <div style="padding: 2rem;">
                            <h1 style="color: #C8A968; margin-bottom: 2rem;">${contentType}</h1>
                            <div style="background: white; padding: 4rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸš§</div>
                                <p style="color: #666;">ì´ í˜ì´ì§€ëŠ” í˜„ì¬ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
                                <button onclick="handleMenuClick('dashboard', null)" 
                                        style="margin-top: 2rem; padding: 0.75rem 1.5rem; background: #C8A968; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                    ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                                </button>
                            </div>
                        </div>
                    `;
            }
            
            // ì½˜í…ì¸  ì§ì ‘ ì‚½ì…
            mainContent.innerHTML = content;
            console.log(`âœ… ${contentType} ì½˜í…ì¸  í‘œì‹œ ì™„ë£Œ`);
        }
        
        // ì‚¬ì´ë“œë°” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupSidebarEventListeners() {
            console.log('ğŸ”§ ì‚¬ì´ë“œë°” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘...');
            
            const sidebarItems = document.querySelectorAll('.sidebar-item[data-content]');
            console.log(`ğŸ” ë°œê²¬ëœ ì‚¬ì´ë“œë°” ë©”ë‰´ ìš”ì†Œ: ${sidebarItems.length}ê°œ`);
            
            if (sidebarItems.length === 0) {
                console.error('âŒ ì‚¬ì´ë“œë°” ë©”ë‰´ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            sidebarItems.forEach((item, index) => {
                const contentType = item.getAttribute('data-content');
                console.log(`ğŸ“ ë©”ë‰´ ${index + 1}: ${contentType}`);
                
                item.addEventListener('click', async function(event) {
                    console.log(`ğŸ–±ï¸ ë©”ë‰´ í´ë¦­ë¨: ${contentType} (ìš”ì†Œ:`, this, ')');
                    
                    event.preventDefault();
                    event.stopPropagation();
                    
                    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ (ë” ìƒì„¸í•œ ë””ë²„ê¹…)
                    console.log('ğŸ” í˜„ì¬ ì‚¬ìš©ì ì •ë³´:', window.currentUser);
                    if (!window.currentUser) {
                        console.error('âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ - ë©”ë‰´ í´ë¦­ ì°¨ë‹¨');
                        
                        // ì‹¤ì‹œê°„ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ì¬í™•ì¸ ì‹œë„
                        try {
                            console.log('ğŸ”„ ì‚¬ìš©ì ì •ë³´ ì¬í™•ì¸ ì‹œë„...');
                            const userCheckResponse = await window.ahpApi.getCurrentUser();
                            if (userCheckResponse && userCheckResponse.success && userCheckResponse.user) {
                                console.log('âœ… ì‚¬ìš©ì ì •ë³´ ì¬í™•ì¸ ì„±ê³µ:', userCheckResponse.user);
                                window.currentUser = userCheckResponse.user;
                            } else {
                                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                                window.location.href = './login.html';
                                return;
                            }
                        } catch (error) {
                            console.error('âŒ ì‚¬ìš©ì ì •ë³´ ì¬í™•ì¸ ì‹¤íŒ¨:', error);
                            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                            window.location.href = './login.html';
                            return;
                        }
                    }
                    
                    // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ (ë” ìœ ì—°í•œ ì²´í¬)
                    const hasAdminAccess = window.currentUser.role === 'admin' || 
                                         window.currentUser.is_superuser || 
                                         window.currentUser.role === 'superuser';
                    
                    if (!hasAdminAccess) {
                        console.error('âŒ ê´€ë¦¬ì ê¶Œí•œ ì—†ìŒ - ë©”ë‰´ í´ë¦­ ì°¨ë‹¨');
                        console.log('ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì ì—­í• :', window.currentUser.role, 'is_superuser:', window.currentUser.is_superuser);
                        alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        window.location.href = './personal-service-enhanced.html';
                        return;
                    }
                    
                    // ì‹œê°ì  í”¼ë“œë°±
                    this.style.backgroundColor = '#e3f2fd';
                    setTimeout(() => {
                        this.style.backgroundColor = '';
                    }, 200);
                    
                    // ëª¨ë“  ë©”ë‰´ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                    sidebarItems.forEach(el => el.classList.remove('active'));
                    
                    // í´ë¦­ëœ ë©”ë‰´ì— active í´ë˜ìŠ¤ ì¶”ê°€
                    this.classList.add('active');
                    console.log(`âœ… Active í´ë˜ìŠ¤ ì¶”ê°€ë¨: ${contentType}`);
                    
                    // ì½˜í…ì¸  ë¡œë“œ
                    try {
                        console.log(`ğŸš€ loadContent í˜¸ì¶œ: ${contentType}`);
                        await loadContent(contentType, this);
                    } catch (error) {
                        console.error('âŒ loadContent í˜¸ì¶œ ì˜¤ë¥˜:', error);
                    }
                });
                
                // í˜¸ë²„ íš¨ê³¼ ì¶”ê°€
                item.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#f5f5f5';
                });
                
                item.addEventListener('mouseleave', function() {
                    if (!this.classList.contains('active')) {
                        this.style.backgroundColor = '';
                    }
                });
            });
            
            console.log(`âœ… ${sidebarItems.length}ê°œ ì‚¬ì´ë“œë°” ë©”ë‰´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ`);
            
            // í…ŒìŠ¤íŠ¸ìš© ê¸€ë¡œë²Œ í•¨ìˆ˜ ì¶”ê°€
            window.testSidebarMenu = function(contentType) {
                console.log(`ğŸ§ª í…ŒìŠ¤íŠ¸: ${contentType} ë©”ë‰´ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜`);
                const item = document.querySelector(`[data-content="${contentType}"]`);
                if (item) {
                    item.click();
                } else {
                    console.error(`âŒ ${contentType} ë©”ë‰´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
                }
            };
            
            // ê°•ì œë¡œ ë©”ë‰´ ì‘ë™ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
            window.forceMenuClick = function(contentType) {
                console.log(`ğŸš€ ê°•ì œ ë©”ë‰´ ì‹¤í–‰: ${contentType}`);
                try {
                    loadContent(contentType);
                } catch (error) {
                    console.error('ê°•ì œ ë©”ë‰´ ì‹¤í–‰ ì‹¤íŒ¨:', error);
                }
            };
            
            // ë””ë²„ê¹…ìš©: ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í™•ì¸
            window.checkMenuListeners = function() {
                const items = document.querySelectorAll('.sidebar-item[data-content]');
                console.log(`ğŸ” ì´ ë©”ë‰´ ì•„ì´í…œ: ${items.length}ê°œ`);
                items.forEach((item, index) => {
                    const listeners = getEventListeners ? getEventListeners(item) : 'DevTools í•„ìš”';
                    console.log(`ë©”ë‰´ ${index + 1} (${item.getAttribute('data-content')}):`, listeners);
                });
            };
        }

        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ (Django API ê¸°ë°˜)
        async function checkAdminPermission() {
            try {
                const response = await window.ahpApi.getCurrentUser();
                if (response.success && response.user) {
                    return response.user.role === 'admin' || response.user.is_superuser;
                }
                return false;
            } catch (error) {
                console.error('ê¶Œí•œ í™•ì¸ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ (ì—„ê²©í•œ ë³´ì•ˆ ì²´í¬)
        async function checkLoginStatus() {
            console.log('ğŸ” ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì‹œì‘');
            
            // ìºì‹œëœ ì •ë³´ê°€ ìˆì–´ë„ ì²« ë¡œë“œì‹œì—” ë°˜ë“œì‹œ ì„œë²„ í™•ì¸
            if (!window.sessionChecked) {
                console.log('âš ï¸ ì²« ë¡œë“œ - ì„œë²„ ì¸ì¦ í•„ìˆ˜ í™•ì¸');
                window.currentUser = null; // ìºì‹œ ì´ˆê¸°í™”
            } else if (window.currentUser) {
                console.log('âœ… ì„¸ì…˜ ì´ë¯¸ í™•ì¸ë¨');
                return true;
            }
            
            // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì„¤ì •
            let retryCount = 0;
            const maxRetries = 1;
            
            while (retryCount < maxRetries) {
                try {
                    // API ì„œë¹„ìŠ¤ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
                    if (typeof window.ahpApi === 'undefined') {
                        console.error('âŒ API ì„œë¹„ìŠ¤ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                        await new Promise(resolve => setTimeout(resolve, 1000)); // 1ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
                        if (typeof window.ahpApi === 'undefined') {
                            console.warn('API ì„œë¹„ìŠ¤ ë¡œë“œ ì‹¤íŒ¨ - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í•„ìš”í•  ìˆ˜ ìˆìŒ');
                            return false;
                        }
                    }
                    
                    const response = await window.ahpApi.getCurrentUser();
                    
                    if (!response || !response.success || !response.user) {
                        console.error('âŒ ì¸ì¦ ì‹¤íŒ¨ - ì„¸ì…˜ ì—†ìŒ');
                        // ì¦‰ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì¬ì‹œë„ ì—†ìŒ)
                        return false;
                    }
                    
                    // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
                    if (response.user.role !== 'admin' && !response.user.is_superuser) {
                        console.warn('âŒ ê´€ë¦¬ì ê¶Œí•œ ë¶€ì¡±');
                        alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        window.location.href = 'personal-service-enhanced.html';
                        return false;
                    }
                    
                    // ì‚¬ìš©ì ì •ë³´ ìºì‹±
                    window.currentUser = response.user;
                    
                    // ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì—…ë°ì´íŠ¸
                    updateUserInfo(response.user);
                    
                    console.log('âœ… ì‚¬ìš©ì ì •ë³´ ë° ì¸í„°í˜ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    
                    // ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ (ê¸°ì¡´ í˜¸í™˜ì„±)
                    const userNameElement = document.querySelector('.header-user .user-name');
                    if (userNameElement && response.user.name) {
                        userNameElement.textContent = response.user.name;
                    }
                    
                    console.log('âœ… ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì™„ë£Œ:', response.user.email || response.user.username);
                    return true;
                    
                } catch (error) {
                    console.error('âŒ ì¸ì¦ í™•ì¸ ì˜¤ë¥˜:', error);
                    // ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì°¨ë‹¨ (ë³´ì•ˆ ìš°ì„ )
                    return false;
                }
            }
            
            return false;
        }

        // ì‚¬ì´ë“œë°” í† ê¸€
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('toggle-icon');
            
            sidebar.classList.toggle('collapsed');
            toggleIcon.textContent = sidebar.classList.contains('collapsed') ? 'â–¶' : 'â—€';
        }

        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”©
        async function loadDashboardData() {
            try {
                // ë³‘ë ¬ë¡œ ë°ì´í„° ë¡œë”©
                await Promise.all([
                    loadSystemStats(),
                    loadRecentActivity()
                ]);
            } catch (error) {
                console.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
            }
        }

        // ì‹œìŠ¤í…œ í†µê³„ ë°ì´í„° ë¡œë”© (ê°•í™”ëœ retry ë¡œì§)
        async function loadSystemStats() {
            const maxRetries = 3;
            let currentTry = 0;
            
            while (currentTry < maxRetries) {
                try {
                    console.log(`ğŸ”„ Django API í˜¸ì¶œ ì‹œë„ ${currentTry + 1}/${maxRetries}`);
                    
                    const response = await fetch(`https://ahp-django-backend.onrender.com/super-admin/api/dashboard/stats/?_t=${Date.now()}`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        cache: 'no-cache'
                    });

                    if (response.ok) {
                        const stats = await response.json();
                        console.log('âœ… Django PostgreSQL ë°ì´í„° ë¡œë“œ ì„±ê³µ:', stats);
                        updateSystemStats(stats);
                        return; // ì„±ê³µì‹œ ì¢…ë£Œ
                    } else if (response.status === 403) {
                        console.warn(`âš ï¸ 403 Forbidden - Render ì—…ë°ì´íŠ¸ ì¤‘... (ì‹œë„ ${currentTry + 1})`);
                        if (currentTry < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, 2000 * (currentTry + 1))); // ì ì§„ì  ì§€ì—°
                        }
                    } else {
                        console.error('API ì˜¤ë¥˜:', response.status, response.statusText);
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    console.error(`ì‹œë„ ${currentTry + 1} ì‹¤íŒ¨:`, error);
                    if (currentTry < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, 1000 * (currentTry + 1)));
                    }
                }
                currentTry++;
            }
            
            // ëª¨ë“  ì‹œë„ ì‹¤íŒ¨ì‹œ fallback ë°ì´í„°
            console.warn('ğŸ”„ ëª¨ë“  API ì‹œë„ ì‹¤íŒ¨ - Render ì—…ë°ì´íŠ¸ ëŒ€ê¸° ì¤‘');
            updateSystemStats({
                total_users: 'Render ì—…ë°ì´íŠ¸ ì¤‘...',
                active_projects: 'Django ì¬ì‹œì‘ ì¤‘...', 
                system_performance: 'ë°±ì—”ë“œ ë¡œë”© ì¤‘...',
                storage_usage: 'ë°ì´í„° ì¤€ë¹„ ì¤‘...'
            });
        }

        // ì‹œìŠ¤í…œ í†µê³„ ì—…ë°ì´íŠ¸
        function updateSystemStats(stats) {
            console.log('ğŸ“Š ì‹¤ì œ Django ë°±ì—”ë“œ ë°ì´í„°:', stats);
            
            // ì‹¤ì œ PostgreSQL ë°ì´í„° í‘œì‹œ
            document.getElementById('totalUsers').textContent = stats.total_users || '0';
            document.getElementById('activeProjects').textContent = stats.active_projects || '0';
            document.getElementById('systemPerformance').textContent = stats.system_performance ? `${stats.system_performance}%` : 'ì •ìƒ';
            document.getElementById('storageUsage').textContent = stats.storage_usage ? `${stats.storage_usage}%` : 'ì •ìƒ';

            // Django ê³„ì‚°ëœ ì‹¤ì œ ì¦ê°€ìœ¨ í‘œì‹œ
            document.getElementById('userChange').textContent = stats.user_growth ? `â†‘ +${stats.user_growth}% (ì´ë²ˆ ë‹¬)` : 'ì‹¤ì‹œê°„ PostgreSQL ë°ì´í„°';
            document.getElementById('projectChange').textContent = stats.project_growth ? `â†‘ +${stats.project_growth}% (ì´ë²ˆ ì£¼)` : 'ì‹¤ì‹œê°„ Django í†µê³„';
            document.getElementById('performanceStatus').textContent = stats.performance_status || 'ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™';
            document.getElementById('storageStatus').textContent = stats.storage_status || 'ì—¬ìœ  ê³µê°„ ì¶©ë¶„';
            
            // Django ë°±ì—”ë“œ ì„±ê³µ í‘œì‹œ
            const statusEl = document.querySelector('.admin-card-value');
            if (statusEl) {
                statusEl.style.color = '#10b981'; // ë…¹ìƒ‰ìœ¼ë¡œ ì„±ê³µ í‘œì‹œ
            }
        }

        // ìµœê·¼ í™œë™ ë°ì´í„° ë¡œë”©
        async function loadRecentActivity() {
            try {
                const response = await fetch(`https://ahp-django-backend.onrender.com/super-admin/api/audit/logs/?limit=5&_t=${Date.now()}`, {
                    credentials: 'include',
                    cache: 'no-cache'
                });

                if (response.ok) {
                    const activities = await response.json();
                    updateRecentActivity(activities.results || activities);
                } else {
                    updateRecentActivity([]);
                }
            } catch (error) {
                console.error('ìµœê·¼ í™œë™ ë¡œë”© ì‹¤íŒ¨:', error);
                updateRecentActivity([]);
            }
        }

        // ìµœê·¼ í™œë™ ì—…ë°ì´íŠ¸
        function updateRecentActivity(activities) {
            const activityList = document.getElementById('activityList');
            
            if (!activities || activities.length === 0) {
                activityList.innerHTML = `
                    <li class="activity-item">
                        <div class="activity-icon system">ğŸ“Š</div>
                        <div class="activity-content">
                            <div class="activity-title">ì•„ì§ í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
                            <div class="activity-time">ì„œë¹„ìŠ¤ ì‚¬ìš©ì´ ì‹œì‘ë˜ë©´ í™œë™ ë‚´ì—­ì´ í‘œì‹œë©ë‹ˆë‹¤</div>
                        </div>
                    </li>
                `;
                return;
            }

            const activityHtml = activities.map(activity => {
                const iconMap = {
                    'user_created': { icon: 'ğŸ‘¤', class: 'user' },
                    'project_created': { icon: 'ğŸ“Š', class: 'project' },
                    'system_backup': { icon: 'ğŸ’¾', class: 'system' },
                    'login_success': { icon: 'ğŸ”“', class: 'user' },
                    'admin_action': { icon: 'âš™ï¸', class: 'system' },
                    'security_alert': { icon: 'ğŸš¨', class: 'alert' }
                };

                const iconData = iconMap[activity.action_type] || { icon: 'ğŸ“‹', class: 'system' };

                return `
                    <li class="activity-item">
                        <div class="activity-icon ${iconData.class}">${iconData.icon}</div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.description || activity.action}</div>
                            <div class="activity-time">${formatTimeAgo(activity.timestamp || activity.created_at)}</div>
                        </div>
                    </li>
                `;
            }).join('');

            activityList.innerHTML = activityHtml;
        }

        // ì‹œê°„ ì°¨ì´ ê³„ì‚° 
        function formatTimeAgo(timestamp) {
            if (!timestamp) return 'ì‹œê°„ ë¶ˆëª…';
            
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
            if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
            if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
            return `${diffDays}ì¼ ì „`;
        }

        // ì‹¤ì‹œê°„ ì‚¬ìš©ì ë°ì´í„° ë¡œë”© - Django PostgreSQL ì§ì ‘ ì—°ë™
        async function loadRealUserData() {
            try {
                const response = await fetch('https://ahp-django-backend.onrender.com/api/users/list/', {
                    credentials: 'include'
                });

                if (response.ok) {
                    const userData = await response.json();
                    showUserDataModal(userData);
                } else {
                    alert('ì‚¬ìš©ì ë°ì´í„° ë¡œë”© ì‹¤íŒ¨. ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ìš©ì ë°ì´í„° ëª¨ë‹¬ í‘œì‹œ
        function showUserDataModal(data) {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="
                    position: fixed; 
                    top: 0; left: 0; 
                    width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.8); 
                    display: flex; 
                    justify-content: center; 
                    align-items: center;
                    z-index: 10000;
                " onclick="this.remove()">
                    <div style="
                        background: white; 
                        padding: 2rem; 
                        border-radius: 12px; 
                        max-width: 800px; 
                        max-height: 80vh; 
                        overflow-y: auto;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                    " onclick="event.stopPropagation()">
                        <h2>ğŸ”¥ ì‹¤ì‹œê°„ PostgreSQL ì‚¬ìš©ì ë°ì´í„°</h2>
                        <div style="margin-bottom: 1rem;">
                            <strong>ì´ ì‚¬ìš©ì:</strong> ${data.total || 0}ëª…<br>
                            <strong>í™œì„± ì‚¬ìš©ì:</strong> ${data.stats?.active_users || 0}ëª…<br>
                            <strong>ê´€ë¦¬ì:</strong> ${data.stats?.staff_users || 0}ëª…<br>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${data.users ? data.users.map(user => `
                                <div style="
                                    border: 1px solid #eee; 
                                    padding: 1rem; 
                                    margin: 0.5rem 0; 
                                    border-radius: 8px;
                                    background: #f9f9f9;
                                ">
                                    <strong>${user.email}</strong> (${user.username})<br>
                                    <small>
                                        íƒ€ì…: ${user.user_type} | 
                                        êµ¬ë…: ${user.subscription_tier} | 
                                        ê°€ì…ì¼: ${new Date(user.date_joined).toLocaleDateString('ko-KR')}
                                        ${user.last_login ? ` | ìµœì¢…ë¡œê·¸ì¸: ${new Date(user.last_login).toLocaleDateString('ko-KR')}` : ''}
                                    </small>
                                </div>
                            `).join('') : 'ë°ì´í„° ì—†ìŒ'}
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')" 
                                style="
                                    background: #C8A968; 
                                    color: white; 
                                    border: none; 
                                    padding: 0.7rem 1.5rem; 
                                    border-radius: 6px; 
                                    cursor: pointer;
                                    margin-right: 1rem;
                                ">Django ê´€ë¦¬ì íŒ¨ë„</button>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="
                                    background: #6b7280; 
                                    color: white; 
                                    border: none; 
                                    padding: 0.7rem 1.5rem; 
                                    border-radius: 6px; 
                                    cursor: pointer;
                                ">ë‹«ê¸°</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // SPA ì½˜í…ì¸  ë¡œë”© í•¨ìˆ˜ (ì„¸ì…˜ ì²´í¬ ê°•í™”)
        async function loadContent(contentType, clickedElement = null) {
            console.log(`ğŸ”„ ì½˜í…ì¸  ë¡œë”© ì‹œì‘: ${contentType}`);
            console.log(`ğŸ“ í´ë¦­ëœ ìš”ì†Œ:`, clickedElement);
            
            // ì´ë²¤íŠ¸ ê¸°ë³¸ ë™ì‘ ë°©ì§€
            if (typeof event !== 'undefined' && event) {
                event.preventDefault();
                event.stopPropagation();
                console.log('ğŸ›¡ï¸ ì´ë²¤íŠ¸ ê¸°ë³¸ ë™ì‘ ë°©ì§€ë¨');
            }
            
            // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            if (window.loadContentInProgress) {
                console.log('â¸ï¸ ì´ë¯¸ ì½˜í…ì¸  ë¡œë”© ì¤‘ - ê±´ë„ˆëœ€');
                return;
            }
            window.loadContentInProgress = true;
            console.log('ğŸš€ ì½˜í…ì¸  ë¡œë”© í”Œë˜ê·¸ ì„¤ì •ë¨');
            
            // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ (ë§¤ë²ˆ ì²´í¬)
            if (!window.currentUser) {
                console.error('âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                window.loadContentInProgress = false;
                return;
            }
            
            // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
            if (window.currentUser.role !== 'admin' && !window.currentUser.is_superuser) {
                console.error('âŒ ê¶Œí•œ ì—†ìŒ - ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥');
                alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'personal-service-enhanced.html';
                window.loadContentInProgress = false;
                return;
            }
            
            // í—¤ë”ì™€ ì‚¬ì´ë“œë°” ê°€ì‹œì„± ë³´ì¥
            const header = document.querySelector('.header');
            const sidebar = document.querySelector('.sidebar');
            if (header) {
                header.style.display = 'flex';
                header.style.position = 'fixed';
                header.style.top = '0';
                header.style.left = '0';
                header.style.right = '0';
                header.style.zIndex = '1000';
                console.log('ğŸ” í—¤ë” í‘œì‹œ ë³´ì¥ë¨');
            }
            if (sidebar) {
                sidebar.style.display = 'flex';
                sidebar.style.position = 'fixed';
                sidebar.style.left = '0';
                sidebar.style.top = 'var(--header-height)';
                sidebar.style.zIndex = '999';
                console.log('ğŸ“‹ ì‚¬ì´ë“œë°” í‘œì‹œ ë³´ì¥ë¨');
            }

            const mainContent = document.querySelector('.main-content');
            console.log('ğŸ¯ ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ ì°¾ê¸°:', mainContent);
            
            if (!mainContent) {
                console.error('âŒ ë©”ì¸ ì½˜í…ì¸  ì˜ì—­(.main-content)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                window.loadContentInProgress = false;
                return;
            }
            
            // ë©”ì¸ ì½˜í…ì¸  ìœ„ì¹˜ ë³´ì¥ (í—¤ë”/ì‚¬ì´ë“œë°” ê³ ë ¤)
            mainContent.style.marginLeft = 'var(--sidebar-width)';
            mainContent.style.marginTop = 'var(--header-height)';
            mainContent.style.position = 'relative';
            console.log('ğŸ“ ë©”ì¸ ì½˜í…ì¸  ìœ„ì¹˜ ì¡°ì •ë¨');
            
            // ë¡œë”© í‘œì‹œ
            console.log('â³ ë¡œë”© í™”ë©´ í‘œì‹œ ì¤‘...');
            mainContent.innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 50vh;">
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ”„</div>
                        <div>ì½˜í…ì¸ ë¥¼ ë¡œë“œí•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
                        <div style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">íƒ€ì…: ${contentType}</div>
                    </div>
                </div>
            `;

            try {
                console.log(`ğŸ“ ì½˜í…ì¸  íƒ€ì…ë³„ ìƒì„± ì‹œì‘: ${contentType}`);
                
                // ê° ì½˜í…ì¸  íƒ€ì…ì— ë”°ë¥¸ ë‚´ìš© ìƒì„±
                let content = '';
                
                switch(contentType) {
                    case 'dashboard':
                        console.log('ğŸ  ëŒ€ì‹œë³´ë“œ ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateDashboardContent();
                        break;
                    case 'user-management':
                        console.log('ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬ ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateUserManagementContent();
                        break;
                    case 'project-overview':
                        console.log('ğŸ“Š í”„ë¡œì íŠ¸ í˜„í™© ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateProjectOverviewContent();
                        break;
                    case 'system-settings':
                        console.log('âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì • ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateSystemSettingsContent();
                        break;
                    case 'audit-log':
                        console.log('ğŸ“‹ ê°ì‚¬ ë¡œê·¸ ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateAuditLogContent();
                        break;
                    case 'backup-restore':
                        console.log('ğŸ’¾ ë°±ì—… ë° ë³µì› ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateBackupRestoreContent();
                        break;
                    case 'database-management':
                        console.log('ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateDatabaseManagementContent();
                        break;
                    case 'data-migration':
                        console.log('ğŸ“¤ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateDataMigrationContent();
                        break;
                    case 'security-settings':
                        console.log('ğŸ”’ ë³´ì•ˆ ì„¤ì • ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateSecuritySettingsContent();
                        break;
                    case 'access-control':
                        console.log('ğŸ›¡ï¸ ì ‘ê·¼ ì œì–´ ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateAccessControlContent();
                        break;
                    case 'security-log':
                        console.log('ğŸš¨ ë³´ì•ˆ ë¡œê·¸ ì½˜í…ì¸  ìƒì„± ì¤‘...');
                        content = await generateSecurityLogContent();
                        break;
                    default:
                        console.log('â“ ì•Œ ìˆ˜ ì—†ëŠ” ì½˜í…ì¸  íƒ€ì… - ê¸°ë³¸ ëŒ€ì‹œë³´ë“œë¡œ fallback');
                        content = await generateDashboardContent();
                }
                
                console.log(`ğŸ“„ ì½˜í…ì¸  ìƒì„± ì™„ë£Œ, HTML ê¸¸ì´: ${content.length} ë¬¸ì`);
                console.log(`ğŸ¨ ì½˜í…ì¸  ë¯¸ë¦¬ë³´ê¸°: ${content.substring(0, 200)}...`);
                
                if (!content || content.trim().length === 0) {
                    console.error('âŒ ë¹ˆ ì½˜í…ì¸ ê°€ ìƒì„±ë¨!');
                    content = `
                        <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px; margin: 1rem;">
                            <h2 style="color: #dc2626; margin-bottom: 1rem;">âš ï¸ ì½˜í…ì¸  ë¡œë”© ì˜¤ë¥˜</h2>
                            <p style="color: #666; margin-bottom: 2rem;">${contentType} ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            <button onclick="window.location.reload()" style="background: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button>
                        </div>
                    `;
                }
                
                console.log('ğŸ–¼ï¸ ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ì— HTML ì‚½ì… ì¤‘...');
                mainContent.innerHTML = content;
                
                console.log('âœ… ì½˜í…ì¸  ì‚½ì… ì™„ë£Œ');
                console.log('ğŸ“ í˜„ì¬ ë©”ì¸ ì½˜í…ì¸  innerHTML:', mainContent.innerHTML.substring(0, 100) + '...');
                
                // ëŒ€ì‹œë³´ë“œì¸ ê²½ìš° ë°ì´í„° ë¡œë”©
                if (contentType === 'dashboard') {
                    console.log('ğŸ“Š ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì‹œì‘...');
                    await loadDashboardData();
                    console.log('ğŸ“Š ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì™„ë£Œ');
                }
                
                console.log(`âœ… ì½˜í…ì¸  ë¡œë”© ì™„ë£Œ: ${contentType}`);
                
            } catch (error) {
                console.error('âŒ ì½˜í…ì¸  ë¡œë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                console.error('âŒ ì˜¤ë¥˜ ìƒì„¸ ì •ë³´:', error.stack);
                
                const errorContent = `
                    <div style="text-align: center; color: #ef4444; padding: 2rem;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">âŒ</div>
                        <div>ì½˜í…ì¸  ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>
                        <div style="font-size: 0.9rem; color: #666; margin: 1rem 0;">ì˜¤ë¥˜: ${error.message}</div>
                        <button onclick="loadContent('dashboard', null)" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                `;
                
                console.log('ğŸ”„ ì˜¤ë¥˜ ì½˜í…ì¸  í‘œì‹œ ì¤‘...');
                mainContent.innerHTML = errorContent;
                
            } finally {
                // ë¡œë”© ìƒíƒœ í•´ì œ
                console.log('ğŸ ì½˜í…ì¸  ë¡œë”© í”Œë˜ê·¸ í•´ì œ');
                window.loadContentInProgress = false;
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì½˜í…ì¸  ìƒì„±
        async function generateDashboardContent() {
            return `
                ${generatePageHeader('ëŒ€ì‹œë³´ë“œ', 'ğŸ ', ['AHP ì‹œìŠ¤í…œ', 'ìŠˆí¼ ê´€ë¦¬ì', 'ëŒ€ì‹œë³´ë“œ'])}
                
                <!-- ëŒ€ì‹œë³´ë“œ í†µê³„ -->
                <div class="dashboard-grid">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div class="admin-card-title">
                                <span class="admin-card-icon">ğŸ‘¥</span>
                                ì´ ì‚¬ìš©ì
                            </div>
                        </div>
                        <div class="admin-card-value" id="totalUsers">ë¡œë”©...</div>
                        <div class="admin-card-change change-positive" id="userChange">
                            ë°ì´í„° ë¡œë”© ì¤‘...
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div class="admin-card-title">
                                <span class="admin-card-icon">ğŸ“Š</span>
                                í™œì„± í”„ë¡œì íŠ¸
                            </div>
                        </div>
                        <div class="admin-card-value" id="activeProjects">ë¡œë”©...</div>
                        <div class="admin-card-change change-positive" id="projectChange">
                            ë°ì´í„° ë¡œë”© ì¤‘...
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div class="admin-card-title">
                                <span class="admin-card-icon">âš¡</span>
                                ì‹œìŠ¤í…œ ì„±ëŠ¥
                            </div>
                        </div>
                        <div class="admin-card-value" id="systemPerformance">ë¡œë”©...</div>
                        <div class="admin-card-change change-positive" id="performanceStatus">
                            ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì¤‘...
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div class="admin-card-title">
                                <span class="admin-card-icon">ğŸ’¾</span>
                                ì €ì¥ì†Œ ì‚¬ìš©ë¥ 
                            </div>
                        </div>
                        <div class="admin-card-value" id="storageUsage">ë¡œë”©...</div>
                        <div class="admin-card-change change-positive" id="storageStatus">
                            ì €ì¥ì†Œ ìƒíƒœ í™•ì¸ ì¤‘...
                        </div>
                    </div>
                </div>

                <!-- ê´€ë¦¬ ì„¹ì…˜ -->
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">í•µì‹¬ ê´€ë¦¬ ê¸°ëŠ¥</h2>
                    </div>
                    <div class="management-grid">
                        <div class="management-card" onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')">
                            <div class="management-card-icon">ğŸ‘¥</div>
                            <div class="management-card-title">Django ìŠˆí¼ ê´€ë¦¬ì</div>
                            <div class="management-card-desc">
                                ğŸ”¥ ì‹¤ì œ PostgreSQL ì‚¬ìš©ì ê´€ë¦¬, ê²°ì œ ê´€ë¦¬, í”„ë¡œì íŠ¸ ê´€ë¦¬ - ì™„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ
                            </div>
                        </div>

                        <div class="management-card" onclick="loadRealUserData()">
                            <div class="management-card-icon">ğŸ“Š</div>
                            <div class="management-card-title">ì‹¤ì‹œê°„ ì‚¬ìš©ì í˜„í™©</div>
                            <div class="management-card-desc">
                                ğŸ”¥ PostgreSQL ì‹¤ì‹œê°„ ì‚¬ìš©ì ë°ì´í„°, ê°€ì… í˜„í™©, í™œë™ í†µê³„
                            </div>
                        </div>

                        <div class="management-card" onclick="loadContent('system-settings', null)">
                            <div class="management-card-icon">ğŸ“ˆ</div>
                            <div class="management-card-title">ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</div>
                            <div class="management-card-desc">
                                ì„œë²„ ì„±ëŠ¥, ë°ì´í„°ë² ì´ìŠ¤, API ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
                            </div>
                        </div>

                        <div class="management-card" onclick="loadContent('backup-restore', null)">
                            <div class="management-card-icon">ğŸ’¾</div>
                            <div class="management-card-title">ë°±ì—… ê´€ë¦¬</div>
                            <div class="management-card-desc">
                                ë°ì´í„° ë°±ì—…, ë³µì› ë° ì¬í•´ ë³µêµ¬ ê´€ë¦¬
                            </div>
                        </div>

                        <div class="management-card" onclick="loadContent('security-settings', null)">
                            <div class="management-card-icon">ğŸ”’</div>
                            <div class="management-card-title">ë³´ì•ˆ ì„¤ì •</div>
                            <div class="management-card-desc">
                                ì‹œìŠ¤í…œ ë³´ì•ˆ ì •ì±…, ì¸ì¦ ë° ì•”í˜¸í™” ì„¤ì •
                            </div>
                        </div>

                        <div class="management-card" onclick="loadContent('audit-log', null)">
                            <div class="management-card-icon">ğŸ“‹</div>
                            <div class="management-card-title">ë¶„ì„ ë¦¬í¬íŠ¸</div>
                            <div class="management-card-desc">
                                ì‚¬ìš©ì í™œë™, ì‹œìŠ¤í…œ ì‚¬ìš©ë¥  ë° ì„±ëŠ¥ ë¶„ì„
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ìµœê·¼ í™œë™ -->
                <div class="recent-activity">
                    <div class="section-header">
                        <h2 class="section-title">ìµœê·¼ ì‹œìŠ¤í…œ í™œë™</h2>
                    </div>
                    <ul class="activity-list" id="activityList">
                        <li class="activity-item">
                            <div class="activity-icon system">ğŸ“¡</div>
                            <div class="activity-content">
                                <div class="activity-title">ìµœê·¼ í™œë™ ë°ì´í„°ë¥¼ ë¡œë”©í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
                                <div class="activity-time">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
                            </div>
                        </li>
                    </ul>
                </div>
            `;
        }

        // ê³µí†µ í˜ì´ì§€ í—¤ë” ìƒì„±
        function generatePageHeader(title, icon, breadcrumb = []) {
            const breadcrumbHtml = breadcrumb.length > 0 
                ? `<div class="breadcrumb" style="margin-bottom: 1rem; color: #666;">
                     ${breadcrumb.map(item => `<span>${item}</span>`).join(' > ')}
                   </div>`
                : '';
                
            return `
                <div class="page-header" style="background: white; padding: 1.5rem 2rem; margin: -2rem -2rem 2rem -2rem; border-bottom: 1px solid #e5e7eb;">
                    ${breadcrumbHtml}
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <h1 style="font-size: 1.75rem; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 2rem;">${icon}</span>
                            ${title}
                        </h1>
                        <div class="page-actions">
                            <!-- í˜ì´ì§€ë³„ ì•¡ì…˜ ë²„íŠ¼ ì˜ì—­ -->
                        </div>
                    </div>
                </div>
            `;
        }

        // ì‚¬ìš©ì ê´€ë¦¬ ì½˜í…ì¸  ìƒì„±
        async function generateUserManagementContent() {
            return `
                ${generatePageHeader('ì‚¬ìš©ì ê´€ë¦¬', 'ğŸ‘¥', ['ëŒ€ì‹œë³´ë“œ', 'ì‹œìŠ¤í…œ ê´€ë¦¬', 'ì‚¬ìš©ì ê´€ë¦¬'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ì‚¬ìš©ì í˜„í™©</h2>
                        <button class="btn btn-primary" onclick="loadRealUserData()">ì‹¤ì‹œê°„ ì‚¬ìš©ì ì¡°íšŒ</button>
                    </div>
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                            <div style="text-align: center; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 2rem; color: #2563eb; margin-bottom: 0.5rem;" id="userStatsTotal">-</div>
                                <div style="color: #666;">ì´ ì‚¬ìš©ì</div>
                            </div>
                            <div style="text-align: center; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 2rem; color: #10b981; margin-bottom: 0.5rem;" id="userStatsActive">-</div>
                                <div style="color: #666;">í™œì„± ì‚¬ìš©ì</div>
                            </div>
                            <div style="text-align: center; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 2rem; color: #f59e0b; margin-bottom: 0.5rem;" id="userStatsAdmin">-</div>
                                <div style="color: #666;">ê´€ë¦¬ì</div>
                            </div>
                        </div>
                        <div style="text-align: center; color: #666; margin: 2rem 0;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”§</div>
                            <p>ì‚¬ìš©ì ê´€ë¦¬ëŠ” Django ê´€ë¦¬ì íŒ¨ë„ì—ì„œ ìˆ˜í–‰ë©ë‹ˆë‹¤</p>
                            <button onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')" 
                                    style="margin-top: 1rem; padding: 0.75rem 1.5rem; background: #C8A968; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                Django ê´€ë¦¬ì íŒ¨ë„ ì—´ê¸°
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ë‹¤ë¥¸ ì½˜í…ì¸  ìƒì„± í•¨ìˆ˜ë“¤ (í˜ì´ì§€ í—¤ë” ì ìš©)
        async function generateProjectOverviewContent() {
            return `
                ${generatePageHeader('í”„ë¡œì íŠ¸ í˜„í™©', 'ğŸ“Š', ['ëŒ€ì‹œë³´ë“œ', 'ì‹œìŠ¤í…œ ê´€ë¦¬', 'í”„ë¡œì íŠ¸ í˜„í™©'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">í™œì„± í”„ë¡œì íŠ¸ í†µê³„</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸš§</div>
                        <h3>í”„ë¡œì íŠ¸ í˜„í™© ê´€ë¦¬</h3>
                        <p style="color: #666; margin: 1rem 0;">í”„ë¡œì íŠ¸ í†µê³„ ë° ê´€ë¦¬ ê¸°ëŠ¥ì„ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateSystemSettingsContent() {
            return `
                ${generatePageHeader('ì‹œìŠ¤í…œ ì„¤ì •', 'âš™ï¸', ['ëŒ€ì‹œë³´ë“œ', 'ì‹œìŠ¤í…œ ê´€ë¦¬', 'ì‹œìŠ¤í…œ ì„¤ì •'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ì„œë²„ ëª¨ë‹ˆí„°ë§</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">âš™ï¸</div>
                        <h3>ì‹œìŠ¤í…œ ì„¤ì • ê´€ë¦¬</h3>
                        <p style="color: #666; margin: 1rem 0;">ì‹œìŠ¤í…œ ì„¤ì • ë° ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ì„ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateAuditLogContent() {
            return `
                ${generatePageHeader('ê°ì‚¬ ë¡œê·¸', 'ğŸ“‹', ['ëŒ€ì‹œë³´ë“œ', 'ì‹œìŠ¤í…œ ê´€ë¦¬', 'ê°ì‚¬ ë¡œê·¸'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ì‹œìŠ¤í…œ í™œë™ ê¸°ë¡</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“‹</div>
                        <h3>ê°ì‚¬ ë¡œê·¸ ê´€ë¦¬</h3>
                        <p style="color: #666; margin: 1rem 0;">ì‹œìŠ¤í…œ ê°ì‚¬ ë¡œê·¸ ë° í™œë™ ì¶”ì  ê¸°ëŠ¥ì„ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateBackupRestoreContent() {
            return `
                ${generatePageHeader('ë°±ì—… ë° ë³µì›', 'ğŸ’¾', ['ëŒ€ì‹œë³´ë“œ', 'ë°ì´í„° ê´€ë¦¬', 'ë°±ì—… ë° ë³µì›'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ë°ì´í„° ë°±ì—… ê´€ë¦¬</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ’¾</div>
                        <h3>ë°±ì—… ë° ë³µì› ê´€ë¦¬</h3>
                        <p style="color: #666; margin: 1rem 0;">ë°ì´í„° ë°±ì—… ë° ë³µì› ê¸°ëŠ¥ì„ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateDatabaseManagementContent() {
            return `
                ${generatePageHeader('ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬', 'ğŸ—„ï¸', ['ëŒ€ì‹œë³´ë“œ', 'ë°ì´í„° ê´€ë¦¬', 'ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">PostgreSQL ê´€ë¦¬</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ—„ï¸</div>
                        <h3>ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬</h3>
                        <p style="color: #666; margin: 1rem 0;">PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ê¸°ëŠ¥ì„ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateDataMigrationContent() {
            return `
                ${generatePageHeader('ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜', 'ğŸ“¤', ['ëŒ€ì‹œë³´ë“œ', 'ë°ì´í„° ê´€ë¦¬', 'ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ë°ì´í„° ì´ì „ ë° ì „ì†¡</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¤</div>
                        <h3>ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜</h3>
                        <p style="color: #666; margin: 1rem 0;">ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ì „ì†¡ ê¸°ëŠ¥ì„ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateSecuritySettingsContent() {
            return `
                ${generatePageHeader('ë³´ì•ˆ ì„¤ì •', 'ğŸ”’', ['ëŒ€ì‹œë³´ë“œ', 'ë³´ì•ˆ ê´€ë¦¬', 'ë³´ì•ˆ ì„¤ì •'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ì‹œìŠ¤í…œ ë³´ì•ˆ ì •ì±…</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”’</div>
                        <h3>ë³´ì•ˆ ì„¤ì • ê´€ë¦¬</h3>
                        <p style="color: #666; margin: 1rem 0;">ì‹œìŠ¤í…œ ë³´ì•ˆ ì„¤ì • ë° ì •ì±… ê´€ë¦¬ ê¸°ëŠ¥ì„ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateAccessControlContent() {
            return `
                ${generatePageHeader('ì ‘ê·¼ ì œì–´', 'ğŸ›¡ï¸', ['ëŒ€ì‹œë³´ë“œ', 'ë³´ì•ˆ ê´€ë¦¬', 'ì ‘ê·¼ ì œì–´'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ›¡ï¸</div>
                        <h3>ì ‘ê·¼ ì œì–´ ê´€ë¦¬</h3>
                        <p style="color: #666; margin: 1rem 0;">ì‚¬ìš©ì ê¶Œí•œ ë° ì ‘ê·¼ ì œì–´ ê¸°ëŠ¥ì„ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateSecurityLogContent() {
            return `
                ${generatePageHeader('ë³´ì•ˆ ë¡œê·¸', 'ğŸš¨', ['ëŒ€ì‹œë³´ë“œ', 'ë³´ì•ˆ ê´€ë¦¬', 'ë³´ì•ˆ ë¡œê·¸'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì </h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸš¨</div>
                        <h3>ë³´ì•ˆ ë¡œê·¸ ê´€ë¦¬</h3>
                        <p style="color: #666; margin: 1rem 0;">ë³´ì•ˆ ì´ë²¤íŠ¸ ë¡œê·¸ ë° ì•Œë¦¼ ê¸°ëŠ¥ì„ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        // ê°œì¸ ì„œë¹„ìŠ¤ ëª¨ë“œë¡œ ì „í™˜
        function switchToPersonalService() {
            if (!window.currentUser || !window.currentUser.is_superuser) {
                alert('ìŠˆí¼ ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (confirm('ê°œì¸ ì„œë¹„ìŠ¤ ëª¨ë“œë¡œ ì „í™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                console.log('ğŸ‘¤ ê°œì¸ ì„œë¹„ìŠ¤ ëª¨ë“œë¡œ ì „í™˜ ì¤‘...');
                window.location.href = './personal-service-enhanced.html';
            }
        }

        // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ (ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì „ìš©)
        function updateUserInfo(user) {
            const userName = document.getElementById('userName');
            const userRoleText = document.getElementById('userRoleText');
            const adminBadge = document.getElementById('adminBadge');
            const userAvatar = document.getElementById('userAvatar');

            if (userName) {
                userName.textContent = user.name || user.username || 'ê´€ë¦¬ì';
            }

            if (userRoleText) {
                let roleText = 'System Admin';
                if (user.is_superuser) {
                    roleText = 'Super Admin';
                } else if (user.is_staff) {
                    roleText = 'Staff Admin';
                } else if (user.role === 'admin') {
                    roleText = 'Admin';
                }
                userRoleText.textContent = roleText;
            }

            // ê´€ë¦¬ì ë°°ì§€ í‘œì‹œ
            if (adminBadge) {
                if (user.is_superuser) {
                    adminBadge.textContent = 'ğŸ›¡ï¸ ìŠˆí¼ ê´€ë¦¬ì';
                    adminBadge.style.display = 'inline-block';
                } else if (user.is_staff || user.role === 'admin') {
                    adminBadge.textContent = 'ğŸ›¡ï¸ ê´€ë¦¬ì';
                    adminBadge.style.display = 'inline-block';
                } else {
                    adminBadge.style.display = 'none';
                }
            }

            if (userAvatar) {
                const name = user.name || user.username || 'ê´€ë¦¬ì';
                userAvatar.textContent = name.charAt(0).toUpperCase();
                
                // ìŠˆí¼ ê´€ë¦¬ìëŠ” ë ˆë“œ ë°°ê²½, ì¼ë°˜ ê´€ë¦¬ìëŠ” ê³¨ë“œ ë°°ê²½
                if (user.is_superuser) {
                    userAvatar.style.background = 'linear-gradient(135deg, #dc2626, #b91c1c)';
                } else if (user.is_staff || user.role === 'admin') {
                    userAvatar.style.background = 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))';
                } else {
                    userAvatar.style.background = '#6b7280';
                }
            }

            // ê°œì¸ ì„œë¹„ìŠ¤ í† ê¸€ ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€ ê²°ì • (ìŠˆí¼ ê´€ë¦¬ìë§Œ)
            const personalServiceToggle = document.getElementById('personalServiceToggle');
            if (personalServiceToggle && user.is_superuser) {
                personalServiceToggle.style.display = 'block';
                console.log('âœ… ìŠˆí¼ ê´€ë¦¬ì - ê°œì¸ ì„œë¹„ìŠ¤ í† ê¸€ ë²„íŠ¼ í‘œì‹œ');
            } else if (personalServiceToggle) {
                personalServiceToggle.style.display = 'none';
                console.log('âŒ ì¼ë°˜ ê´€ë¦¬ì - ê°œì¸ ì„œë¹„ìŠ¤ í† ê¸€ ë²„íŠ¼ ìˆ¨ê¹€');
            }
        }

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í›„ ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ í˜¸ì¶œ
        async function initializeUserInterface() {
            try {
                const user = window.currentUser;
                if (user) {
                    updateUserInfo(user);
                    console.log('ğŸ¨ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ');
                }
            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            }
        }

        // ë¡œê·¸ì•„ì›ƒ (Django API ê¸°ë°˜)
        async function handleLogout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    // ìºì‹œëœ ì‚¬ìš©ì ì •ë³´ ì œê±°
                    window.currentUser = null;
                    window.sessionChecked = false;
                    
                    await window.ahpApi.logout();
                    window.location.href = 'login.html?message=logout';
                } catch (error) {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                    window.location.href = 'login.html';
                }
            }
        }
    </script>
</body>
</html>