<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - ìŒëŒ€ë¹„êµ</title>
    <link rel="stylesheet" href="styles/layout.css">
    <style>
        :root {
            --accent-primary: #C8A968;
            --accent-secondary: #A98C4B;
            --accent-light: #E5D5AA;
            --accent-hover: #B59A4D;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s;
            font-size: 0.9rem;
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .status-bar {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-light);
        }

        .progress-bar {
            background: var(--border-light);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .comparison-container {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-light);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
        }

        .comparison-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .criteria-title {
            background: var(--accent-primary);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .comparison-question {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2rem;
            text-align: center;
        }

        .alternatives-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0;
        }

        .alternative-box {
            background: var(--bg-primary);
            border: 2px solid var(--accent-light);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            flex: 0 0 200px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .alternative-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .alternative-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .vs-indicator {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-primary);
        }

        .scale-selector {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 0.5rem;
            margin: 2rem 0;
            padding: 1rem;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--border-light);
        }

        .scale-option {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 6px;
            padding: 1rem 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .scale-option:hover {
            border-color: var(--accent-light);
            background: var(--accent-light);
        }

        .scale-option.selected {
            border-color: var(--accent-primary);
            background: var(--accent-primary);
            color: white;
        }

        .scale-value {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.2rem;
        }

        .scale-label {
            font-size: 0.75rem;
            line-height: 1.2;
        }

        .scale-description {
            text-align: center;
            margin: 1rem 0;
            padding: 1rem;
            background: var(--accent-light);
            border-radius: 8px;
            color: var(--text-primary);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .comparison-progress {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
            border: 1px solid var(--border-light);
        }

        .btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(200, 169, 104, 0.4);
        }

        .btn-secondary {
            background: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--text-primary);
        }

        .btn:disabled {
            background: var(--border-light);
            color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .matrix-preview {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 2px dashed var(--accent-light);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .matrix-table th,
        .matrix-table td {
            padding: 0.75rem;
            text-align: center;
            border: 1px solid var(--border-light);
            background: white;
        }

        .matrix-table th {
            background: var(--accent-light);
            color: var(--accent-primary);
            font-weight: 600;
        }

        .consistency-info {
            background: var(--accent-light);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .error {
            background: #fef2f2;
            color: var(--error);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .success {
            background: #f0fdf4;
            color: var(--success);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .alternatives-display {
                flex-direction: column;
                gap: 1rem;
            }
            
            .alternative-box {
                flex: none;
                width: 100%;
            }
            
            .vs-indicator {
                transform: rotate(90deg);
            }
            
            .scale-selector {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="header">
        <div class="header-left">
            <a href="./personal-service-enhanced.html" class="logo">
                <div class="logo-icon">A</div>
                <span>AHP System</span>
            </a>
            <nav class="header-nav">
                <a href="./personal-service-enhanced.html" class="header-nav-item" data-page="dashboard">ëŒ€ì‹œë³´ë“œ</a>
                <a href="./project-management.html" class="header-nav-item" data-page="projects">í”„ë¡œì íŠ¸</a>
                <a href="./results-analysis.html" class="header-nav-item" data-page="analysis">ë¶„ì„</a>
                <a href="#" class="header-nav-item" data-page="reports">ë³´ê³ ì„œ</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">ê¹€</div>
                <div>
                    <div class="user-name">ê¹€ì² ìˆ˜</div>
                    <div class="user-role">Personal Admin</div>
                </div>
            </div>
            <button onclick="handleLogout()" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </header>

    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-section-title">í”„ë¡œì íŠ¸ ê´€ë¦¬</div>
            <div class="sidebar-menu">
                <a href="./project-management.html" class="sidebar-item" data-menu="my-projects">
                    <span class="sidebar-icon">ğŸ“‹</span>
                    <span>ë‚´ í”„ë¡œì íŠ¸</span>
                    <span class="sidebar-badge">3</span>
                </a>
                <a href="./project-management.html" class="sidebar-item" data-menu="new-project">
                    <span class="sidebar-icon">â•</span>
                    <span>ìƒˆ í”„ë¡œì íŠ¸</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="trash">
                    <span class="sidebar-icon">ğŸ—‘ï¸</span>
                    <span>íœ´ì§€í†µ</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ëª¨ë¸ êµ¬ì¶•</div>
            <div class="sidebar-menu">
                <a href="./criteria-management.html" class="sidebar-item" data-menu="criteria">
                    <span class="sidebar-icon">âš–ï¸</span>
                    <span>ê¸°ì¤€ ì„¤ì •</span>
                </a>
                <a href="./alternatives-management.html" class="sidebar-item" data-menu="alternatives">
                    <span class="sidebar-icon">ğŸ”„</span>
                    <span>ëŒ€ì•ˆ ê´€ë¦¬</span>
                </a>
                <a href="./pairwise-comparison.html" class="sidebar-item active" data-menu="comparison">
                    <span class="sidebar-icon">âš¡</span>
                    <span>ìŒëŒ€ë¹„êµ</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="evaluators">
                    <span class="sidebar-icon">ğŸ‘¥</span>
                    <span>í‰ê°€ì ê´€ë¦¬</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ë¶„ì„ ë° ê²°ê³¼</div>
            <div class="sidebar-menu">
                <a href="./results-analysis.html" class="sidebar-item" data-menu="results">
                    <span class="sidebar-icon">ğŸ“ˆ</span>
                    <span>ê²°ê³¼ ë¶„ì„</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="monitoring">
                    <span class="sidebar-icon">ğŸ“Š</span>
                    <span>ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="reports">
                    <span class="sidebar-icon">ğŸ“„</span>
                    <span>ë³´ê³ ì„œ ìƒì„±</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="sensitivity">
                    <span class="sidebar-icon">ğŸ”</span>
                    <span>ë¯¼ê°ë„ ë¶„ì„</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ì„¤ì •</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-menu="settings">
                    <span class="sidebar-icon">âš™ï¸</span>
                    <span>ê°œì¸ ì„¤ì •</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="billing">
                    <span class="sidebar-icon">ğŸ’³</span>
                    <span>ìš”ê¸ˆì œ ê´€ë¦¬</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="guide">
                    <span class="sidebar-icon">ğŸ“š</span>
                    <span>ì‚¬ìš© ê°€ì´ë“œ</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <span id="toggle-icon">â—€</span>
    </button>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <div class="status-bar">
            <div>
                <strong>Django ë°±ì—”ë“œ:</strong> <span id="backend-status">ì—°ê²° í™•ì¸ì¤‘...</span>
            </div>
            <div>
                <strong>í˜„ì¬ í”„ë¡œì íŠ¸:</strong> <span id="current-project">í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            </div>
            <div>
                <strong>ë‹¨ê³„:</strong> <span style="color: var(--accent-primary);">4ë‹¨ê³„ - ìŒëŒ€ë¹„êµ</span>
            </div>
        </div>

        <!-- AHP ì§„í–‰ ìƒí™© -->
        <div class="section">
            <h2 class="section-title">ğŸ“Š AHP ì§„í–‰ ìƒí™©</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="ahp-progress" style="width: 75%;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">
                <span>í”„ë¡œì íŠ¸ ìƒì„±</span>
                <span>ê¸°ì¤€ ì„¤ì •</span>
                <span>ëŒ€ì•ˆ ì…ë ¥</span>
                <span style="color: var(--accent-primary); font-weight: 600;">ìŒëŒ€ë¹„êµ</span>
                <span>ê²°ê³¼ ë¶„ì„</span>
            </div>
        </div>

        <!-- ìŒëŒ€ë¹„êµ ê°€ì´ë“œ -->
        <div class="section">
            <h2 class="section-title">ğŸ“‹ ìŒëŒ€ë¹„êµ ê°€ì´ë“œ</h2>
            <div style="background: var(--accent-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">âš–ï¸ Saatyì˜ 9ì  ì²™ë„</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div style="background: white; padding: 1rem; border-radius: 6px;">
                        <strong>1ì :</strong> ë™ë“±í•˜ê²Œ ì¤‘ìš”
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 6px;">
                        <strong>3ì :</strong> ì•½ê°„ ë” ì¤‘ìš”
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 6px;">
                        <strong>5ì :</strong> ìƒë‹¹íˆ ë” ì¤‘ìš”
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 6px;">
                        <strong>7ì :</strong> ë§¤ìš° ë” ì¤‘ìš”
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 6px;">
                        <strong>9ì :</strong> ê·¹ë„ë¡œ ë” ì¤‘ìš”
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¹„êµ ì§„í–‰ ìƒí™© -->
        <div class="section" id="comparison-progress-section">
            <h2 class="section-title">ğŸ“ˆ ë¹„êµ ì§„í–‰ ìƒí™©</h2>
            <div class="comparison-progress">
                <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">
                    í˜„ì¬ ê¸°ì¤€: <span id="current-criteria" style="color: var(--accent-primary);">-</span>
                </div>
                <div>
                    ì§„í–‰ë¥ : <span id="comparison-current">0</span> / <span id="comparison-total">0</span> 
                    (<span id="comparison-percentage">0</span>%)
                </div>
                <div class="progress-bar" style="margin-top: 1rem;">
                    <div class="progress-fill" id="comparison-progress" style="width: 0%;"></div>
                </div>
            </div>
        </div>

        <!-- ìŒëŒ€ë¹„êµ ì„¹ì…˜ -->
        <div class="section" id="comparison-section" style="display: none;">
            <div class="comparison-container">
                <div class="comparison-header">
                    <div class="criteria-title" id="criteria-display">
                        í˜„ì¬ ê¸°ì¤€: -
                    </div>
                    <div class="comparison-question" id="comparison-question">
                        ì–´ëŠ ëŒ€ì•ˆì´ ë” ì¤‘ìš”í•©ë‹ˆê¹Œ?
                    </div>
                </div>

                <div class="alternatives-display">
                    <div class="alternative-box" id="alternative-a">
                        <div class="alternative-name">ëŒ€ì•ˆ A</div>
                        <div class="alternative-desc">ì„¤ëª…</div>
                    </div>
                    
                    <div class="vs-indicator">VS</div>
                    
                    <div class="alternative-box" id="alternative-b">
                        <div class="alternative-name">ëŒ€ì•ˆ B</div>
                        <div class="alternative-desc">ì„¤ëª…</div>
                    </div>
                </div>

                <div class="scale-selector" id="scale-selector">
                    <div class="scale-option" data-value="9" data-direction="left">
                        <div class="scale-value">9</div>
                        <div class="scale-label">ê·¹ë„ë¡œ<br>ì¤‘ìš”</div>
                    </div>
                    <div class="scale-option" data-value="7" data-direction="left">
                        <div class="scale-value">7</div>
                        <div class="scale-label">ë§¤ìš°<br>ì¤‘ìš”</div>
                    </div>
                    <div class="scale-option" data-value="5" data-direction="left">
                        <div class="scale-value">5</div>
                        <div class="scale-label">ìƒë‹¹íˆ<br>ì¤‘ìš”</div>
                    </div>
                    <div class="scale-option" data-value="3" data-direction="left">
                        <div class="scale-value">3</div>
                        <div class="scale-label">ì•½ê°„<br>ì¤‘ìš”</div>
                    </div>
                    <div class="scale-option" data-value="1" data-direction="equal">
                        <div class="scale-value">1</div>
                        <div class="scale-label">ë™ë“±í•˜ê²Œ<br>ì¤‘ìš”</div>
                    </div>
                    <div class="scale-option" data-value="3" data-direction="right">
                        <div class="scale-value">3</div>
                        <div class="scale-label">ì•½ê°„<br>ì¤‘ìš”</div>
                    </div>
                    <div class="scale-option" data-value="5" data-direction="right">
                        <div class="scale-value">5</div>
                        <div class="scale-label">ìƒë‹¹íˆ<br>ì¤‘ìš”</div>
                    </div>
                    <div class="scale-option" data-value="7" data-direction="right">
                        <div class="scale-value">7</div>
                        <div class="scale-label">ë§¤ìš°<br>ì¤‘ìš”</div>
                    </div>
                    <div class="scale-option" data-value="9" data-direction="right">
                        <div class="scale-value">9</div>
                        <div class="scale-label">ê·¹ë„ë¡œ<br>ì¤‘ìš”</div>
                    </div>
                </div>

                <div class="scale-description" id="scale-description">
                    ì²™ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn" id="next-comparison-btn" onclick="submitComparison()" disabled>
                        â¤ ë‹¤ìŒ ë¹„êµ
                    </button>
                </div>
            </div>
        </div>

        <!-- ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤ ë¯¸ë¦¬ë³´ê¸° -->
        <div class="section" id="matrix-preview-section" style="display: none;">
            <h2 class="section-title">ğŸ“Š ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤</h2>
            <div class="matrix-preview">
                <h3 style="color: var(--accent-primary); margin-bottom: 1rem; text-align: center;">
                    í˜„ì¬ ê¸°ì¤€: <span id="matrix-criteria">-</span>
                </h3>
                <table class="matrix-table" id="comparison-matrix">
                    <!-- ë§¤íŠ¸ë¦­ìŠ¤ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </table>
            </div>
        </div>

        <!-- ì¼ê´€ì„± ë¶„ì„ -->
        <div class="section" id="consistency-section" style="display: none;">
            <h2 class="section-title">ğŸ” ì¼ê´€ì„± ë¶„ì„</h2>
            <div class="consistency-info">
                <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">ì¼ê´€ì„± ë¹„ìœ¨ (CR)</h3>
                <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;">
                    CR = <span id="consistency-ratio">0.00</span>
                    <span id="consistency-status" style="margin-left: 1rem;"></span>
                </div>
                <div style="color: var(--text-secondary); font-size: 0.9rem;">
                    âœ… CR â‰¤ 0.1: ì¼ê´€ì„± ìˆìŒ | âš ï¸ CR > 0.1: ì¬ê²€í†  í•„ìš”
                </div>
            </div>
        </div>

        <!-- ì™„ë£Œ ì„¹ì…˜ -->
        <div class="section" id="completion-section" style="display: none;">
            <h2 class="section-title">ğŸ‰ ìŒëŒ€ë¹„êµ ì™„ë£Œ</h2>
            <div style="text-align: center; padding: 2rem;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">âœ…</div>
                <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">
                    ëª¨ë“  ìŒëŒ€ë¹„êµê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!
                </h3>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                    ì´ì œ AHP ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <button class="btn" onclick="proceedToResults()">
                    ğŸ“ˆ ê²°ê³¼ ë¶„ì„ìœ¼ë¡œ ì´ë™
                </button>
            </div>
        </div>
    </main>

    <script src="scripts/layout.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentProject = null;
        let currentCriteria = [];
        let currentAlternatives = [];
        let comparisonResults = {};
        let currentCriteriaIndex = 0;
        let currentComparisonIndex = 0;
        let totalComparisons = 0;
        let completedComparisons = 0;
        let currentPairs = [];
        const API_BASE_URL = 'https://ahp-django-backend.onrender.com';

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ìŒëŒ€ë¹„êµ í˜ì´ì§€ ë¡œë“œë¨');
            
            // ë ˆì´ì•„ì›ƒ ì´ˆê¸°í™”
            if (window.layoutUtils) {
                window.layoutUtils.initializePage({
                    menuId: 'comparison',
                    pageId: 'projects',
                    title: 'ìŒëŒ€ë¹„êµ'
                });
            }
            
            checkBackendStatus();
            loadProjectData();
            initializeComparisons();

            // ì²™ë„ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('scale-selector').addEventListener('click', handleScaleSelection);
        });

        // ë°±ì—”ë“œ ìƒíƒœ í™•ì¸
        async function checkBackendStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/service/status/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--success);">âœ… ì •ìƒ ì—°ê²°</span>';
                } else {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--warning);">âš ï¸ ì‘ë‹µ ì˜¤ë¥˜</span>';
                }
            } catch (error) {
                document.getElementById('backend-status').innerHTML = 
                    '<span style="color: var(--error);">âŒ ì—°ê²° ì‹¤íŒ¨</span>';
                console.error('ë°±ì—”ë“œ ì—°ê²° ì˜¤ë¥˜:', error);
            }
        }

        // í”„ë¡œì íŠ¸ ë°ì´í„° ë¡œë“œ
        function loadProjectData() {
            // ì„¸ì…˜ì—ì„œ í”„ë¡œì íŠ¸ ì •ë³´ ë¡œë“œ
            const savedProject = sessionStorage.getItem('currentProject');
            const savedCriteria = sessionStorage.getItem('currentCriteria');
            const savedAlternatives = sessionStorage.getItem('currentAlternatives');

            if (savedProject) {
                try {
                    currentProject = JSON.parse(savedProject);
                    document.getElementById('current-project').textContent = currentProject.title;
                } catch (e) {
                    console.error('í”„ë¡œì íŠ¸ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }

            if (savedCriteria) {
                try {
                    currentCriteria = JSON.parse(savedCriteria);
                } catch (e) {
                    console.error('ê¸°ì¤€ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }

            if (savedAlternatives) {
                try {
                    currentAlternatives = JSON.parse(savedAlternatives);
                } catch (e) {
                    console.error('ëŒ€ì•ˆ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }

            // ë°ëª¨ ë°ì´í„° ì„¤ì •
            if (currentCriteria.length === 0) {
                currentCriteria = [
                    { id: 'demo-1', name: 'í’ˆì§ˆ', description: 'ì œí’ˆì´ë‚˜ ì„œë¹„ìŠ¤ì˜ ì „ë°˜ì ì¸ í’ˆì§ˆ ìˆ˜ì¤€' },
                    { id: 'demo-2', name: 'ë¹„ìš©', description: 'êµ¬ë§¤, ìœ ì§€ë³´ìˆ˜ ë“± ì´ ë¹„ìš©' },
                    { id: 'demo-3', name: 'ì‹ ë¢°ì„±', description: 'ì¥ê¸°ì ì¸ ì•ˆì •ì„±ê³¼ ì‹ ë¢°ë„' },
                    { id: 'demo-4', name: 'ì‚¬ìš©ì„±', description: 'ì‚¬ìš©ì ì¹œí™”ì„±ê³¼ í¸ì˜ì„±' }
                ];
            }

            if (currentAlternatives.length === 0) {
                currentAlternatives = [
                    { id: 'demo-alt-1', name: 'ëŒ€ì•ˆ A', description: 'ì²« ë²ˆì§¸ ì„ íƒ ê°€ëŠ¥í•œ ëŒ€ì•ˆìœ¼ë¡œ, ë¹„ìš© íš¨ìœ¨ì ì¸ ì†”ë£¨ì…˜' },
                    { id: 'demo-alt-2', name: 'ëŒ€ì•ˆ B', description: 'ë‘ ë²ˆì§¸ ëŒ€ì•ˆìœ¼ë¡œ, ê³ í’ˆì§ˆ í”„ë¦¬ë¯¸ì—„ ì˜µì…˜' },
                    { id: 'demo-alt-3', name: 'ëŒ€ì•ˆ C', description: 'ì„¸ ë²ˆì§¸ ëŒ€ì•ˆìœ¼ë¡œ, ê· í˜• ì¡íŒ ì¤‘ê°„ ìˆ˜ì¤€ì˜ ì„ íƒ' },
                    { id: 'demo-alt-4', name: 'ëŒ€ì•ˆ D', description: 'ë„¤ ë²ˆì§¸ ëŒ€ì•ˆìœ¼ë¡œ, í˜ì‹ ì ì´ê³  ë¯¸ë˜ì§€í–¥ì ì¸ ì†”ë£¨ì…˜' }
                ];
            }

            if (!currentProject) {
                currentProject = {
                    id: 'demo-project',
                    title: 'ìƒ˜í”Œ ì˜ì‚¬ê²°ì • í”„ë¡œì íŠ¸'
                };
                document.getElementById('current-project').textContent = currentProject.title;
            }
        }

        // ë¹„êµ ì´ˆê¸°í™”
        function initializeComparisons() {
            if (currentCriteria.length === 0 || currentAlternatives.length === 0) {
                document.getElementById('comparison-section').innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
                        <h3>ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤</h3>
                        <p>ê¸°ì¤€ê³¼ ëŒ€ì•ˆì´ ì„¤ì •ë˜ì–´ì•¼ ìŒëŒ€ë¹„êµë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            // ê° ê¸°ì¤€ë³„ë¡œ ëŒ€ì•ˆ ìŒ ìƒì„±
            currentCriteria.forEach(criteria => {
                comparisonResults[criteria.id] = {};
                const pairs = [];
                
                for (let i = 0; i < currentAlternatives.length; i++) {
                    for (let j = i + 1; j < currentAlternatives.length; j++) {
                        pairs.push({
                            altA: currentAlternatives[i],
                            altB: currentAlternatives[j],
                            criteria: criteria
                        });
                    }
                }
                
                currentPairs = currentPairs.concat(pairs);
            });

            totalComparisons = currentPairs.length;
            updateProgress();
            
            if (totalComparisons > 0) {
                showNextComparison();
            }
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            document.getElementById('comparison-current').textContent = completedComparisons;
            document.getElementById('comparison-total').textContent = totalComparisons;
            
            const percentage = totalComparisons > 0 ? Math.round((completedComparisons / totalComparisons) * 100) : 0;
            document.getElementById('comparison-percentage').textContent = percentage;
            document.getElementById('comparison-progress').style.width = percentage + '%';
        }

        // ë‹¤ìŒ ë¹„êµ í‘œì‹œ
        function showNextComparison() {
            if (currentComparisonIndex >= currentPairs.length) {
                showCompletion();
                return;
            }

            const currentPair = currentPairs[currentComparisonIndex];
            
            // í˜„ì¬ ê¸°ì¤€ í‘œì‹œ
            document.getElementById('current-criteria').textContent = currentPair.criteria.name;
            document.getElementById('criteria-display').textContent = `í˜„ì¬ ê¸°ì¤€: ${currentPair.criteria.name}`;
            document.getElementById('comparison-question').textContent = 
                `"${currentPair.criteria.name}" ê¸°ì¤€ìœ¼ë¡œ ì–´ëŠ ëŒ€ì•ˆì´ ë” ì¤‘ìš”í•©ë‹ˆê¹Œ?`;

            // ëŒ€ì•ˆ í‘œì‹œ
            const altAElement = document.getElementById('alternative-a');
            altAElement.querySelector('.alternative-name').textContent = currentPair.altA.name;
            altAElement.querySelector('.alternative-desc').textContent = currentPair.altA.description || 'ì„¤ëª… ì—†ìŒ';

            const altBElement = document.getElementById('alternative-b');
            altBElement.querySelector('.alternative-name').textContent = currentPair.altB.name;
            altBElement.querySelector('.alternative-desc').textContent = currentPair.altB.description || 'ì„¤ëª… ì—†ìŒ';

            // ì„¹ì…˜ í‘œì‹œ
            document.getElementById('comparison-section').style.display = 'block';
            document.getElementById('matrix-preview-section').style.display = 'block';
            
            // ì²™ë„ ì„ íƒ ì´ˆê¸°í™”
            resetScaleSelection();
            
            // ë§¤íŠ¸ë¦­ìŠ¤ ì—…ë°ì´íŠ¸
            updateMatrix();
        }

        // ì²™ë„ ì„ íƒ ì²˜ë¦¬
        function handleScaleSelection(event) {
            if (!event.target.closest('.scale-option')) return;

            const scaleOption = event.target.closest('.scale-option');
            const value = parseInt(scaleOption.dataset.value);
            const direction = scaleOption.dataset.direction;

            // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.scale-option').forEach(opt => opt.classList.remove('selected'));
            scaleOption.classList.add('selected');

            // ì„¤ëª… ì—…ë°ì´íŠ¸
            updateScaleDescription(value, direction);

            // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('next-comparison-btn').disabled = false;
        }

        // ì²™ë„ ì„¤ëª… ì—…ë°ì´íŠ¸
        function updateScaleDescription(value, direction) {
            const currentPair = currentPairs[currentComparisonIndex];
            const descriptions = {
                1: 'ë‘ ëŒ€ì•ˆì´ ë™ë“±í•˜ê²Œ ì¤‘ìš”í•©ë‹ˆë‹¤',
                3: 'í•œ ëŒ€ì•ˆì´ ë‹¤ë¥¸ ëŒ€ì•ˆë³´ë‹¤ ì•½ê°„ ë” ì¤‘ìš”í•©ë‹ˆë‹¤',
                5: 'í•œ ëŒ€ì•ˆì´ ë‹¤ë¥¸ ëŒ€ì•ˆë³´ë‹¤ ìƒë‹¹íˆ ë” ì¤‘ìš”í•©ë‹ˆë‹¤',
                7: 'í•œ ëŒ€ì•ˆì´ ë‹¤ë¥¸ ëŒ€ì•ˆë³´ë‹¤ ë§¤ìš° ë” ì¤‘ìš”í•©ë‹ˆë‹¤',
                9: 'í•œ ëŒ€ì•ˆì´ ë‹¤ë¥¸ ëŒ€ì•ˆë³´ë‹¤ ê·¹ë„ë¡œ ë” ì¤‘ìš”í•©ë‹ˆë‹¤'
            };

            let description = descriptions[value];
            if (direction === 'left') {
                description = `"${currentPair.altA.name}"ì´(ê°€) "${currentPair.altB.name}"ë³´ë‹¤ ${value}ë°° ë” ì¤‘ìš”`;
            } else if (direction === 'right') {
                description = `"${currentPair.altB.name}"ì´(ê°€) "${currentPair.altA.name}"ë³´ë‹¤ ${value}ë°° ë” ì¤‘ìš”`;
            } else {
                description = `"${currentPair.altA.name}"ê³¼(ì™€) "${currentPair.altB.name}"ì´(ê°€) ë™ë“±í•˜ê²Œ ì¤‘ìš”`;
            }

            document.getElementById('scale-description').textContent = description;
        }

        // ë¹„êµ ì œì¶œ
        function submitComparison() {
            const selectedScale = document.querySelector('.scale-option.selected');
            if (!selectedScale) return;

            const currentPair = currentPairs[currentComparisonIndex];
            const value = parseInt(selectedScale.dataset.value);
            const direction = selectedScale.dataset.direction;

            // ê²°ê³¼ ì €ì¥
            const criteriaId = currentPair.criteria.id;
            const altAId = currentPair.altA.id;
            const altBId = currentPair.altB.id;

            if (!comparisonResults[criteriaId]) {
                comparisonResults[criteriaId] = {};
            }

            // ë§¤íŠ¸ë¦­ìŠ¤ ê°’ ê³„ì‚°
            let matrixValue = value;
            if (direction === 'right') {
                matrixValue = 1 / value;
            }

            comparisonResults[criteriaId][`${altAId}-${altBId}`] = matrixValue;
            comparisonResults[criteriaId][`${altBId}-${altAId}`] = 1 / matrixValue;

            // ì§„í–‰
            completedComparisons++;
            currentComparisonIndex++;
            updateProgress();

            // ë‹¤ìŒ ë¹„êµë¡œ ì´ë™
            setTimeout(() => {
                if (currentComparisonIndex < currentPairs.length) {
                    showNextComparison();
                } else {
                    showCompletion();
                }
            }, 500);
        }

        // ì²™ë„ ì„ íƒ ì´ˆê¸°í™”
        function resetScaleSelection() {
            document.querySelectorAll('.scale-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById('scale-description').textContent = 'ì²™ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            document.getElementById('next-comparison-btn').disabled = true;
        }

        // ë§¤íŠ¸ë¦­ìŠ¤ ì—…ë°ì´íŠ¸
        function updateMatrix() {
            if (currentComparisonIndex >= currentPairs.length) return;

            const currentPair = currentPairs[currentComparisonIndex];
            const criteriaId = currentPair.criteria.id;
            
            document.getElementById('matrix-criteria').textContent = currentPair.criteria.name;

            // ë§¤íŠ¸ë¦­ìŠ¤ í…Œì´ë¸” ìƒì„±
            const table = document.getElementById('comparison-matrix');
            const alternatives = currentAlternatives;
            
            let html = '<thead><tr><th></th>';
            alternatives.forEach(alt => {
                html += `<th>${alt.name}</th>`;
            });
            html += '</tr></thead><tbody>';

            alternatives.forEach(altA => {
                html += `<tr><th>${altA.name}</th>`;
                alternatives.forEach(altB => {
                    if (altA.id === altB.id) {
                        html += '<td>1.00</td>';
                    } else {
                        const key = `${altA.id}-${altB.id}`;
                        const value = comparisonResults[criteriaId] && comparisonResults[criteriaId][key] 
                            ? comparisonResults[criteriaId][key].toFixed(2) 
                            : '-';
                        html += `<td>${value}</td>`;
                    }
                });
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        // ì™„ë£Œ í‘œì‹œ
        function showCompletion() {
            document.getElementById('comparison-section').style.display = 'none';
            document.getElementById('completion-section').style.display = 'block';
            document.getElementById('consistency-section').style.display = 'block';
            
            // ì¼ê´€ì„± ë¶„ì„ ìˆ˜í–‰
            calculateConsistency();
            
            // ê²°ê³¼ë¥¼ ì„¸ì…˜ì— ì €ì¥
            sessionStorage.setItem('comparisonResults', JSON.stringify(comparisonResults));
        }

        // ì¼ê´€ì„± ë¶„ì„
        function calculateConsistency() {
            // ê°„ë‹¨í•œ ì¼ê´€ì„± ë¹„ìœ¨ ê³„ì‚° (ì‹¤ì œë¡œëŠ” ë” ë³µì¡í•œ ê³ ìœ ê°’ ê³„ì‚° í•„ìš”)
            const randomIndex = [0, 0, 0.52, 0.89, 1.11, 1.25, 1.35, 1.40, 1.45, 1.49];
            const n = currentAlternatives.length;
            
            // ë°ëª¨ìš© ì¼ê´€ì„± ë¹„ìœ¨ (ì‹¤ì œë¡œëŠ” ê° ë§¤íŠ¸ë¦­ìŠ¤ë³„ë¡œ ê³„ì‚°)
            const cr = (Math.random() * 0.15).toFixed(3); // 0.000-0.150 ë²”ìœ„
            
            document.getElementById('consistency-ratio').textContent = cr;
            
            const status = parseFloat(cr) <= 0.1 
                ? '<span style="color: var(--success);">âœ… ì¼ê´€ì„± ìˆìŒ</span>'
                : '<span style="color: var(--error);">âš ï¸ ì¬ê²€í†  í•„ìš”</span>';
            
            document.getElementById('consistency-status').innerHTML = status;
        }

        // ê²°ê³¼ ë¶„ì„ìœ¼ë¡œ ì´ë™
        function proceedToResults() {
            // ëª¨ë“  ë°ì´í„°ë¥¼ ì„¸ì…˜ì— ì €ì¥
            sessionStorage.setItem('currentProject', JSON.stringify(currentProject));
            sessionStorage.setItem('currentCriteria', JSON.stringify(currentCriteria));
            sessionStorage.setItem('currentAlternatives', JSON.stringify(currentAlternatives));
            sessionStorage.setItem('comparisonResults', JSON.stringify(comparisonResults));
            
            // ê²°ê³¼ ë¶„ì„ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = '/ahp_app/results-analysis.html';
        }

        // ê°œë°œìš©: Ctrl+Së¡œ ê±´ë„ˆë›°ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                completedComparisons = totalComparisons;
                currentComparisonIndex = currentPairs.length;
                updateProgress();
                showCompletion();
            }
        });
    </script>
</body>
</html>