<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°±ì—”ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .success { background: #4CAF50; color: white; }
        .error { background: #f44336; color: white; }
        .pending { background: #FF9800; color: white; }
        .result {
            margin: 10px 0;
            padding: 15px;
            background: #fff;
            border-left: 4px solid #ddd;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .result.success { border-color: #4CAF50; }
        .result.error { border-color: #f44336; }
        button {
            padding: 10px 20px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976D2; }
        .log {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .endpoint-test {
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”Œ ë°±ì—”ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h2>1. ì„œë²„ ìƒíƒœ í™•ì¸</h2>
            <button onclick="testServerStatus()">ì„œë²„ ìƒíƒœ í…ŒìŠ¤íŠ¸</button>
            <div id="serverStatus"></div>
        </div>

        <div class="test-section">
            <h2>2. API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸</h2>
            <button onclick="testAllEndpoints()">ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸</button>
            <div id="endpointResults"></div>
        </div>

        <div class="test-section">
            <h2>3. í”„ë¡œì íŠ¸ CRUD í…ŒìŠ¤íŠ¸</h2>
            <button onclick="testProjectCRUD()">í”„ë¡œì íŠ¸ CRUD í…ŒìŠ¤íŠ¸</button>
            <div id="crudResults"></div>
        </div>

        <div class="test-section">
            <h2>4. ì‘ë‹µ ì‹œê°„ ì¸¡ì •</h2>
            <button onclick="measureResponseTime()">ì‘ë‹µ ì‹œê°„ ì¸¡ì •</button>
            <div id="responseTime"></div>
        </div>

        <div class="log" id="log">
            === í…ŒìŠ¤íŠ¸ ë¡œê·¸ ===
        </div>
    </div>

    <script>
        // ë°±ì—”ë“œ URL ì„¤ì •
        const API_URL = 'https://ahp-django-backend.onrender.com';
        const ENDPOINTS = {
            status: '/api/',
            projects: '/api/projects/',
            auth: '/api/auth/token/',
            evaluations: '/api/evaluations/',
            health: '/health/',
            db_status: '/db-status/'
        };

        // ë¡œê·¸ í•¨ìˆ˜
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff5252' : type === 'success' ? '#69f0ae' : '#aed581';
            logDiv.innerHTML += `\n<span style="color: ${color}">[${timestamp}] ${message}</span>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // ì„œë²„ ìƒíƒœ í™•ì¸
        async function testServerStatus() {
            const statusDiv = document.getElementById('serverStatus');
            statusDiv.innerHTML = '<div class="status pending">í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            try {
                log(`ì„œë²„ ìƒíƒœ í™•ì¸ ì¤‘: ${API_URL}`);
                const startTime = Date.now();
                
                // 1. ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸
                const response = await fetch(`${API_URL}${ENDPOINTS.status}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include'
                });
                
                const responseTime = Date.now() - startTime;
                log(`ì‘ë‹µ ì‹œê°„: ${responseTime}ms`, 'success');
                
                let data;
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    data = await response.text();
                }
                
                statusDiv.innerHTML = `
                    <div class="status ${response.ok ? 'success' : 'error'}">
                        ${response.ok ? 'âœ… ì—°ê²° ì„±ê³µ' : 'âŒ ì—°ê²° ì‹¤íŒ¨'}
                    </div>
                    <div class="result ${response.ok ? 'success' : 'error'}">
ìƒíƒœ ì½”ë“œ: ${response.status} ${response.statusText}
ì‘ë‹µ ì‹œê°„: ${responseTime}ms
ë°±ì—”ë“œ URL: ${API_URL}
ì‘ë‹µ ë°ì´í„°: ${typeof data === 'object' ? JSON.stringify(data, null, 2) : data}
                    </div>
                `;
                
                log(`ì„œë²„ ìƒíƒœ: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="status error">âŒ ì—°ê²° ì‹¤íŒ¨</div>
                    <div class="result error">
ì—ëŸ¬: ${error.message}
ë°±ì—”ë“œ URL: ${API_URL}

ê°€ëŠ¥í•œ ì›ì¸:
1. ì„œë²„ê°€ êº¼ì ¸ìˆìŒ (Render.com ì½œë“œ ìŠ¤íƒ€íŠ¸)
2. CORS ì„¤ì • ë¬¸ì œ
3. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ
                    </div>
                `;
                log(`ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
        async function testAllEndpoints() {
            const resultsDiv = document.getElementById('endpointResults');
            resultsDiv.innerHTML = '<div class="status pending">í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            const results = [];
            
            for (const [name, path] of Object.entries(ENDPOINTS)) {
                log(`ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸: ${name} - ${path}`);
                
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_URL}${path}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include'
                    });
                    
                    const responseTime = Date.now() - startTime;
                    
                    results.push({
                        name,
                        path,
                        status: response.status,
                        statusText: response.statusText,
                        responseTime,
                        success: response.ok || response.status === 401 // 401ì€ ì¸ì¦ í•„ìš”ë¡œ ì •ìƒ
                    });
                    
                    log(`${name}: ${response.status} (${responseTime}ms)`, 
                        response.ok ? 'success' : 'info');
                    
                } catch (error) {
                    results.push({
                        name,
                        path,
                        status: 0,
                        statusText: error.message,
                        responseTime: 0,
                        success: false
                    });
                    log(`${name}: ì‹¤íŒ¨ - ${error.message}`, 'error');
                }
            }
            
            const successCount = results.filter(r => r.success).length;
            const totalCount = results.length;
            
            resultsDiv.innerHTML = `
                <div class="status ${successCount === totalCount ? 'success' : successCount > 0 ? 'pending' : 'error'}">
                    í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${successCount}/${totalCount} ì„±ê³µ
                </div>
                ${results.map(r => `
                    <div class="endpoint-test">
                        <strong>${r.name}</strong> (${r.path})
                        <span class="status ${r.success ? 'success' : 'error'}">
                            ${r.status} ${r.statusText}
                        </span>
                        <span style="float: right;">${r.responseTime}ms</span>
                    </div>
                `).join('')}
            `;
        }

        // í”„ë¡œì íŠ¸ CRUD í…ŒìŠ¤íŠ¸
        async function testProjectCRUD() {
            const resultsDiv = document.getElementById('crudResults');
            resultsDiv.innerHTML = '<div class="status pending">í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            try {
                // 1. í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ
                log('í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ ì¤‘...');
                const listResponse = await fetch(`${API_URL}${ENDPOINTS.projects}`, {
                    credentials: 'include'
                });
                
                let projectCount = 0;
                if (listResponse.ok) {
                    const data = await listResponse.json();
                    projectCount = data.count || (data.results ? data.results.length : 0);
                    log(`í”„ë¡œì íŠ¸ ${projectCount}ê°œ ë°œê²¬`, 'success');
                }
                
                resultsDiv.innerHTML = `
                    <div class="status ${listResponse.ok ? 'success' : 'error'}">
                        ${listResponse.ok ? 'âœ… CRUD í…ŒìŠ¤íŠ¸ ì„±ê³µ' : 'âŒ CRUD í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨'}
                    </div>
                    <div class="result ${listResponse.ok ? 'success' : 'error'}">
í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ: ${listResponse.status} ${listResponse.statusText}
í”„ë¡œì íŠ¸ ê°œìˆ˜: ${projectCount}ê°œ
ë°±ì—”ë“œ URL: ${API_URL}${ENDPOINTS.projects}
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="status error">âŒ CRUD í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</div>
                    <div class="result error">ì—ëŸ¬: ${error.message}</div>
                `;
                log(`CRUD í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ì‘ë‹µ ì‹œê°„ ì¸¡ì •
        async function measureResponseTime() {
            const timeDiv = document.getElementById('responseTime');
            timeDiv.innerHTML = '<div class="status pending">ì¸¡ì • ì¤‘...</div>';
            
            const measurements = [];
            const testCount = 5;
            
            log(`${testCount}íšŒ ì‘ë‹µ ì‹œê°„ ì¸¡ì • ì‹œì‘`);
            
            for (let i = 0; i < testCount; i++) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_URL}${ENDPOINTS.status}`, {
                        method: 'GET',
                        credentials: 'include'
                    });
                    const responseTime = Date.now() - startTime;
                    measurements.push(responseTime);
                    log(`í…ŒìŠ¤íŠ¸ ${i + 1}: ${responseTime}ms`);
                } catch (error) {
                    log(`í…ŒìŠ¤íŠ¸ ${i + 1} ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }
            
            if (measurements.length > 0) {
                const avg = Math.round(measurements.reduce((a, b) => a + b, 0) / measurements.length);
                const min = Math.min(...measurements);
                const max = Math.max(...measurements);
                
                timeDiv.innerHTML = `
                    <div class="status success">âœ… ì¸¡ì • ì™„ë£Œ</div>
                    <div class="result success">
í…ŒìŠ¤íŠ¸ íšŸìˆ˜: ${measurements.length}/${testCount}
í‰ê·  ì‘ë‹µ ì‹œê°„: ${avg}ms
ìµœì†Œ ì‘ë‹µ ì‹œê°„: ${min}ms
ìµœëŒ€ ì‘ë‹µ ì‹œê°„: ${max}ms
ì¸¡ì •ê°’: ${measurements.join(', ')}ms

${avg > 1000 ? 'âš ï¸ ì‘ë‹µ ì‹œê°„ì´ ëŠë¦½ë‹ˆë‹¤. ì½œë“œ ìŠ¤íƒ€íŠ¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.' : 'âœ… ì‘ë‹µ ì‹œê°„ì´ ì •ìƒì…ë‹ˆë‹¤.'}
                    </div>
                `;
                
                log(`í‰ê·  ì‘ë‹µ ì‹œê°„: ${avg}ms`, avg < 1000 ? 'success' : 'info');
            } else {
                timeDiv.innerHTML = `
                    <div class="status error">âŒ ì¸¡ì • ì‹¤íŒ¨</div>
                    <div class="result error">ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.onload = function() {
            log('=== ë°±ì—”ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'success');
            log(`ë°±ì—”ë“œ URL: ${API_URL}`);
            testServerStatus();
        };
    </script>
</body>
</html>