# ê°œë°œì¼ì§€ - AI ì„¤ì • ìŠˆí¼ê´€ë¦¬ì í†µí•© ì‹œìŠ¤í…œ êµ¬ì¶•
## OpenAI API í‚¤ ê´€ë¦¬ ë° íšŒì›ë³„ AI ê¸°ëŠ¥ ì—°ë™ ê°œë°œ

**ì‘ì„±ì¼**: 2025-10-15  
**ê°œë°œì**: ì‚¬ìš©ì + Claude Code (Sonnet 4)  
**ì‘ì—… ë²”ìœ„**: í”„ë¡ íŠ¸ì—”ë“œ + ë°±ì—”ë“œ + Django ê´€ë¦¬ì í˜ì´ì§€ í†µí•©  

---

## ğŸ“‹ ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ ë¶„ì„

### ğŸ¯ í•µì‹¬ ìš”êµ¬ì‚¬í•­
```
1. ì—°êµ¬ìë“¤ì´ ì§ì ‘ API í‚¤ ë°œê¸‰ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ
2. ìŠˆí¼ê´€ë¦¬ìê°€ AI ì‚¬ìš© ìš”ê¸ˆì œì— ë”°ë¼ íšŒì›ë³„ ì„¤ì • ê´€ë¦¬
3. ìŠˆí¼ê´€ë¦¬ì ëª¨ë“œì— AI ê¸°ëŠ¥ ê´€ë¦¬ ë©”ë‰´ ì¶”ê°€
4. íšŒì›ë³„ AI ê¸°ëŠ¥ ì—°ê²° ì‹œìŠ¤í…œ êµ¬ì¶•
5. í”„ë¡ íŠ¸ì—”ë“œ + ë°±ì—”ë“œ + Django ê´€ë¦¬ì í†µí•© ê´€ë¦¬
6. ê°œë°œ í”„ë¡¬í”„íŠ¸ ìë™ ì €ì¥ ì‹œìŠ¤í…œ
```

### ğŸ’¡ í•´ê²° ë°©ì•ˆ ì„¤ê³„
```
ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜:
â”œâ”€â”€ í”„ë¡ íŠ¸ì—”ë“œ: ìŠˆí¼ê´€ë¦¬ì AI ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ
â”œâ”€â”€ ë°±ì—”ë“œ: Django REST API (AI ì„¤ì • CRUD)
â”œâ”€â”€ ë°ì´í„°ë² ì´ìŠ¤: AI ì„¤ì • ëª¨ë¸ + íšŒì› ì—°ë™
â”œâ”€â”€ Django ê´€ë¦¬ì: í†µí•© ê´€ë¦¬ ì¸í„°í˜ì´ìŠ¤
â””â”€â”€ ìë™í™”: í”„ë¡¬í”„íŠ¸ ì €ì¥ ì‹œìŠ¤í…œ
```

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ ì„¤ê³„

### 1. AI ì„œë¹„ìŠ¤ ì„¤ì • ëª¨ë¸
```python
# backend/models/ai_settings.py
from django.db import models
from django.contrib.auth.models import User

class AIServicePlan(models.Model):
    """AI ì„œë¹„ìŠ¤ ìš”ê¸ˆì œ"""
    PLAN_CHOICES = [
        ('free', 'ë¬´ë£Œ (ì œí•œì )'),
        ('basic', 'ê¸°ë³¸í˜• ($10/ì›”)'),
        ('premium', 'í”„ë¦¬ë¯¸ì—„ ($30/ì›”)'),
        ('enterprise', 'ê¸°ì—…í˜• ($100/ì›”)'),
    ]
    
    name = models.CharField(max_length=50, choices=PLAN_CHOICES, unique=True)
    monthly_cost = models.DecimalField(max_digits=10, decimal_places=2)
    monthly_token_limit = models.IntegerField()  # ì›”ê°„ í† í° í•œë„
    daily_request_limit = models.IntegerField()  # ì¼ê°„ ìš”ì²­ í•œë„
    features = models.JSONField(default=dict)  # ì‚¬ìš© ê°€ëŠ¥ ê¸°ëŠ¥ë“¤
    is_active = models.BooleanField(default=True)
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    def __str__(self):
        return f"{self.get_name_display()} - ${self.monthly_cost}/ì›”"

class AIServiceSettings(models.Model):
    """AI ì„œë¹„ìŠ¤ ì„¤ì • (ê´€ë¦¬ìê°€ ê´€ë¦¬)"""
    PROVIDER_CHOICES = [
        ('openai', 'OpenAI'),
        ('claude', 'Claude'),
        ('gemini', 'Google Gemini'),
    ]
    
    name = models.CharField(max_length=100)  # ì„¤ì • ì´ë¦„
    provider = models.CharField(max_length=20, choices=PROVIDER_CHOICES)
    api_key = models.TextField()  # ì•”í˜¸í™” ì €ì¥
    model_name = models.CharField(max_length=50, default='gpt-3.5-turbo')
    max_tokens = models.IntegerField(default=1000)
    temperature = models.FloatField(default=0.7)
    
    # ì‚¬ìš©ëŸ‰ ì œí•œ
    hourly_limit = models.IntegerField(default=100)
    daily_limit = models.IntegerField(default=1000)
    monthly_limit = models.IntegerField(default=10000)
    
    # ê´€ë¦¬ ì •ë³´
    is_active = models.BooleanField(default=True)
    created_by = models.ForeignKey(User, on_delete=models.CASCADE)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    def __str__(self):
        return f"{self.name} ({self.provider})"

class UserAIAccess(models.Model):
    """ì‚¬ìš©ìë³„ AI ì ‘ê·¼ ê¶Œí•œ"""
    user = models.OneToOneField(User, on_delete=models.CASCADE, related_name='ai_access')
    ai_plan = models.ForeignKey(AIServicePlan, on_delete=models.CASCADE)
    ai_settings = models.ForeignKey(AIServiceSettings, on_delete=models.CASCADE, null=True, blank=True)
    
    # ì‚¬ìš©ëŸ‰ ì¶”ì 
    tokens_used_today = models.IntegerField(default=0)
    tokens_used_month = models.IntegerField(default=0)
    requests_today = models.IntegerField(default=0)
    last_reset_date = models.DateField(auto_now_add=True)
    
    # ê¶Œí•œ ì„¤ì •
    is_enabled = models.BooleanField(default=True)
    can_use_advanced_features = models.BooleanField(default=False)
    
    # ê´€ë¦¬ ì •ë³´
    assigned_by = models.ForeignKey(User, on_delete=models.CASCADE, related_name='assigned_ai_access')
    assigned_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    def __str__(self):
        return f"{self.user.username} - {self.ai_plan.name}"

class AIUsageLog(models.Model):
    """AI ì‚¬ìš© ë¡œê·¸"""
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    ai_settings = models.ForeignKey(AIServiceSettings, on_delete=models.CASCADE)
    
    # ìš”ì²­ ì •ë³´
    request_type = models.CharField(max_length=50)  # 'chatbot', 'analysis', 'generation'
    prompt = models.TextField()
    response = models.TextField()
    
    # ì‚¬ìš©ëŸ‰ ì •ë³´
    tokens_used = models.IntegerField()
    cost = models.DecimalField(max_digits=10, decimal_places=4)
    response_time = models.FloatField()  # ì‘ë‹µ ì‹œê°„ (ì´ˆ)
    
    # ë©”íƒ€ë°ì´í„°
    ip_address = models.GenericIPAddressField()
    user_agent = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    
    def __str__(self):
        return f"{self.user.username} - {self.request_type} ({self.created_at})"
```

### 2. ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
```python
# backend/migrations/0001_ai_settings.py
from django.db import migrations, models
import django.db.models.deletion
from django.conf import settings

class Migration(migrations.Migration):
    initial = True
    
    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]
    
    operations = [
        migrations.CreateModel(
            name='AIServicePlan',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(choices=[('free', 'ë¬´ë£Œ (ì œí•œì )'), ('basic', 'ê¸°ë³¸í˜• ($10/ì›”)'), ('premium', 'í”„ë¦¬ë¯¸ì—„ ($30/ì›”)'), ('enterprise', 'ê¸°ì—…í˜• ($100/ì›”)')], max_length=50, unique=True)),
                ('monthly_cost', models.DecimalField(decimal_places=2, max_digits=10)),
                ('monthly_token_limit', models.IntegerField()),
                ('daily_request_limit', models.IntegerField()),
                ('features', models.JSONField(default=dict)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        # ... ë‹¤ë¥¸ ëª¨ë¸ë“¤
    ]
```

---

## ğŸ–¥ï¸ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ

### 1. ìŠˆí¼ê´€ë¦¬ì AI ê´€ë¦¬ ë©”ë‰´ ì¶”ê°€
```typescript
// src/components/admin/SuperAdminAIManagement.tsx
import React, { useState, useEffect } from 'react';
import { AIServiceSettings, UserAIAccess, AIUsageLog } from '../../types/ai';
import { apiClient } from '../../services/api';
import PageHeader from '../common/PageHeader';
import Tooltip from '../common/Tooltip';
import UIIcon from '../common/UIIcon';

interface SuperAdminAIManagementProps {
  user?: User;
}

const SuperAdminAIManagement: React.FC<SuperAdminAIManagementProps> = ({ user }) => {
  const [activeTab, setActiveTab] = useState<'settings' | 'users' | 'usage' | 'billing'>('settings');
  const [aiSettings, setAiSettings] = useState<AIServiceSettings[]>([]);
  const [userAccess, setUserAccess] = useState<UserAIAccess[]>([]);
  const [usageLogs, setUsageLogs] = useState<AIUsageLog[]>([]);
  const [loading, setLoading] = useState(false);

  // ë°ì´í„° ë¡œë“œ
  useEffect(() => {
    loadData();
  }, [activeTab]);

  const loadData = async () => {
    setLoading(true);
    try {
      switch (activeTab) {
        case 'settings':
          const settingsData = await apiClient.get('/api/admin/ai-settings/');
          setAiSettings(settingsData.data);
          break;
        case 'users':
          const usersData = await apiClient.get('/api/admin/user-ai-access/');
          setUserAccess(usersData.data);
          break;
        case 'usage':
          const usageData = await apiClient.get('/api/admin/ai-usage-logs/');
          setUsageLogs(usageData.data);
          break;
      }
    } catch (error) {
      console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen" style={{ backgroundColor: 'var(--bg-base)' }}>
      <PageHeader
        title="AI ì„œë¹„ìŠ¤ ê´€ë¦¬"
        description="ì‚¬ìš©ìë³„ AI ê¸°ëŠ¥ í• ë‹¹ ë° ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§"
        icon="ğŸ¤–"
        onBack={() => window.history.back()}
      />
      
      <div className="container-adaptive section-padding">
        {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
        <div className="mb-6">
          <div className="flex space-x-1 rounded-lg p-1" style={{ backgroundColor: 'var(--bg-secondary)' }}>
            {[
              { key: 'settings', label: 'AI ì„¤ì •', icon: 'âš™ï¸' },
              { key: 'users', label: 'ì‚¬ìš©ì ê´€ë¦¬', icon: 'ğŸ‘¥' },
              { key: 'usage', label: 'ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§', icon: 'ğŸ“Š' },
              { key: 'billing', label: 'ìš”ê¸ˆ ê´€ë¦¬', icon: 'ğŸ’³' }
            ].map((tab) => (
              <button
                key={tab.key}
                onClick={() => setActiveTab(tab.key as any)}
                className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-colors ${
                  activeTab === tab.key ? 'text-white' : ''
                }`}
                style={{
                  backgroundColor: activeTab === tab.key ? 'var(--accent-primary)' : 'transparent',
                  color: activeTab === tab.key ? 'white' : 'var(--text-secondary)'
                }}
              >
                <UIIcon emoji={tab.icon} size="sm" />
                <span>{tab.label}</span>
              </button>
            ))}
          </div>
        </div>

        {/* íƒ­ ì½˜í…ì¸  */}
        <div className="space-y-6">
          {activeTab === 'settings' && (
            <AISettingsTab settings={aiSettings} onUpdate={loadData} />
          )}
          
          {activeTab === 'users' && (
            <UserManagementTab userAccess={userAccess} onUpdate={loadData} />
          )}
          
          {activeTab === 'usage' && (
            <UsageMonitoringTab usageLogs={usageLogs} />
          )}
          
          {activeTab === 'billing' && (
            <BillingManagementTab />
          )}
        </div>
      </div>
    </div>
  );
};

// AI ì„¤ì • íƒ­ ì»´í¬ë„ŒíŠ¸
const AISettingsTab: React.FC<{
  settings: AIServiceSettings[]; 
  onUpdate: () => void;
}> = ({ settings, onUpdate }) => {
  const [showAddModal, setShowAddModal] = useState(false);

  return (
    <div className="space-y-6">
      {/* í—¤ë” */}
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-xl font-bold" style={{ color: 'var(--text-primary)' }}>
            AI ì„œë¹„ìŠ¤ ì„¤ì •
          </h3>
          <p style={{ color: 'var(--text-secondary)' }}>
            OpenAI API í‚¤ ë° ëª¨ë¸ ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
          </p>
        </div>
        <button
          onClick={() => setShowAddModal(true)}
          className="flex items-center space-x-2 px-4 py-2 rounded-lg font-medium text-white"
          style={{ backgroundColor: 'var(--accent-primary)' }}
        >
          <UIIcon emoji="â•" size="sm" />
          <span>ìƒˆ AI ì„¤ì • ì¶”ê°€</span>
        </button>
      </div>

      {/* ì„¤ì • ëª©ë¡ */}
      <div className="grid gap-4">
        {settings.map((setting) => (
          <div key={setting.id} className="p-4 rounded-lg border" 
               style={{ backgroundColor: 'var(--bg-primary)', borderColor: 'var(--border-light)' }}>
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="flex items-center space-x-3 mb-2">
                  <UIIcon emoji="ğŸ¤–" size="lg" />
                  <div>
                    <h4 className="font-semibold" style={{ color: 'var(--text-primary)' }}>
                      {setting.name}
                    </h4>
                    <p className="text-sm" style={{ color: 'var(--text-secondary)' }}>
                      {setting.provider} - {setting.model_name}
                    </p>
                  </div>
                </div>
                
                <div className="grid grid-cols-3 gap-4 text-sm">
                  <div>
                    <span style={{ color: 'var(--text-muted)' }}>ì¼ê°„ í•œë„:</span>
                    <span className="ml-2 font-medium" style={{ color: 'var(--text-primary)' }}>
                      {setting.daily_limit.toLocaleString()}
                    </span>
                  </div>
                  <div>
                    <span style={{ color: 'var(--text-muted)' }}>ì›”ê°„ í•œë„:</span>
                    <span className="ml-2 font-medium" style={{ color: 'var(--text-primary)' }}>
                      {setting.monthly_limit.toLocaleString()}
                    </span>
                  </div>
                  <div>
                    <span style={{ color: 'var(--text-muted)' }}>ìƒíƒœ:</span>
                    <span className={`ml-2 px-2 py-1 rounded-full text-xs font-medium ${
                      setting.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                    }`}>
                      {setting.is_active ? 'í™œì„±' : 'ë¹„í™œì„±'}
                    </span>
                  </div>
                </div>
              </div>
              
              <div className="flex items-center space-x-2">
                <Tooltip content="ì„¤ì • ìˆ˜ì •">
                  <button className="p-2 rounded-lg transition-colors"
                          style={{ backgroundColor: 'var(--bg-secondary)' }}>
                    <UIIcon emoji="âœï¸" size="sm" />
                  </button>
                </Tooltip>
                <Tooltip content="ì‚¬ìš©ëŸ‰ í™•ì¸">
                  <button className="p-2 rounded-lg transition-colors"
                          style={{ backgroundColor: 'var(--bg-secondary)' }}>
                    <UIIcon emoji="ğŸ“Š" size="sm" />
                  </button>
                </Tooltip>
                <Tooltip content="ì„¤ì • ì‚­ì œ">
                  <button className="p-2 rounded-lg transition-colors text-red-600">
                    <UIIcon emoji="ğŸ—‘ï¸" size="sm" />
                  </button>
                </Tooltip>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};
```

### 2. ì‚¬ìš©ì AI ê¸°ëŠ¥ í• ë‹¹ ì»´í¬ë„ŒíŠ¸
```typescript
// src/components/admin/UserAIAssignment.tsx
const UserManagementTab: React.FC<{
  userAccess: UserAIAccess[];
  onUpdate: () => void;
}> = ({ userAccess, onUpdate }) => {
  const [users, setUsers] = useState<User[]>([]);
  const [selectedUser, setSelectedUser] = useState<User | null>(null);
  const [showAssignModal, setShowAssignModal] = useState(false);

  return (
    <div className="space-y-6">
      {/* ì‚¬ìš©ìë³„ AI ê¸°ëŠ¥ í• ë‹¹ í…Œì´ë¸” */}
      <div className="rounded-lg border overflow-hidden" 
           style={{ backgroundColor: 'var(--bg-primary)', borderColor: 'var(--border-light)' }}>
        <div className="px-6 py-4 border-b" style={{ borderColor: 'var(--border-light)' }}>
          <h4 className="font-semibold" style={{ color: 'var(--text-primary)' }}>
            ì‚¬ìš©ì AI ê¸°ëŠ¥ í• ë‹¹ í˜„í™©
          </h4>
        </div>
        
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr style={{ backgroundColor: 'var(--bg-secondary)' }}>
                <th className="px-6 py-3 text-left text-sm font-medium" style={{ color: 'var(--text-secondary)' }}>
                  ì‚¬ìš©ì
                </th>
                <th className="px-6 py-3 text-left text-sm font-medium" style={{ color: 'var(--text-secondary)' }}>
                  ìš”ê¸ˆì œ
                </th>
                <th className="px-6 py-3 text-left text-sm font-medium" style={{ color: 'var(--text-secondary)' }}>
                  ì‚¬ìš©ëŸ‰ (ì´ë²ˆ ë‹¬)
                </th>
                <th className="px-6 py-3 text-left text-sm font-medium" style={{ color: 'var(--text-secondary)' }}>
                  ìƒíƒœ
                </th>
                <th className="px-6 py-3 text-left text-sm font-medium" style={{ color: 'var(--text-secondary)' }}>
                  ê´€ë¦¬
                </th>
              </tr>
            </thead>
            <tbody>
              {userAccess.map((access) => (
                <tr key={access.id} className="border-t" style={{ borderColor: 'var(--border-light)' }}>
                  <td className="px-6 py-4">
                    <div className="flex items-center space-x-3">
                      <div className="w-10 h-10 rounded-full flex items-center justify-center"
                           style={{ backgroundColor: 'var(--accent-pastel)' }}>
                        <UIIcon emoji="ğŸ‘¤" size="lg" />
                      </div>
                      <div>
                        <div className="font-medium" style={{ color: 'var(--text-primary)' }}>
                          {access.user.username}
                        </div>
                        <div className="text-sm" style={{ color: 'var(--text-secondary)' }}>
                          {access.user.email}
                        </div>
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="px-3 py-1 rounded-full text-sm font-medium"
                          style={{ 
                            backgroundColor: 'var(--accent-pastel)', 
                            color: 'var(--accent-dark)' 
                          }}>
                      {access.ai_plan.name}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    <div className="text-sm">
                      <div style={{ color: 'var(--text-primary)' }}>
                        {access.tokens_used_month.toLocaleString()} / {access.ai_plan.monthly_token_limit.toLocaleString()} í† í°
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-2 mt-1">
                        <div 
                          className="h-2 rounded-full" 
                          style={{ 
                            backgroundColor: 'var(--accent-primary)',
                            width: `${Math.min(100, (access.tokens_used_month / access.ai_plan.monthly_token_limit) * 100)}%`
                          }}
                        ></div>
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                      access.is_enabled ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                    }`}>
                      {access.is_enabled ? 'í™œì„±' : 'ë¹„í™œì„±'}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center space-x-2">
                      <Tooltip content="ì„¤ì • ìˆ˜ì •">
                        <button className="p-1 rounded transition-colors"
                                style={{ backgroundColor: 'var(--bg-secondary)' }}>
                          <UIIcon emoji="âœï¸" size="sm" />
                        </button>
                      </Tooltip>
                      <Tooltip content="ì‚¬ìš©ëŸ‰ ì´ˆê¸°í™”">
                        <button className="p-1 rounded transition-colors"
                                style={{ backgroundColor: 'var(--warning-pastel)' }}>
                          <UIIcon emoji="ğŸ”„" size="sm" />
                        </button>
                      </Tooltip>
                      <Tooltip content="ê¸°ëŠ¥ ë¹„í™œì„±í™”">
                        <button className="p-1 rounded transition-colors text-red-600">
                          <UIIcon emoji="ğŸš«" size="sm" />
                        </button>
                      </Tooltip>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};
```

---

## ğŸ”§ ë°±ì—”ë“œ API ê°œë°œ

### Django REST API Views
```python
# backend/views/ai_management.py
from rest_framework import viewsets, status
from rest_framework.decorators import action
from rest_framework.response import Response
from rest_framework.permissions import IsAuthenticated
from django.contrib.admin.views.decorators import staff_member_required
from django.utils.decorators import method_decorator
from django.db import transaction
from django.utils import timezone
from datetime import timedelta

from .models import AIServiceSettings, UserAIAccess, AIUsageLog, AIServicePlan
from .serializers import (
    AIServiceSettingsSerializer, 
    UserAIAccessSerializer, 
    AIUsageLogSerializer,
    AIServicePlanSerializer
)

@method_decorator(staff_member_required, name='dispatch')
class AIServiceSettingsViewSet(viewsets.ModelViewSet):
    """AI ì„œë¹„ìŠ¤ ì„¤ì • ê´€ë¦¬ (ìŠˆí¼ê´€ë¦¬ì ì „ìš©)"""
    queryset = AIServiceSettings.objects.all()
    serializer_class = AIServiceSettingsSerializer
    permission_classes = [IsAuthenticated]
    
    def perform_create(self, serializer):
        serializer.save(created_by=self.request.user)
    
    @action(detail=True, methods=['post'])
    def test_connection(self, request, pk=None):
        """AI ì„œë¹„ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸"""
        setting = self.get_object()
        try:
            # API í‚¤ ìœ íš¨ì„± ê²€ì¦ ë¡œì§
            from ..services.ai_service import AIService
            ai_service = AIService(setting)
            is_valid = ai_service.test_connection()
            
            return Response({
                'success': True,
                'is_valid': is_valid,
                'message': 'ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ' if is_valid else 'API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'
            })
        except Exception as e:
            return Response({
                'success': False,
                'error': str(e)
            }, status=status.HTTP_400_BAD_REQUEST)

@method_decorator(staff_member_required, name='dispatch')
class UserAIAccessViewSet(viewsets.ModelViewSet):
    """ì‚¬ìš©ì AI ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬"""
    queryset = UserAIAccess.objects.select_related('user', 'ai_plan', 'ai_settings')
    serializer_class = UserAIAccessSerializer
    permission_classes = [IsAuthenticated]
    
    @action(detail=False, methods=['post'])
    def bulk_assign(self, request):
        """ì‚¬ìš©ìë“¤ì—ê²Œ ì¼ê´„ AI ê¸°ëŠ¥ í• ë‹¹"""
        user_ids = request.data.get('user_ids', [])
        ai_plan_id = request.data.get('ai_plan_id')
        ai_settings_id = request.data.get('ai_settings_id')
        
        try:
            with transaction.atomic():
                for user_id in user_ids:
                    UserAIAccess.objects.update_or_create(
                        user_id=user_id,
                        defaults={
                            'ai_plan_id': ai_plan_id,
                            'ai_settings_id': ai_settings_id,
                            'assigned_by': request.user,
                            'is_enabled': True
                        }
                    )
            
            return Response({
                'success': True,
                'message': f'{len(user_ids)}ëª…ì˜ ì‚¬ìš©ìì—ê²Œ AI ê¸°ëŠ¥ì´ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.'
            })
        except Exception as e:
            return Response({
                'success': False,
                'error': str(e)
            }, status=status.HTTP_400_BAD_REQUEST)
    
    @action(detail=True, methods=['post'])
    def reset_usage(self, request, pk=None):
        """ì‚¬ìš©ëŸ‰ ì´ˆê¸°í™”"""
        access = self.get_object()
        access.tokens_used_today = 0
        access.tokens_used_month = 0
        access.requests_today = 0
        access.last_reset_date = timezone.now().date()
        access.save()
        
        return Response({
            'success': True,
            'message': 'ì‚¬ìš©ëŸ‰ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.'
        })

class AIUsageLogViewSet(viewsets.ReadOnlyModelViewSet):
    """AI ì‚¬ìš© ë¡œê·¸ ì¡°íšŒ"""
    queryset = AIUsageLog.objects.select_related('user', 'ai_settings')
    serializer_class = AIUsageLogSerializer
    permission_classes = [IsAuthenticated]
    
    def get_queryset(self):
        queryset = super().get_queryset()
        
        # ë‚ ì§œ í•„í„°ë§
        start_date = self.request.query_params.get('start_date')
        end_date = self.request.query_params.get('end_date')
        if start_date:
            queryset = queryset.filter(created_at__date__gte=start_date)
        if end_date:
            queryset = queryset.filter(created_at__date__lte=end_date)
        
        # ì‚¬ìš©ì í•„í„°ë§ (ìŠˆí¼ê´€ë¦¬ìê°€ ì•„ë‹Œ ê²½ìš° ìì‹ ì˜ ë¡œê·¸ë§Œ)
        if not self.request.user.is_staff:
            queryset = queryset.filter(user=self.request.user)
        
        return queryset.order_by('-created_at')
    
    @action(detail=False, methods=['get'])
    def usage_statistics(self, request):
        """ì‚¬ìš©ëŸ‰ í†µê³„"""
        from django.db.models import Sum, Count, Avg
        from django.db.models.functions import TruncDate
        
        # ì¼ê°„ ì‚¬ìš©ëŸ‰ í†µê³„
        daily_stats = AIUsageLog.objects.filter(
            created_at__gte=timezone.now() - timedelta(days=30)
        ).values('created_at__date').annotate(
            total_tokens=Sum('tokens_used'),
            total_cost=Sum('cost'),
            request_count=Count('id'),
            avg_response_time=Avg('response_time')
        ).order_by('created_at__date')
        
        # ì‚¬ìš©ìë³„ í†µê³„
        user_stats = AIUsageLog.objects.filter(
            created_at__gte=timezone.now() - timedelta(days=30)
        ).values('user__username').annotate(
            total_tokens=Sum('tokens_used'),
            total_cost=Sum('cost'),
            request_count=Count('id')
        ).order_by('-total_tokens')[:10]
        
        return Response({
            'daily_statistics': list(daily_stats),
            'top_users': list(user_stats),
            'period': 'ìµœê·¼ 30ì¼'
        })
```

### Serializers
```python
# backend/serializers/ai_serializers.py
from rest_framework import serializers
from django.contrib.auth.models import User
from .models import AIServiceSettings, UserAIAccess, AIUsageLog, AIServicePlan

class AIServicePlanSerializer(serializers.ModelSerializer):
    class Meta:
        model = AIServicePlan
        fields = '__all__'

class AIServiceSettingsSerializer(serializers.ModelSerializer):
    created_by_name = serializers.CharField(source='created_by.username', read_only=True)
    
    class Meta:
        model = AIServiceSettings
        fields = '__all__'
        extra_kwargs = {
            'api_key': {'write_only': True}  # ë³´ì•ˆì„ ìœ„í•´ ì½ê¸° ì‹œ ìˆ¨ê¹€
        }

class UserAIAccessSerializer(serializers.ModelSerializer):
    user_info = serializers.SerializerMethodField()
    ai_plan_info = serializers.SerializerMethodField()
    ai_settings_info = serializers.SerializerMethodField()
    usage_percentage = serializers.SerializerMethodField()
    
    class Meta:
        model = UserAIAccess
        fields = '__all__'
    
    def get_user_info(self, obj):
        return {
            'id': obj.user.id,
            'username': obj.user.username,
            'email': obj.user.email,
            'first_name': obj.user.first_name,
            'last_name': obj.user.last_name
        }
    
    def get_ai_plan_info(self, obj):
        return {
            'name': obj.ai_plan.name,
            'display_name': obj.ai_plan.get_name_display(),
            'monthly_cost': obj.ai_plan.monthly_cost,
            'monthly_token_limit': obj.ai_plan.monthly_token_limit
        }
    
    def get_ai_settings_info(self, obj):
        if obj.ai_settings:
            return {
                'name': obj.ai_settings.name,
                'provider': obj.ai_settings.provider,
                'model_name': obj.ai_settings.model_name
            }
        return None
    
    def get_usage_percentage(self, obj):
        if obj.ai_plan.monthly_token_limit > 0:
            return round((obj.tokens_used_month / obj.ai_plan.monthly_token_limit) * 100, 2)
        return 0

class AIUsageLogSerializer(serializers.ModelSerializer):
    user_name = serializers.CharField(source='user.username', read_only=True)
    ai_settings_name = serializers.CharField(source='ai_settings.name', read_only=True)
    
    class Meta:
        model = AIUsageLog
        fields = '__all__'
```

---

## ğŸ¯ í”„ë¡¬í”„íŠ¸ ìë™ ì €ì¥ ì‹œìŠ¤í…œ

### ê°œë°œ í”„ë¡¬í”„íŠ¸ ì €ì¥ ì»´í¬ë„ŒíŠ¸
```typescript
// src/utils/promptLogger.ts
interface PromptLog {
  timestamp: string;
  user_prompt: string;
  ai_response?: string;
  context: string;
  session_id: string;
}

class PromptLogger {
  private logs: PromptLog[] = [];
  private sessionId: string;
  
  constructor() {
    this.sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    this.loadExistingLogs();
  }
  
  // í”„ë¡¬í”„íŠ¸ ì €ì¥
  logPrompt(userPrompt: string, context: string = 'general', aiResponse?: string) {
    const log: PromptLog = {
      timestamp: new Date().toISOString(),
      user_prompt: userPrompt,
      ai_response: aiResponse,
      context: context,
      session_id: this.sessionId
    };
    
    this.logs.push(log);
    this.saveToLocalStorage();
    this.saveToBackend(log);
  }
  
  // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
  private saveToLocalStorage() {
    try {
      localStorage.setItem('ahp_prompt_logs', JSON.stringify(this.logs));
    } catch (error) {
      console.error('í”„ë¡¬í”„íŠ¸ ë¡œì»¬ ì €ì¥ ì‹¤íŒ¨:', error);
    }
  }
  
  // ë°±ì—”ë“œì— ì €ì¥
  private async saveToBackend(log: PromptLog) {
    try {
      await fetch('/api/prompt-logs/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('authToken')}`
        },
        body: JSON.stringify(log)
      });
    } catch (error) {
      console.error('í”„ë¡¬í”„íŠ¸ ë°±ì—”ë“œ ì €ì¥ ì‹¤íŒ¨:', error);
    }
  }
  
  // ê¸°ì¡´ ë¡œê·¸ ë¡œë“œ
  private loadExistingLogs() {
    try {
      const saved = localStorage.getItem('ahp_prompt_logs');
      if (saved) {
        this.logs = JSON.parse(saved);
      }
    } catch (error) {
      console.error('í”„ë¡¬í”„íŠ¸ ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:', error);
      this.logs = [];
    }
  }
  
  // ê°œë°œì¼ì§€ í˜•ì‹ìœ¼ë¡œ ì €ì¥
  async saveAsDevelopmentLog() {
    const today = new Date();
    const dateStr = today.toISOString().split('T')[0].replace(/-/g, '');
    const fileName = `ê°œë°œì¼ì§€_${dateStr}_í”„ë¡¬í”„íŠ¸_ë¡œê·¸.md`;
    
    const content = this.generateMarkdownContent();
    
    try {
      // ë°±ì—”ë“œ APIë¥¼ í†µí•´ íŒŒì¼ ì €ì¥
      await fetch('/api/save-development-log/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('authToken')}`
        },
        body: JSON.stringify({
          filename: fileName,
          content: content,
          folder: 'development_logs'
        })
      });
      
      console.log(`ê°œë°œì¼ì§€ ì €ì¥ ì™„ë£Œ: ${fileName}`);
    } catch (error) {
      console.error('ê°œë°œì¼ì§€ ì €ì¥ ì‹¤íŒ¨:', error);
    }
  }
  
  // ë§ˆí¬ë‹¤ìš´ ì½˜í…ì¸  ìƒì„±
  private generateMarkdownContent(): string {
    const today = new Date();
    const dateStr = today.toLocaleDateString('ko-KR');
    const timeStr = today.toLocaleTimeString('ko-KR');
    
    let content = `# ê°œë°œì¼ì§€ - í”„ë¡¬í”„íŠ¸ ë¡œê·¸
## AI í˜‘ì—… ì„¸ì…˜ ê¸°ë¡

**ì‘ì„±ì¼**: ${dateStr} ${timeStr}  
**ì„¸ì…˜ ID**: ${this.sessionId}  
**ì´ í”„ë¡¬í”„íŠ¸ ìˆ˜**: ${this.logs.length}ê°œ  

---

## ğŸ“ í”„ë¡¬í”„íŠ¸ ìƒì„¸ ê¸°ë¡

`;

    this.logs.forEach((log, index) => {
      content += `### ${index + 1}. ${log.context} (${new Date(log.timestamp).toLocaleTimeString('ko-KR')})

**ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸:**
\`\`\`
${log.user_prompt}
\`\`\`

`;

      if (log.ai_response) {
        content += `**AI ì‘ë‹µ ìš”ì•½:**
\`\`\`
${log.ai_response.length > 500 ? log.ai_response.substring(0, 500) + '...' : log.ai_response}
\`\`\`

`;
      }

      content += `---

`;
    });

    content += `## ğŸ“Š ì„¸ì…˜ í†µê³„

- **ì´ í”„ë¡¬í”„íŠ¸ ìˆ˜**: ${this.logs.length}ê°œ
- **í‰ê·  í”„ë¡¬í”„íŠ¸ ê¸¸ì´**: ${Math.round(this.logs.reduce((sum, log) => sum + log.user_prompt.length, 0) / this.logs.length)}ì
- **ì£¼ìš” ì»¨í…ìŠ¤íŠ¸**: ${this.getMostFrequentContext()}
- **ì„¸ì…˜ ì‹œì‘**: ${new Date(this.logs[0]?.timestamp).toLocaleString('ko-KR')}
- **ì„¸ì…˜ ì¢…ë£Œ**: ${new Date(this.logs[this.logs.length - 1]?.timestamp).toLocaleString('ko-KR')}

---

**ì €ì¥ ì™„ë£Œ**: ${dateStr} ${timeStr}  
**ìë™ ìƒì„±**: AHP í”Œë«í¼ í”„ë¡¬í”„íŠ¸ ë¡œê±°
`;

    return content;
  }
  
  // ê°€ì¥ ë¹ˆë²ˆí•œ ì»¨í…ìŠ¤íŠ¸ ì°¾ê¸°
  private getMostFrequentContext(): string {
    const contextCounts: { [key: string]: number } = {};
    this.logs.forEach(log => {
      contextCounts[log.context] = (contextCounts[log.context] || 0) + 1;
    });
    
    return Object.keys(contextCounts).reduce((a, b) => 
      contextCounts[a] > contextCounts[b] ? a : b
    );
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
export const promptLogger = new PromptLogger();
```

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ êµ¬í˜„ ê³„íš

### 1. ìš°ì„ ìˆœìœ„ ê°œë°œ ìˆœì„œ
```
ğŸš€ Phase 1 (ì´ë²ˆ ì£¼):
â”œâ”€â”€ ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ ìƒì„± ë° ë§ˆì´ê·¸ë ˆì´ì…˜
â”œâ”€â”€ Django ê´€ë¦¬ì í˜ì´ì§€ ì„¤ì •
â”œâ”€â”€ ê¸°ë³¸ API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
â””â”€â”€ í”„ë¡¬í”„íŠ¸ ë¡œê±° ê¸°ë³¸ ê¸°ëŠ¥

ğŸ”§ Phase 2 (ë‹¤ìŒ ì£¼):
â”œâ”€â”€ ìŠˆí¼ê´€ë¦¬ì í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ ì‚¬ìš©ì AI ê¸°ëŠ¥ í• ë‹¹ ì‹œìŠ¤í…œ
â”œâ”€â”€ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
â””â”€â”€ ìë™ í”„ë¡¬í”„íŠ¸ ì €ì¥ ê¸°ëŠ¥

âš¡ Phase 3 (ì™„ì„±):
â”œâ”€â”€ ì‹¤ì‹œê°„ ì‚¬ìš©ëŸ‰ ì•Œë¦¼
â”œâ”€â”€ ìë™ ìš”ê¸ˆ ê³„ì‚°
â”œâ”€â”€ ê³ ê¸‰ ë¶„ì„ ë¦¬í¬íŠ¸
â””â”€â”€ ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸
```

### 2. ê¸°ìˆ ì  ê³ ë ¤ì‚¬í•­
- **ë³´ì•ˆ**: API í‚¤ ì•”í˜¸í™” ì €ì¥ ë° ì „ì†¡
- **ì„±ëŠ¥**: ì‚¬ìš©ëŸ‰ ë¡œê·¸ ìµœì í™” ë° ì¸ë±ì‹±
- **í™•ì¥ì„±**: ë‹¤ì–‘í•œ AI ì„œë¹„ìŠ¤ ì§€ì› êµ¬ì¡°
- **ëª¨ë‹ˆí„°ë§**: ì‹¤ì‹œê°„ ì‚¬ìš©ëŸ‰ ì¶”ì  ì‹œìŠ¤í…œ

ì´ì œ ì²´ê³„ì ìœ¼ë¡œ êµ¬í˜„ì„ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤! ğŸš€