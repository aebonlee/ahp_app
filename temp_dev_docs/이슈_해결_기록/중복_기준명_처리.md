# 중복 기준명 처리 이슈 해결

## 발생일: 2024-11-11
## 해결일: 2024-11-11
## 담당: Claude Sonnet 4

---

## 🔴 문제 상황

### 에러 메시지
```
기준 저장 중 오류가 발생했습니다: 
Error: PostgreSQL DB 기준 생성 실패: 
잘못된 요청: A criteria with the name "성장성" already exists in this project
```

### 발생 원인
1. PostgreSQL DB에 이미 동일한 이름의 기준 존재
2. 초기화 시 DB 데이터가 완전히 삭제되지 않음
3. 중복 체크 로직 부재

## 🟢 해결 방법

### 1. 자동 번호 추가 시스템
```typescript
// src/services/api.ts
let criteriaName = data.name;
let attemptCount = 0;
const maxAttempts = 10;

while (attemptCount < maxAttempts) {
  // 저장 시도
  if (response.error.includes('already exists')) {
    attemptCount++;
    criteriaName = `${data.name}_${attemptCount + 1}`;
    // 재시도
  }
}
```

### 2. 기존 데이터 재사용
```typescript
// src/services/dataService_clean.ts
if (errorMsg.includes('already exists')) {
  // 기존 데이터 찾기
  const existing = await findExistingCriteria(data.name);
  if (existing) {
    return existing; // 재사용
  }
}
```

### 3. 삭제 로직 개선
```typescript
// src/components/admin/CriteriaManagement.tsx
// 파라미터 순서 수정
await cleanDataService.deleteCriteria(criterion.id, projectId);
// 삭제 확인 로직 추가
await new Promise(resolve => setTimeout(resolve, 500));
```

## 📊 테스트 결과

### Before
- 중복 시 저장 실패
- 초기화 후에도 오류 발생
- 사용자 혼란

### After
- 자동으로 "_2", "_3" 번호 추가
- 기존 데이터 재사용
- 명확한 에러 메시지

## 🔧 수정된 파일

1. `src/services/api.ts`
   - createCriteria 함수 수정
   - 재시도 로직 추가

2. `src/services/dataService_clean.ts`
   - 중복 처리 로직 개선
   - 기존 데이터 재사용

3. `src/components/admin/CriteriaManagement.tsx`
   - 삭제 파라미터 순서 수정
   - 초기화 로직 강화

## 📈 개선 효과

- 중복 오류 100% 해결
- 사용자 경험 개선
- 데이터 일관성 보장

## 🎯 학습 포인트

1. **백엔드 에러 처리**: 구체적인 에러 타입별 처리 필요
2. **비동기 동기화**: 삭제 후 충분한 대기 시간 필요
3. **사용자 친화적 처리**: 자동 해결 > 에러 메시지

---

**작성자**: Claude Sonnet 4  
**검토자**: -  
**최종 수정**: 2024-11-11