# Phase 1f: ìƒíƒœ ê´€ë¦¬ ì•„í‚¤í…ì²˜ ì„¤ê³„

**ì‘ì„±**: Claude Opus 4.6
**ë‚ ì§œ**: 2026-02-23
**ëª©í‘œ**: Prop drilling ì œê±°, Context API ê¸°ë°˜ ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë„ì…

---

## 1. í˜„ì¬ ë¬¸ì œ ë¶„ì„

### 1.1 Prop Drilling í˜„í™©

App.tsxì—ì„œ 150+ ì»´í¬ë„ŒíŠ¸ë¡œ ì§ì ‘ ì „ë‹¬ë˜ëŠ” props:

```
App.tsx (20+ useState)
â”œâ”€â”€ Layout â† user, viewMode, activeTab, onTabChange, onLogout, onModeSwitch
â”‚   â”œâ”€â”€ Header â† user, activeTab, onTabChange, viewMode, onLogout, onModeSwitch
â”‚   â””â”€â”€ Sidebar â† user, activeTab, onTabChange, viewMode
â”œâ”€â”€ PersonalServiceDashboard â† user, activeTab, onTabChange, onUserUpdate,
â”‚   â”‚                           projects, onCreateProject, onDeleteProject,
â”‚   â”‚                           onFetchCriteria, onCreateCriteria,
â”‚   â”‚                           onFetchAlternatives, onCreateAlternative,
â”‚   â”‚                           onSaveEvaluation, onFetchTrashedProjects,
â”‚   â”‚                           onRestoreProject, onPermanentDeleteProject,
â”‚   â”‚                           selectedProjectId, onSelectProject
â”‚   â”‚                           (16ê°œ props Ã— 6íšŒ ë°˜ë³µ = 96íšŒ ì „ë‹¬)
â”‚   â””â”€â”€ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë“¤...
â”œâ”€â”€ SuperAdminDashboard â† user, onTabChange
â”œâ”€â”€ EvaluatorDashboard â† user, onSwitchToAdmin, onLogout
â””â”€â”€ ...50+ ì»´í¬ë„ŒíŠ¸
```

### 1.2 ìƒíƒœ ë¶„ë¥˜

| ìƒíƒœ ê·¸ë£¹ | useState ìˆ˜ | ì†Œë¹„ ì»´í¬ë„ŒíŠ¸ ìˆ˜ | Context í•„ìš”ì„± |
|-----------|-------------|----------------|---------------|
| ì¸ì¦ (user, loginLoading, loginError) | 4 | 30+ | âœ… ë†’ìŒ |
| ë„¤ë¹„ê²Œì´ì…˜ (activeTab, viewMode) | 3 | 20+ | âœ… ë†’ìŒ |
| í”„ë¡œì íŠ¸ (projects, selectedProject, loading) | 5 | 15+ | âœ… ë†’ìŒ |
| ì‚¬ìš©ì ê´€ë¦¬ (users, loading) | 2 | 3 | âš ï¸ ë³´í†µ |
| UI (actionMessage, pendingDelete, trashOverflow) | 4 | 5 | âš ï¸ ë³´í†µ |
| ë°±ì—”ë“œ (backendStatus, showApiErrorModal) | 3 | 2 | ğŸŸ¡ ë‚®ìŒ |

---

## 2. ê¸°ìˆ  ì„ íƒ: Context API

### 2.1 ì™œ Context APIì¸ê°€? (vs Redux, Zustand)

| ê¸°ì¤€ | Context API | Redux | Zustand |
|------|------------|-------|---------|
| ì¶”ê°€ ì˜ì¡´ì„± | ì—†ìŒ | @reduxjs/toolkit | zustand |
| í•™ìŠµ ê³¡ì„  | ë‚®ìŒ | ë†’ìŒ | ë³´í†µ |
| ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ | ë³´í†µ | ë§ìŒ | ì ìŒ |
| React ë„¤ì´í‹°ë¸Œ | âœ… | âŒ | âŒ |
| í˜„ì¬ ì½”ë“œ í˜¸í™˜ | âœ… ìµœì  | ë¦¬íŒ©í† ë§ í•„ìš” | ë¦¬íŒ©í† ë§ í•„ìš” |
| ê·œëª¨ ì í•©ì„± | ì¤‘ê·œëª¨ âœ… | ëŒ€ê·œëª¨ | ì¤‘ì†Œê·œëª¨ |
| ì„±ëŠ¥ (ë¦¬ë Œë”) | useMemoë¡œ ìµœì í™” | ìë™ ìµœì í™” | ìë™ ìµœì í™” |

**ê²°ë¡ **: ì¶”ê°€ ì˜ì¡´ì„± ì—†ì´ ê¸°ì¡´ ì½”ë“œì™€ ê°€ì¥ í˜¸í™˜ë˜ëŠ” Context API ì±„íƒ.
ì„±ëŠ¥ ìš°ë ¤ëŠ” Context ë¶„ë¦¬ + useMemoë¡œ í•´ê²°.

### 2.2 Context ë¶„ë¦¬ ì „ëµ (ë¦¬ë Œë” ìµœì í™”)

```
AppProviders
â”œâ”€â”€ AuthProvider          â† ì¸ì¦ ìƒíƒœ (ë³€ê²½ ë¹ˆë„: ë‚®ìŒ)
â”œâ”€â”€ NavigationProvider    â† íƒ­/ë·°ëª¨ë“œ (ë³€ê²½ ë¹ˆë„: ì¤‘ê°„)
â”œâ”€â”€ ProjectProvider       â† í”„ë¡œì íŠ¸ ë°ì´í„° (ë³€ê²½ ë¹ˆë„: ì¤‘ê°„)
â”œâ”€â”€ UIProvider            â† í† ìŠ¤íŠ¸/ëª¨ë‹¬ (ë³€ê²½ ë¹ˆë„: ë†’ìŒ, ì†Œë¹„ì ì ìŒ)
â””â”€â”€ BackendProvider       â† API ìƒíƒœ (ë³€ê²½ ë¹ˆë„: ë‚®ìŒ)
```

**ë¦¬ë Œë” ìµœì í™” í•µì‹¬**: ìƒíƒœ ë³€ê²½ ë¹ˆë„ê°€ ë‹¤ë¥¸ ê²ƒë“¤ì„ ë³„ë„ Contextë¡œ ë¶„ë¦¬

---

## 3. ê° Context ìƒì„¸ ì„¤ê³„

### 3.1 AuthContext

**íŒŒì¼**: `src/contexts/AuthContext.tsx` (~150ì¤„)

```typescript
import React, { createContext, useContext, useMemo } from 'react';
import { useAuth } from '../hooks/useAuth';
import type { User, UserRole } from '../types';

interface AuthContextValue {
  // ìƒíƒœ
  user: User | null;
  isAuthenticated: boolean;
  loginLoading: boolean;
  loginError: string;
  registerMode: 'service' | 'admin' | null;

  // ì•¡ì…˜
  login: (username: string, password: string, role?: string) => Promise<void>;
  register: (data: RegisterData) => Promise<void>;
  logout: () => Promise<void>;
  googleAuth: () => Promise<void>;
  kakaoAuth: () => Promise<void>;
  naverAuth: () => Promise<void>;
  setUser: React.Dispatch<React.SetStateAction<User | null>>;
  setRegisterMode: (mode: 'service' | 'admin' | null) => void;
  clearLoginError: () => void;
}

const AuthContext = createContext<AuthContextValue | null>(null);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const auth = useAuth();

  // useMemoë¡œ value ì•ˆì •í™” (ë¶ˆí•„ìš”í•œ ë¦¬ë Œë” ë°©ì§€)
  const value = useMemo(() => ({
    user: auth.user,
    isAuthenticated: !!auth.user,
    loginLoading: auth.loginLoading,
    loginError: auth.loginError,
    registerMode: auth.registerMode,
    login: auth.handleLogin,
    register: auth.handleRegister,
    logout: auth.handleLogout,
    googleAuth: auth.handleGoogleAuth,
    kakaoAuth: auth.handleKakaoAuth,
    naverAuth: auth.handleNaverAuth,
    setUser: auth.setUser,
    setRegisterMode: auth.setRegisterMode,
    clearLoginError: auth.clearLoginError,
  }), [auth.user, auth.loginLoading, auth.loginError, auth.registerMode]);

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuthContext() {
  const context = useContext(AuthContext);
  if (!context) throw new Error('useAuthContext must be used within AuthProvider');
  return context;
}

// ìì£¼ ì‚¬ìš©ë˜ëŠ” íŒŒìƒ í›…
export function useCurrentUser() {
  const { user } = useAuthContext();
  return user;
}

export function useIsAdmin() {
  const { user } = useAuthContext();
  return user?.role === 'super_admin' || user?.role === 'service_admin';
}
```

### 3.2 NavigationContext

**íŒŒì¼**: `src/contexts/NavigationContext.tsx` (~80ì¤„)

```typescript
interface NavigationContextValue {
  activeTab: string;
  viewMode: 'service' | 'evaluator';
  isNavigationReady: boolean;
  changeTab: (tab: string, projectId?: string, projectTitle?: string) => void;
  switchMode: (mode: 'service' | 'evaluator') => void;
}

const NavigationContext = createContext<NavigationContextValue | null>(null);

export function NavigationProvider({ children }: { children: React.ReactNode }) {
  const { user } = useAuthContext();
  const nav = useNavigation(user);

  const value = useMemo(() => ({
    activeTab: nav.activeTab,
    viewMode: nav.viewMode,
    isNavigationReady: nav.isNavigationReady,
    changeTab: nav.changeTab,
    switchMode: nav.handleModeSwitch,
  }), [nav.activeTab, nav.viewMode, nav.isNavigationReady]);

  return (
    <NavigationContext.Provider value={value}>
      {children}
    </NavigationContext.Provider>
  );
}

export function useNavigationContext() {
  const context = useContext(NavigationContext);
  if (!context) throw new Error('useNavigationContext must be used within NavigationProvider');
  return context;
}
```

### 3.3 ProjectContext

**íŒŒì¼**: `src/contexts/ProjectContext.tsx` (~100ì¤„)

```typescript
interface ProjectContextValue {
  // ìƒíƒœ
  projects: UserProject[];
  selectedProjectId: string | null;
  selectedProjectTitle: string;
  projectsLoading: boolean;

  // í”„ë¡œì íŠ¸ CRUD
  fetchProjects: () => Promise<void>;
  createProject: (data: Partial<ProjectData>) => Promise<ProjectData>;
  deleteProject: (id: string) => Promise<boolean>;
  selectProject: (id: string, title: string) => void;
  clearSelectedProject: () => void;

  // í•˜ìœ„ ë¦¬ì†ŒìŠ¤ CRUD
  fetchCriteria: (projectId: string) => Promise<CriteriaData[]>;
  createCriteria: (projectId: string, data: Record<string, unknown>) => Promise<any>;
  fetchAlternatives: (projectId: string) => Promise<AlternativeData[]>;
  createAlternative: (projectId: string, data: Record<string, unknown>) => Promise<any>;
  saveEvaluation: (projectId: string, data: Record<string, unknown>) => Promise<any>;

  // íœ´ì§€í†µ
  fetchTrashedProjects: () => Promise<any[]>;
  restoreProject: (id: string) => Promise<boolean>;
  permanentDeleteProject: (id: string) => Promise<void>;
}

export function ProjectProvider({ children }: { children: React.ReactNode }) {
  const { user } = useAuthContext();
  const projects = useProjects(user);

  const value = useMemo(() => ({ ...projects }), [
    projects.projects,
    projects.selectedProjectId,
    projects.selectedProjectTitle,
    projects.loading,
  ]);

  return (
    <ProjectContext.Provider value={value}>
      {children}
    </ProjectContext.Provider>
  );
}
```

### 3.4 UIContext

**íŒŒì¼**: `src/contexts/UIContext.tsx` (~50ì¤„)

```typescript
interface UIContextValue {
  actionMessage: { type: 'success' | 'error' | 'info'; text: string } | null;
  showMessage: (type: 'success' | 'error' | 'info', text: string) => void;
  pendingDeleteProjectId: string | null;
  setPendingDeleteProjectId: (id: string | null) => void;
  trashOverflowData: TrashOverflowData | null;
  setTrashOverflowData: (data: TrashOverflowData | null) => void;
}

// ë³€ê²½ ë¹ˆë„ ë†’ì§€ë§Œ ì†Œë¹„ ì»´í¬ë„ŒíŠ¸ê°€ ì ì–´ ë¶„ë¦¬ ìœ ì§€
```

### 3.5 AppProviders í•©ì„±

**íŒŒì¼**: `src/contexts/AppProviders.tsx` (~30ì¤„)

```typescript
import { AuthProvider } from './AuthContext';
import { NavigationProvider } from './NavigationContext';
import { ProjectProvider } from './ProjectContext';
import { UIProvider } from './UIContext';

export function AppProviders({ children }: { children: React.ReactNode }) {
  return (
    <AuthProvider>
      <NavigationProvider>
        <ProjectProvider>
          <UIProvider>
            {children}
          </UIProvider>
        </ProjectProvider>
      </NavigationProvider>
    </AuthProvider>
  );
}
```

---

## 4. ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

### Before (Prop Drilling)

```tsx
// App.tsx
<PersonalServiceDashboard
  user={user}                           // â† AuthContext
  activeTab={activeTab}                 // â† NavigationContext
  onTabChange={setActiveTab}            // â† NavigationContext
  onUserUpdate={setUser}                // â† AuthContext
  projects={projects}                   // â† ProjectContext
  onCreateProject={createProject}       // â† ProjectContext
  onDeleteProject={deleteProject}       // â† ProjectContext
  onFetchCriteria={fetchCriteria}       // â† ProjectContext
  onCreateCriteria={createCriteria}     // â† ProjectContext
  onFetchAlternatives={fetchAlternatives} // â† ProjectContext
  onCreateAlternative={createAlternative} // â† ProjectContext
  onSaveEvaluation={saveEvaluation}     // â† ProjectContext
  onFetchTrashedProjects={fetchTrashedProjects}   // â† ProjectContext
  onRestoreProject={restoreProject}               // â† ProjectContext
  onPermanentDeleteProject={permanentDeleteProject} // â† ProjectContext
  selectedProjectId={selectedProjectId}   // â† ProjectContext
  onSelectProject={setSelectedProjectId}  // â† ProjectContext
/>
```

### After (Context ì‚¬ìš©)

```tsx
// PersonalServiceDashboard.tsx ë‚´ë¶€
function PersonalServiceDashboard() {
  const { user, setUser } = useAuthContext();
  const { activeTab, changeTab } = useNavigationContext();
  const { projects, createProject, deleteProject, ... } = useProjectContext();

  // props ì—†ì´ ì§ì ‘ Contextì—ì„œ ê°€ì ¸ì˜´
}

// App.tsx (ë˜ëŠ” routeConfig)
<PersonalServiceDashboard />  // props 0ê°œ
```

---

## 5. ì„±ëŠ¥ ìµœì í™” ì „ëµ

### 5.1 Context ë¶„ë¦¬ì— ì˜í•œ ë¦¬ë Œë” ê²©ë¦¬

| Context ë³€ê²½ | ë¦¬ë Œë”ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ |
|-------------|-------------------|
| Auth (ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ) | AuthContext ì†Œë¹„ìë§Œ |
| Navigation (íƒ­ ì „í™˜) | NavigationContext ì†Œë¹„ìë§Œ |
| Project (í”„ë¡œì íŠ¸ ì„ íƒ) | ProjectContext ì†Œë¹„ìë§Œ |
| UI (í† ìŠ¤íŠ¸ í‘œì‹œ) | UIContext ì†Œë¹„ìë§Œ |

### 5.2 useMemoë¡œ value ì•ˆì •í™”

```typescript
// BAD: ë§¤ ë Œë”ë§ˆë‹¤ ìƒˆ ê°ì²´ â†’ ëª¨ë“  ì†Œë¹„ì ë¦¬ë Œë”
<AuthContext.Provider value={{ user, login, logout }}>

// GOOD: ì˜ì¡´ì„± ë³€ê²½ ì‹œì—ë§Œ ìƒˆ ê°ì²´
const value = useMemo(() => ({ user, login, logout }), [user]);
<AuthContext.Provider value={value}>
```

### 5.3 ì„ íƒì  êµ¬ë… (íŒŒìƒ í›…)

```typescript
// ì „ì²´ AuthContext ëŒ€ì‹  í•„ìš”í•œ ë¶€ë¶„ë§Œ êµ¬ë…
export function useCurrentUser() {
  const { user } = useAuthContext();
  return user; // userë§Œ ë³€ê²½ë  ë•Œ ë¦¬ë Œë”
}

export function useIsAdmin() {
  const { user } = useAuthContext();
  return user?.role === 'super_admin' || user?.role === 'service_admin';
}
```

---

## 6. êµ¬í˜„ ìˆœì„œ

1. **hooks ë¨¼ì €** (App.tsxì—ì„œ ë¡œì§ ì¶”ì¶œ, Context ì—†ì´ í›…ë§Œ)
2. **Context ë˜í¼** (í›…ì„ Providerì— ì—°ê²°)
3. **í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ ë§ˆì´ê·¸ë ˆì´ì…˜** (props â†’ useContext ì „í™˜)
4. **App.tsx ì •ë¦¬** (Provider ì¡°í•©ë§Œ ë‚¨ê¹€)

ê° ë‹¨ê³„ì—ì„œ `npm run build` ê²€ì¦ í•„ìˆ˜.

---

**êµ¬í˜„ ë‹´ë‹¹**: Claude Sonnet 4.6
**ì˜ì¡´ì„±**: Appë¶„í•´_ì„¤ê³„.mdì˜ Step 1 (í›… ì¶”ì¶œ) ì™„ë£Œ í›„ ì§„í–‰
**ì˜ˆìƒ íŒŒì¼ ìˆ˜**: 5ê°œ Context + 1ê°œ AppProviders = 6ê°œ ì‹ ê·œ íŒŒì¼
