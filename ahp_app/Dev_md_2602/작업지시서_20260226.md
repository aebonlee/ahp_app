# 작업지시서 — 2026-02-26 개발 재개용

## 사전 작업: 프로젝트 상태 확인

다음 세션 시작 시 아래 순서로 현재 상태를 확인하세요.

### 1단계: 로컬 폴더 & 리포지토리 확인
```bash
cd C:\Users\ASUS\ahp_app
git status                    # 미커밋 변경사항 확인
git log --oneline -5          # 최근 커밋 확인 (90ee74d가 최신이어야 함)
git branch -a                 # 브랜치 확인 (main + gh-pages만)
```

### 2단계: 빌드 상태 확인
```bash
npx tsc --noEmit              # TypeScript 에러 0개 확인
npm run build                 # 빌드 성공 확인 (CI=false)
```

### 3단계: 핵심 문서 읽기
```
읽기 순서:
1. CLAUDE.md (프로젝트 루트: C:\Users\ASUS\CLAUDE.md)
2. Dev_md_2602/평가보고서_20260224.md (현재 상태 평가)
3. Dev_md_2602/전체점검보고서_20260224.md (이슈 상세)
4. Dev_md_2602/개발일지_20260223.md (작업 이력 #1~#41)
```

---

## Todo List — Phase 4 (우선순위순)

### Sprint 1: 의존성 정리 및 코드 정리 (예상 2~3시간)

#### Todo 1: 불필요 패키지 제거
```
작업:
- package.json에서 아래 패키지 제거:
  - pg (PostgreSQL 클라이언트 — 서버사이드 전용)
  - node-fetch (Node.js HTTP — 서버사이드 전용)
  - @anthropic-ai/claude-agent-sdk (AI SDK — 서버사이드 전용)
  - axios (런타임 사용 0건 — fetch로 전환 완료)
- QR코드 라이브러리 3개 → 1개로 통합:
  - qrcode, qrcode.react, react-qr-code 중 react-qr-code 유지
  - 다른 2개 제거 후 import 수정
- @types/*, @testing-library/* 등을 devDependencies로 이동

검증:
- npm install 성공
- npm run build 성공
- 번들 크기 감소 확인
```

#### Todo 2: apiService 잔존 import 최종 정리
```
작업:
- 아래 13개 파일에서 'apiService' 문자열 검색:
  - admin/ProjectWorkflow.tsx
  - admin/PersonalServiceDashboard.tsx
  - admin/MyProjects.tsx
  - admin/ModelBuilderWorkflow.tsx
  - admin/EvaluatorAssignment.tsx
  - admin/CriteriaManagement.tsx
  - admin/AlternativeManagement.tsx
  - evaluation/QRCodeEvaluatorAssignment.tsx
  - evaluation/EvaluationTest.tsx
  - user/PersonalUserDashboard.tsx
  - project/EnhancedProjectCreationWizard.tsx
  - ai-paper/AIPaperGenerationPage.tsx
  - ai-materials/AIMaterialsGenerationPage.tsx
- 확인: import 경로가 '../../services/api'인지 확인
  - Phase 3에서 sed로 일괄 교체했으므로 대부분 정상일 것
  - 변수명 'apiService'는 유지 (import default as apiService)
  - import 경로만 api.ts를 가리키면 정상

검증:
- npx tsc --noEmit 0 에러
- grep -r "from.*apiService" src/ 결과 없어야 함 (services/api에서 import하면 OK)
```

#### Todo 3: anonymousEvaluationService 중복 코드 정리
```
파일: src/services/anonymousEvaluationService.ts

수정 내용:
- Line 80: 중복 OR 제거
  Before: sessionStorage.getItem('anonymous_session_key') || sessionStorage.getItem('anonymous_session_key')
  After:  sessionStorage.getItem('anonymous_session_key')
- Lines 168-173: 중복 저장 호출 정리
- Lines 563-568: 중복 키 삭제 정리

검증:
- npm run build 성공
```

### Sprint 2: 코드 품질 개선 (예상 3~4시간)

#### Todo 4: 대형 컴포넌트 식별 및 분할
```
작업:
- 500줄 이상 컴포넌트 목록 생성
- 각 컴포넌트에 대해:
  - 논리적 하위 컴포넌트로 분할 가능한지 분석
  - PSD 분할 패턴 참고 (Phase 2.5 #4에서 4,360→2,553줄 성공)
  - 우선순위: admin/ 디렉토리 (44개 파일, 가장 복잡)

검증:
- 분할 후 빌드 성공
- 기능 동작 동일
```

#### Todo 5: advancedAnalysisApi 제네릭 타입 강화
```
파일: src/services/api.ts (lines 800-821)

작업:
- advancedAnalysisApi.get/post/put/patch의 <T = any>를 구체적 타입으로 교체
- 각 호출처에서 사용하는 실제 타입을 조사하여 적용
- 4개 eslint-disable 주석 제거

검증:
- npx tsc --noEmit 0 에러
- any 잔여 0개
```

#### Todo 6: ESLint 경고 정리
```
작업:
- npm run lint 실행하여 현재 경고 목록 확인
- 카테고리별 정리:
  - unused imports → 삭제
  - unused variables → 삭제 또는 _ 접두사
  - missing dependencies in useEffect → 수정
  - 기타 → 케이스별 판단
- 목표: 350건 → 100건 이하

검증:
- npm run lint --max-warnings 100 통과
```

### Sprint 3: 테스트 및 빌드 도구 (예상 4~6시간)

#### Todo 7: 핵심 서비스 단위 테스트
```
작업:
- src/services/api.ts — makeRequest, 토큰 갱신, API 모듈 테스트
- src/services/authService.ts — 로그인, 토큰 갱신, 세션 관리
- src/utils/ahpCalculator.ts — AHP 계산 정확성
- src/utils/consistencyHelper.ts — 일관성 비율 검증

검증:
- npm test -- --watchAll=false --coverage
- 핵심 서비스 커버리지 60% 이상
```

#### Todo 8: CRA → Vite 마이그레이션 (장기)
```
작업:
- vite + @vitejs/plugin-react 설치
- vite.config.ts 작성
- index.html을 public/ → root로 이동
- react-scripts 제거
- 환경 변수 REACT_APP_ → VITE_ 변경
- CI 워크플로우 업데이트

검증:
- npm run build 성공
- npm run dev 로컬 동작
- GitHub Pages 배포 정상
- npm audit 취약점 대폭 감소
```

---

## 참고: 현재 프로젝트 상태 요약

### 코드 현황
- TypeScript 에러: **0개**
- 번들 크기: **162.34KB** (gzip)
- 서비스 파일: **12개** (api.ts 중심 통합 완료)
- 삭제된 파일: apiService.ts, apiService.test.ts, dataService.ts (-870줄)
- 마지막 커밋: `90ee74d` docs: 개발일지 #40-#41

### 해결 완료 이슈
- ✅ CRITICAL 3건: 토큰 갱신 이중화(C1), dataService 중복(C2), localStorage XSS(C3)
- ✅ HIGH 2건: apiService 폐기 래퍼(H1), axios 의존성(H3)

### 잔존 이슈
- ⚠️ HIGH 5건: 서버사이드 패키지(H1), QR 중복(H2), devDeps 이동(H3), 중복 코드(H4), 잔존 import(H5)
- ⚠️ MEDIUM 5건: any 타입(M1), ESLint(M2), 테스트(M3), 대형 컴포넌트(M4), CRA→Vite(M5)

### 파일 구조 핵심 경로
```
C:\Users\ASUS\ahp_app\
├── src\
│   ├── services\api.ts         # 핵심 API 클라이언트 (924줄)
│   ├── services\authService.ts # JWT 토큰 관리 (424줄)
│   ├── config\api.ts           # API_BASE_URL, API_ENDPOINTS
│   ├── contexts\               # Auth, Project, UI, Navigation, AppProviders
│   ├── hooks\                  # useAuth, useProjects, useNavigation 등 10개
│   ├── components\             # 180+ 컴포넌트 (40+ 디렉토리)
│   └── utils\                  # 26개 유틸리티
├── Dev_md_2602\                # 개발 문서
├── .github\workflows\ci.yml   # CI/CD (빌드+배포)
└── CLAUDE.md                   # ← 이 가이드의 원본 (C:\Users\ASUS\CLAUDE.md)
```

---

**작성**: Claude Opus 4.6
**작성일**: 2026-02-24
**대상 날짜**: 2026-02-26 (개발 재개)
