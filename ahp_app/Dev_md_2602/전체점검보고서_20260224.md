# 전체 점검 보고서 — 2026-02-24

## 프로젝트 개요

| 항목 | 값 |
|------|-----|
| 프로젝트 | AHP Research Platform |
| 버전 | 1.0.0 (빌드 2.1.1) |
| 스택 | React 18 + TypeScript + TailwindCSS |
| 백엔드 | Django REST Framework (Render.com) |
| DB | PostgreSQL (Render.com) |
| 배포 | GitHub Pages (`/ahp_app/`) |
| 번들 | main.js 162.43KB (gzip) |

---

## 1. 코드베이스 규모

| 영역 | 파일 수 | 줄 수 (추정) |
|------|---------|-------------|
| 컴포넌트 (components/) | 80+ .tsx | ~25,000줄 |
| 서비스 (services/) | 15 .ts | ~6,450줄 |
| 훅 (hooks/) | 10 .ts/.tsx | ~1,110줄 |
| 유틸리티 (utils/) | 10+ .ts | ~2,000줄 |
| 컨텍스트 (contexts/) | 5 .tsx | ~300줄 |
| 라우트 (routes/) | 1 .ts | ~200줄 |
| 타입 (types/) | 1 .ts | ~150줄 |
| 테스트 | 19 .test.ts/.tsx | ~1,000줄 |
| **합계** | **140+** | **~36,000줄** |

### 컴포넌트 분포

| 디렉토리 | 파일 수 | 주요 역할 |
|----------|---------|----------|
| admin/ | 15 | 관리자 대시보드, 프로젝트 관리 |
| common/ | 12 | Button, Card, Modal, Input 등 재사용 |
| evaluation/ | 8 | 평가 워크플로우, QR코드, 직접입력 |
| superadmin/ | 7 | 시스템 관리, 사용자 관리 |
| analysis/ | 6 | 결과 분석, 고급 분석 (민감도/몬테카를로) |
| auth/ | 4 | 로그인, 회원가입, 2FA |
| layout/ | 3 | Sidebar, Header, Footer |
| settings/ | 3 | 개인 설정, AI 설정 |
| survey/ | 2 | 설문 관리 |
| ai-*/ | 3 | AI 챗봇, 논문 생성, 자료 생성 |
| 기타 | 17+ | 프로젝트, 모델, 결과, 지원 등 |

---

## 2. 아키텍처 현황

### 데이터 흐름
```
Django REST API
  ↕
config/api.ts (API_ENDPOINTS 정의)
  ↕
services/api.ts (makeRequest + 정규화)
  ↕  ↕
services/apiService.ts (대체 클라이언트)  services/authService.ts (JWT)
  ↕                                        ↕
services/dataService_clean.ts (비즈니스 래퍼)
  ↕
hooks/ (useProjects, useAuth, useNavigation...)
  ↕
contexts/ (AuthContext, ProjectContext...)
  ↕
components/ (UI 렌더링)
```

### 인증 흐름
```
로그인 → POST /api/service/auth/token/
  → {access, refresh, user}
  → sessionStorage에 저장
  → 5분마다 자동 갱신
  → 401 시 자동 재시도 (api.ts + authService.ts 이중)
```

### 스토리지 사용

| 키 | 스토리지 | 용도 |
|----|----------|------|
| `ahp_access_token` | sessionStorage | JWT 액세스 토큰 |
| `ahp_refresh_token` | sessionStorage | JWT 리프레시 토큰 |
| `ahp_user` | localStorage | 사용자 정보 캐시 |
| `ahp_temp_role` | localStorage | 역할 전환 상태 |
| `ahp_super_mode` | localStorage | 슈퍼관리자 모드 |
| `ahp_theme` | localStorage | 테마 (light/dark/system) |
| `ahp_color_theme` | localStorage | 색상 테마 |

---

## 3. 완료된 작업 (Phase 1~2.5)

### Phase 1: 아키텍처 리팩토링 (7/7 완료)
- [x] 1a: 코드베이스 품질 감사
- [x] 1b: 커스텀 훅 6개 추출
- [x] 1c: 라우트 맵 + 가드 컴포넌트
- [x] 1d: 보안 취약점 5건 패치
- [x] 1e: App.tsx 분해 (1,985줄 → 22줄)
- [x] 1f: Context API 5개 + AppProviders
- [x] 1g: 프로덕션 console.log 정리

### Phase 2: 기능 구현
- [x] 2a: 평가자 초대 시스템 프론트엔드 인프라
- [x] 2c: 고급 분석 알고리즘 5개 유틸리티

### Phase 2.5: 품질 개선 (7/7 완료)
- [x] #1: npm audit fix (72→60건)
- [x] #2: secureStorage 래핑
- [x] #3: api.ts any 21→4건 교체
- [x] #4: PSD 4,360줄 → 2,553줄 분할
- [x] #5: console.* 49건 → logger 적용
- [x] #6: React.memo 13개 적용
- [x] #7: ErrorBoundary 3개 배치

### 버그 수정 (#26~#40)
- [x] Sidebar 역할 전환 시리즈 (#26~#34, #36~#37)
- [x] SUPER_ADMIN_EMAIL 프로덕션 빈 문자열 (#38)
- [x] URL 생성 PUBLIC_URL 누락 (#39)
- [x] API 엔드포인트 불일치 8건 + 401 토큰 자동 갱신 (#40)

---

## 4. 발견된 문제점

### CRITICAL (즉시 수정 필요)

| # | 문제 | 위치 | 영향 |
|---|------|------|------|
| C1 | **토큰 갱신 이중 구현** | api.ts + authService.ts | 병렬 API 호출 시 레이스 컨디션 가능 |
| C2 | **dataService.ts 중복** | dataService.ts (3곳 사용) | dataService_clean.ts와 기능 겹침 |
| C3 | **anonymousEvaluationService localStorage 사용** | anonymousEvaluationService.ts | XSS 취약점 (토큰은 sessionStorage 필수) |

### HIGH (조기 수정 권장)

| # | 문제 | 위치 | 영향 |
|---|------|------|------|
| H1 | **apiService.ts deprecated 래퍼 잔존** | 19개 컴포넌트에서 import | api.ts와 이중 유지보수 |
| H2 | **`any` 타입 11건** | api.ts(8), apiService.ts(1), systemMgmt(2) | 타입 안정성 저하 |
| H3 | **axios import** | InviteEvaluators.tsx | fetch 기반 api.ts와 불일치 |
| H4 | **테스트 부족** | 19개 테스트 파일 | 핵심 비즈니스 로직 미테스트 |
| H5 | **ESLint 경고 350건 허용** | CI/CD | 코드 품질 하락 허용 |

### MEDIUM (개선 권장)

| # | 문제 | 위치 | 영향 |
|---|------|------|------|
| M1 | TypeScript 4.9 (v5 미적용) | tsconfig.json | 최신 기능 미사용 |
| M2 | node-fetch v2 deprecated | package.json | 보안 업데이트 중단 |
| M3 | parent_id / parent 필드 이중화 | CriteriaData | 정규화 로직 복잡 |
| M4 | 에러 메시지 한/영 혼재 | 서비스 전반 | UX 일관성 저하 |
| M5 | 번들 사이즈 모니터링 없음 | CI/CD | 성능 회귀 감지 불가 |

---

## 5. 차기 계획

### Phase 3: 서비스 레이어 통합 (우선순위 최고)

| 단계 | 작업 | 예상 파일 | 리스크 |
|------|------|----------|--------|
| 3a | **토큰 갱신 단일화** — api.ts의 인라인 갱신 제거, authService.ts로 위임 | api.ts, authService.ts | LOW |
| 3b | **dataService.ts 제거** — 3개 소비자를 dataService_clean.ts로 마이그레이션 | ExportManager, EvaluatorDataManager, ProjectSelector | LOW |
| 3c | **apiService.ts 점진 제거** — 19개 소비자를 api.ts로 마이그레이션 | 19개 컴포넌트 | MEDIUM |
| 3d | **axios 제거** — InviteEvaluators.tsx의 axios import를 api.ts로 교체 | 1개 컴포넌트, package.json | LOW |

### Phase 4: 타입 안전성 강화

| 단계 | 작업 | 예상 파일 |
|------|------|----------|
| 4a | advancedAnalysisApi `any` → 구체적 응답 타입 정의 | api.ts |
| 4b | apiService.ts의 `APIResponse<any>` → 제네릭 타입 | apiService.ts |
| 4c | parent_id / parent 필드 통합 (parent만 사용) | api.ts, dataService_clean.ts |
| 4d | CriteriaData / AlternativeData 타입 정리 | types/, api.ts |

### Phase 5: 보안 & 품질

| 단계 | 작업 | 예상 파일 |
|------|------|----------|
| 5a | anonymousEvaluationService localStorage → sessionStorage | anonymousEvaluationService.ts |
| 5b | ESLint 경고 350 → 100 이하로 축소 | 다수 컴포넌트 |
| 5c | 테스트 커버리지 확대 (핵심 훅/서비스 대상) | tests/ |
| 5d | npm audit 취약점 추가 수정 (60→0 목표) | package.json |
| 5e | CI/CD에 npm audit + 번들 사이즈 체크 추가 | .github/workflows/ci.yml |

### Phase 6: 의존성 현대화

| 단계 | 작업 | 비고 |
|------|------|------|
| 6a | TypeScript 4.9 → 5.x 업그레이드 | 호환성 테스트 필수 |
| 6b | node-fetch v2 → 네이티브 fetch 전환 | 브라우저 전용이므로 삭제 가능 |
| 6c | @types/jest, @types/node 업데이트 | 테스트 환경 정합성 |

---

## 6. 종합 점수

| 영역 | 점수 | 비고 |
|------|------|------|
| 아키텍처 | **8/10** | App.tsx 분해, Context/Hook 분리 완료 |
| API 연동 | **7/10** | 엔드포인트 통일 완료, 서비스 중복 잔존 |
| 타입 안전성 | **6/10** | strict 모드 ON, any 11건 잔존 |
| 보안 | **7/10** | JWT sessionStorage, secureStorage 적용 |
| 테스트 | **4/10** | 19개 파일, 핵심 로직 미테스트 |
| 빌드/배포 | **8/10** | CI/CD 자동화, GitHub Pages 정상 |
| UX 일관성 | **7/10** | Sidebar 모드 전환 안정화 |
| **종합** | **6.7/10** | 서비스 통합 + 테스트 보강이 핵심 과제 |

---

**작성**: Claude Opus 4.6
**날짜**: 2026-02-24
