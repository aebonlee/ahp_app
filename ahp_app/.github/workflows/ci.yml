name: Frontend CI

on:
  push:
    branches: [ main ]
    paths:
      - 'src/**'
      - 'public/**'
      - 'package.json'
      - 'package-lock.json'
      - 'tsconfig.json'
      - '.github/workflows/**'
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    name: Build and Test
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        echo "Installing dependencies..."
        npm ci || npm install
        
    - name: ğŸ” Lint check
      run: |
        echo "Running ESLint..."
        npm run lint || echo "ESLint warnings found (non-blocking)"
      continue-on-error: true
        
    - name: ğŸ—ï¸ Build application
      run: |
        echo "Building application..."
        npm run build
      env:
        CI: false
        PUBLIC_URL: /ahp_app
        GENERATE_SOURCEMAP: false
        
    - name: âœ… Verify build
      run: |
        if [ -d "build" ]; then 
          echo "âœ… Build completed successfully"
          echo "ğŸ“Š Build size: $(du -sh build/ | cut -f1)"
        else 
          echo "âŒ Build directory not found"
          exit 1
        fi
        
    - name: ğŸ§ª Run tests
      run: |
        echo "Running tests..."
        npm test -- --watchAll=false --passWithNoTests || true
      continue-on-error: true
      env:
        CI: true
        
    - name: âœ¨ CI Complete
      run: echo "âœ… CI completed at $(date -u)"