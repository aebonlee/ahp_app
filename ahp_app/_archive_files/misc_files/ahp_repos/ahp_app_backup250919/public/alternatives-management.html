<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - ëŒ€ì•ˆ ê´€ë¦¬</title>
    <link rel="stylesheet" href="styles/layout.css">
    <style>
        :root {
            --accent-primary: #C8A968;
            --accent-secondary: #A98C4B;
            --accent-light: #E5D5AA;
            --accent-hover: #B59A4D;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s;
            font-size: 0.9rem;
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .status-bar {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-light);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(200, 169, 104, 0.1);
        }

        .btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(200, 169, 104, 0.4);
        }

        .btn-secondary {
            background: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--text-primary);
        }

        .btn-danger {
            background: var(--error);
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .alternatives-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .alternative-item {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 8px;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .alternative-item:hover {
            border-color: var(--accent-light);
            background: var(--bg-primary);
        }

        .alternative-info {
            flex: 1;
        }

        .alternative-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .alternative-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .alternative-meta {
            font-size: 0.85rem;
            color: var(--accent-primary);
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .alternative-actions {
            display: flex;
            gap: 0.5rem;
        }

        .drag-handle {
            background: var(--accent-light);
            color: var(--accent-primary);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            margin-right: 1rem;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .criteria-summary {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 2px dashed var(--accent-light);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .criteria-badge {
            background: var(--accent-light);
            color: var(--accent-primary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
        }

        .comparison-preview {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 2px dashed var(--success);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
            text-align: center;
        }

        .comparison-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .matrix-cell {
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            text-align: center;
            border: 1px solid var(--success);
            opacity: 0.7;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .error {
            background: #fef2f2;
            color: var(--error);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .success {
            background: #f0fdf4;
            color: var(--success);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .progress-bar {
            background: var(--border-light);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .quick-add {
            display: flex;
            gap: 1rem;
            align-items: end;
            margin-bottom: 1rem;
        }

        .quick-add .form-group {
            margin-bottom: 0;
            flex: 1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .alternative-item {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .alternative-actions {
                justify-content: center;
            }

            .quick-add {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="header">
        <div class="header-left">
            <a href="./personal-service-enhanced.html" class="logo">
                <div class="logo-icon">A</div>
                <span>AHP System</span>
            </a>
            <nav class="header-nav">
                <a href="./personal-service-enhanced.html" class="header-nav-item" data-page="dashboard">ëŒ€ì‹œë³´ë“œ</a>
                <a href="./project-management.html" class="header-nav-item" data-page="projects">í”„ë¡œì íŠ¸</a>
                <a href="./results-analysis.html" class="header-nav-item" data-page="analysis">ë¶„ì„</a>
                <a href="#" class="header-nav-item" data-page="reports">ë³´ê³ ì„œ</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">ê¹€</div>
                <div>
                    <div class="user-name">ê¹€ì² ìˆ˜</div>
                    <div class="user-role" id="userRole">ë¡œë”© ì¤‘...</div>
                </div>
            </div>
            <button onclick="handleLogout()" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </header>

    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-section-title">í”„ë¡œì íŠ¸ ê´€ë¦¬</div>
            <div class="sidebar-menu">
                <a href="./project-management.html" class="sidebar-item" data-menu="my-projects">
                    <span class="sidebar-icon">ğŸ“‹</span>
                    <span>ë‚´ í”„ë¡œì íŠ¸</span>
                    <span class="sidebar-badge">3</span>
                </a>
                <a href="./project-management.html" class="sidebar-item" data-menu="new-project">
                    <span class="sidebar-icon">â•</span>
                    <span>ìƒˆ í”„ë¡œì íŠ¸</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="trash">
                    <span class="sidebar-icon">ğŸ—‘ï¸</span>
                    <span>íœ´ì§€í†µ</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ëª¨ë¸ êµ¬ì¶•</div>
            <div class="sidebar-menu">
                <a href="./criteria-management.html" class="sidebar-item" data-menu="criteria">
                    <span class="sidebar-icon">âš–ï¸</span>
                    <span>ê¸°ì¤€ ì„¤ì •</span>
                </a>
                <a href="./alternatives-management.html" class="sidebar-item active" data-menu="alternatives">
                    <span class="sidebar-icon">ğŸ”„</span>
                    <span>ëŒ€ì•ˆ ê´€ë¦¬</span>
                </a>
                <a href="./pairwise-comparison.html" class="sidebar-item" data-menu="comparison">
                    <span class="sidebar-icon">âš¡</span>
                    <span>ìŒëŒ€ë¹„êµ</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="evaluators">
                    <span class="sidebar-icon">ğŸ‘¥</span>
                    <span>í‰ê°€ì ê´€ë¦¬</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ë¶„ì„ ë° ê²°ê³¼</div>
            <div class="sidebar-menu">
                <a href="./results-analysis.html" class="sidebar-item" data-menu="results">
                    <span class="sidebar-icon">ğŸ“ˆ</span>
                    <span>ê²°ê³¼ ë¶„ì„</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="monitoring">
                    <span class="sidebar-icon">ğŸ“Š</span>
                    <span>ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="reports">
                    <span class="sidebar-icon">ğŸ“„</span>
                    <span>ë³´ê³ ì„œ ìƒì„±</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="sensitivity">
                    <span class="sidebar-icon">ğŸ”</span>
                    <span>ë¯¼ê°ë„ ë¶„ì„</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ì„¤ì •</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-menu="settings">
                    <span class="sidebar-icon">âš™ï¸</span>
                    <span>ê°œì¸ ì„¤ì •</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="billing">
                    <span class="sidebar-icon">ğŸ’³</span>
                    <span>ìš”ê¸ˆì œ ê´€ë¦¬</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="guide">
                    <span class="sidebar-icon">ğŸ“š</span>
                    <span>ì‚¬ìš© ê°€ì´ë“œ</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <span id="toggle-icon">â—€</span>
    </button>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <div class="status-bar">
            <div>
                <strong>Django ë°±ì—”ë“œ:</strong> <span id="backend-status">ì—°ê²° í™•ì¸ì¤‘...</span>
            </div>
            <div>
                <strong>í˜„ì¬ í”„ë¡œì íŠ¸:</strong> <span id="current-project">í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            </div>
            <div>
                <strong>ë‹¨ê³„:</strong> <span style="color: var(--accent-primary);">3ë‹¨ê³„ - ëŒ€ì•ˆ ì…ë ¥</span>
            </div>
        </div>

        <!-- AHP ì§„í–‰ ìƒí™© -->
        <div class="section">
            <h2 class="section-title">ğŸ“Š AHP ì§„í–‰ ìƒí™©</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="ahp-progress" style="width: 50%;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">
                <span>í”„ë¡œì íŠ¸ ìƒì„±</span>
                <span>ê¸°ì¤€ ì„¤ì •</span>
                <span style="color: var(--accent-primary); font-weight: 600;">ëŒ€ì•ˆ ì…ë ¥</span>
                <span>ìŒëŒ€ë¹„êµ</span>
                <span>ê²°ê³¼ ë¶„ì„</span>
            </div>
        </div>

        <!-- ì„¤ì •ëœ ê¸°ì¤€ ìš”ì•½ -->
        <div class="section">
            <h2 class="section-title">âš–ï¸ ì„¤ì •ëœ ê¸°ì¤€ ìš”ì•½</h2>
            <div class="criteria-summary">
                <div id="criteria-loading" class="loading" style="display: none;">
                    ê¸°ì¤€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
                <div id="criteria-summary-content">
                    <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">ğŸ“‹ í‰ê°€ ê¸°ì¤€</h3>
                    <div class="criteria-grid" id="criteria-grid">
                        <!-- ê¸°ì¤€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <p style="color: var(--text-secondary); margin-top: 1rem; font-size: 0.9rem;">
                        ê° ëŒ€ì•ˆì€ ìœ„ ê¸°ì¤€ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>

        <!-- ëŒ€ì•ˆ ê´€ë¦¬ ê°€ì´ë“œ -->
        <div class="section">
            <h2 class="section-title">ğŸ“‹ ëŒ€ì•ˆ ì„¤ì • ê°€ì´ë“œ</h2>
            <div style="background: var(--accent-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">ğŸ’¡ ì¢‹ì€ ëŒ€ì•ˆ ì„¤ì •ì„ ìœ„í•œ íŒ</h3>
                <ul style="color: var(--text-primary); line-height: 1.6; margin-left: 1.5rem;">
                    <li><strong>í˜„ì‹¤ì :</strong> ì‹¤ì œë¡œ ì„ íƒ ê°€ëŠ¥í•œ í˜„ì‹¤ì ì¸ ëŒ€ì•ˆë“¤</li>
                    <li><strong>êµ¬ë³„ì„±:</strong> ì„œë¡œ ëª…í™•íˆ êµ¬ë³„ë˜ëŠ” ë…ë¦½ì ì¸ ëŒ€ì•ˆë“¤</li>
                    <li><strong>ë¹„êµ ê°€ëŠ¥:</strong> ì„¤ì •ëœ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€ ê°€ëŠ¥í•œ ëŒ€ì•ˆë“¤</li>
                    <li><strong>ì™„ì „ì„±:</strong> ê³ ë ¤í•´ì•¼ í•  ëª¨ë“  ì£¼ìš” ëŒ€ì•ˆ í¬í•¨</li>
                    <li><strong>ì ì • ìˆ˜ì¤€:</strong> ë³´í†µ 3-7ê°œ ëŒ€ì•ˆì´ ì ë‹¹í•©ë‹ˆë‹¤</li>
                </ul>
            </div>
        </div>

        <!-- ë¹ ë¥¸ ëŒ€ì•ˆ ì¶”ê°€ -->
        <div class="section">
            <h2 class="section-title">âš¡ ë¹ ë¥¸ ëŒ€ì•ˆ ì¶”ê°€</h2>
            <div class="quick-add">
                <div class="form-group">
                    <label for="quick-alternative-name" class="form-label">ëŒ€ì•ˆ ì´ë¦„</label>
                    <input type="text" id="quick-alternative-name" class="form-input" 
                           placeholder="ì˜ˆ: ëŒ€ì•ˆ A">
                </div>
                <button onclick="quickAddAlternative()" class="btn btn-small">
                    â• ì¶”ê°€
                </button>
            </div>
        </div>

        <!-- ìƒˆ ëŒ€ì•ˆ ì¶”ê°€ -->
        <div class="section">
            <h2 class="section-title">â• ìƒˆ ëŒ€ì•ˆ ì¶”ê°€</h2>
            <div id="add-error" class="error" style="display:none;"></div>
            <div id="add-success" class="success" style="display:none;"></div>
            
            <form id="add-alternative-form">
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; align-items: start;">
                    <div class="form-group">
                        <label for="alternative-name" class="form-label">ëŒ€ì•ˆ ì´ë¦„ *</label>
                        <input type="text" id="alternative-name" class="form-input" required 
                               placeholder="ì˜ˆ: ì œí’ˆ A">
                    </div>

                    <div class="form-group">
                        <label for="alternative-description" class="form-label">ëŒ€ì•ˆ ì„¤ëª…</label>
                        <textarea id="alternative-description" class="form-textarea" rows="3" 
                                  placeholder="ì´ ëŒ€ì•ˆì˜ íŠ¹ì§•ê³¼ ì¥ì ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”..."></textarea>
                    </div>
                </div>

                <button type="submit" class="btn" id="add-btn">
                    â• ëŒ€ì•ˆ ì¶”ê°€
                </button>
            </form>
        </div>

        <!-- ëŒ€ì•ˆ ëª©ë¡ -->
        <div class="section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 class="section-title" style="margin-bottom: 0;">ğŸ“ ì…ë ¥ëœ ëŒ€ì•ˆë“¤</h2>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-secondary btn-small" onclick="loadAlternatives()">
                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button class="btn btn-small" onclick="proceedToComparison()" id="proceed-btn" style="display: none;">
                        ë‹¤ìŒ ë‹¨ê³„ â†’ ìŒëŒ€ë¹„êµ
                    </button>
                </div>
            </div>
            
            <div id="alternatives-loading" class="loading">
                ëŒ€ì•ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
            
            <div id="alternatives-error" class="error" style="display:none;"></div>
            
            <div id="alternatives-container" style="display:none;">
                <div class="alternatives-list" id="alternatives-list">
                    <!-- ëŒ€ì•ˆë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ìŒëŒ€ë¹„êµ ë¯¸ë¦¬ë³´ê¸° -->
        <div class="section" id="comparison-preview" style="display: none;">
            <h2 class="section-title">ğŸ” ìŒëŒ€ë¹„êµ ë¯¸ë¦¬ë³´ê¸°</h2>
            <div class="comparison-preview">
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="color: var(--success); margin-bottom: 1rem;">ğŸ“Š ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤ ì˜ˆì‹œ</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">
                        ê° ê¸°ì¤€ì— ëŒ€í•´ ë‹¤ìŒê³¼ ê°™ì€ ìŒëŒ€ë¹„êµë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤:
                    </p>
                </div>
                <div id="comparison-matrix" class="comparison-matrix">
                    <!-- ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                <p style="color: var(--text-secondary); margin-top: 1rem; font-size: 0.9rem;">
                    ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì‹¤ì œ ìŒëŒ€ë¹„êµë¥¼ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </main>

    <script src="scripts/layout.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentAlternatives = [];
        let currentCriteria = [];
        let currentProject = null;
        const API_BASE_URL = 'https://ahp-django-backend.onrender.com';

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ëŒ€ì•ˆ ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œë¨');
            
            // ë ˆì´ì•„ì›ƒ ì´ˆê¸°í™”
            if (window.layoutUtils) {
                window.layoutUtils.initializePage({
                    menuId: 'alternatives',
                    pageId: 'projects',
                    title: 'ëŒ€ì•ˆ ê´€ë¦¬'
                });
            }
            
            checkBackendStatus();
            loadProject();
            loadCriteria();
            loadAlternatives();

            // í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('add-alternative-form').addEventListener('submit', handleAddAlternative);
        });

        // ë°±ì—”ë“œ ìƒíƒœ í™•ì¸
        async function checkBackendStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/service/status/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--success);">âœ… ì •ìƒ ì—°ê²°</span>';
                } else {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--warning);">âš ï¸ ì‘ë‹µ ì˜¤ë¥˜</span>';
                }
            } catch (error) {
                document.getElementById('backend-status').innerHTML = 
                    '<span style="color: var(--error);">âŒ ì—°ê²° ì‹¤íŒ¨</span>';
                console.error('ë°±ì—”ë“œ ì—°ê²° ì˜¤ë¥˜:', error);
            }
        }

        // í˜„ì¬ í”„ë¡œì íŠ¸ ì •ë³´ ë¡œë“œ
        function loadProject() {
            // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ í”„ë¡œì íŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const savedProject = sessionStorage.getItem('currentProject');
            if (savedProject) {
                try {
                    currentProject = JSON.parse(savedProject);
                    document.getElementById('current-project').textContent = currentProject.title;
                    return;
                } catch (e) {
                    console.error('í”„ë¡œì íŠ¸ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }
            
            // ê¸°ë³¸ê°’ìœ¼ë¡œ ë°ëª¨ í”„ë¡œì íŠ¸ ì„¤ì •
            currentProject = {
                id: 'demo-project',
                title: 'ìƒ˜í”Œ ì˜ì‚¬ê²°ì • í”„ë¡œì íŠ¸'
            };
            document.getElementById('current-project').textContent = currentProject.title;
        }

        // ê¸°ì¤€ ì •ë³´ ë¡œë“œ
        async function loadCriteria() {
            const loadingDiv = document.getElementById('criteria-loading');
            const gridDiv = document.getElementById('criteria-grid');

            try {
                loadingDiv.style.display = 'block';
                
                // ë¨¼ì € ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ì¤€ ì •ë³´ í™•ì¸
                const savedCriteria = sessionStorage.getItem('currentCriteria');
                if (savedCriteria) {
                    try {
                        currentCriteria = JSON.parse(savedCriteria);
                        if (currentCriteria.length > 0) {
                            renderCriteriaSummary();
                            return;
                        }
                    } catch (e) {
                        console.error('ê¸°ì¤€ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', e);
                    }
                }
                
                // APIì—ì„œ ê¸°ì¤€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`${API_BASE_URL}/api/service/criteria/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentCriteria = Array.isArray(data) ? data : (data.criteria || []);
                    
                    if (currentCriteria.length === 0) {
                        // ë°ëª¨ ê¸°ì¤€ ì‚¬ìš©
                        currentCriteria = [
                            { id: 'demo-1', name: 'í’ˆì§ˆ' },
                            { id: 'demo-2', name: 'ë¹„ìš©' },
                            { id: 'demo-3', name: 'ì‹ ë¢°ì„±' },
                            { id: 'demo-4', name: 'ì‚¬ìš©ì„±' }
                        ];
                    }
                    
                    renderCriteriaSummary();
                } else {
                    throw new Error('ê¸°ì¤€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('ê¸°ì¤€ ë¡œë“œ ì˜¤ë¥˜:', error);
                // ê¸°ë³¸ ë°ëª¨ ê¸°ì¤€ ì‚¬ìš©
                currentCriteria = [
                    { id: 'demo-1', name: 'í’ˆì§ˆ' },
                    { id: 'demo-2', name: 'ë¹„ìš©' },
                    { id: 'demo-3', name: 'ì‹ ë¢°ì„±' },
                    { id: 'demo-4', name: 'ì‚¬ìš©ì„±' }
                ];
                renderCriteriaSummary();
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        // ê¸°ì¤€ ìš”ì•½ ë Œë”ë§
        function renderCriteriaSummary() {
            const gridDiv = document.getElementById('criteria-grid');
            
            if (currentCriteria.length > 0) {
                gridDiv.innerHTML = currentCriteria.map(criteria => `
                    <div class="criteria-badge">${criteria.name}</div>
                `).join('');
            } else {
                gridDiv.innerHTML = '<p style="color: var(--text-secondary);">ì„¤ì •ëœ ê¸°ì¤€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        // ë¹ ë¥¸ ëŒ€ì•ˆ ì¶”ê°€
        function quickAddAlternative() {
            const name = document.getElementById('quick-alternative-name').value.trim();
            if (!name) {
                alert('ëŒ€ì•ˆ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë©”ì¸ í¼ì— ê°’ ì„¤ì •
            document.getElementById('alternative-name').value = name;
            document.getElementById('quick-alternative-name').value = '';
            
            // ë©”ì¸ í¼ ì œì¶œ
            document.getElementById('add-alternative-form').dispatchEvent(new Event('submit'));
        }

        // ëŒ€ì•ˆ ì¶”ê°€ ì²˜ë¦¬
        async function handleAddAlternative(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('add-btn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'ì¶”ê°€ ì¤‘...';
            submitBtn.disabled = true;

            // ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€ ì´ˆê¸°í™”
            document.getElementById('add-error').style.display = 'none';
            document.getElementById('add-success').style.display = 'none';

            try {
                const alternativeData = {
                    name: document.getElementById('alternative-name').value,
                    description: document.getElementById('alternative-description').value || '',
                    project_id: currentProject?.id || 'default',
                    created_date: new Date().toISOString()
                };

                const response = await fetch(`${API_BASE_URL}/api/service/alternatives/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(alternativeData)
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                    const successDiv = document.getElementById('add-success');
                    successDiv.textContent = `âœ… ëŒ€ì•ˆ "${alternativeData.name}"ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`;
                    successDiv.style.display = 'block';
                    
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('add-alternative-form').reset();
                    
                    // ëŒ€ì•ˆ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    setTimeout(() => {
                        loadAlternatives();
                        successDiv.style.display = 'none';
                    }, 2000);

                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ëŒ€ì•ˆ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('ëŒ€ì•ˆ ì¶”ê°€ ì˜¤ë¥˜:', error);
                const errorDiv = document.getElementById('add-error');
                errorDiv.textContent = `âŒ ì˜¤ë¥˜: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ëŒ€ì•ˆ ëª©ë¡ ë¡œë“œ
        async function loadAlternatives() {
            const loadingDiv = document.getElementById('alternatives-loading');
            const errorDiv = document.getElementById('alternatives-error');
            const containerDiv = document.getElementById('alternatives-container');

            // UI ì´ˆê¸°í™”
            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            containerDiv.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE_URL}/api/service/alternatives/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentAlternatives = Array.isArray(data) ? data : (data.alternatives || []);
                    renderAlternatives();
                    updateComparisonPreview();
                } else {
                    throw new Error('ëŒ€ì•ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('ëŒ€ì•ˆ ë¡œë“œ ì˜¤ë¥˜:', error);
                errorDiv.textContent = `âŒ ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        // ëŒ€ì•ˆ ëª©ë¡ ë Œë”ë§
        function renderAlternatives() {
            const container = document.getElementById('alternatives-container');
            const listElement = document.getElementById('alternatives-list');
            
            if (currentAlternatives.length === 0) {
                listElement.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”„</div>
                        <h3>ì•„ì§ ì…ë ¥ëœ ëŒ€ì•ˆì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ìœ„ì—ì„œ ìƒˆ ëŒ€ì•ˆì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
            } else {
                listElement.innerHTML = currentAlternatives.map((alternative, index) => `
                    <div class="alternative-item" data-id="${alternative.id || index}">
                        <div class="drag-handle">â‰¡</div>
                        <div class="alternative-info">
                            <div class="alternative-name">${alternative.name}</div>
                            <div class="alternative-description">${alternative.description || 'ì„¤ëª… ì—†ìŒ'}</div>
                            <div class="alternative-meta">ëŒ€ì•ˆ ${index + 1}</div>
                        </div>
                        <div class="alternative-actions">
                            <button class="btn btn-secondary btn-small" onclick="editAlternative('${alternative.id || index}')">
                                âœï¸ ìˆ˜ì •
                            </button>
                            <button class="btn btn-danger btn-small" onclick="deleteAlternative('${alternative.id || index}')">
                                ğŸ—‘ï¸ ì‚­ì œ
                            </button>
                        </div>
                    </div>
                `).join('');

                // ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ í‘œì‹œ (3ê°œ ì´ìƒì˜ ëŒ€ì•ˆì´ ìˆì„ ë•Œ)
                if (currentAlternatives.length >= 3) {
                    document.getElementById('proceed-btn').style.display = 'block';
                }
            }
            
            container.style.display = 'block';
        }

        // ìŒëŒ€ë¹„êµ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updateComparisonPreview() {
            if (currentAlternatives.length >= 3 && currentCriteria.length >= 3) {
                const matrixDiv = document.getElementById('comparison-matrix');
                
                // ê°„ë‹¨í•œ ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                const sampleComparisons = [];
                for (let i = 0; i < Math.min(6, currentAlternatives.length * currentCriteria.length); i++) {
                    const altA = currentAlternatives[Math.floor(Math.random() * currentAlternatives.length)];
                    const altB = currentAlternatives[Math.floor(Math.random() * currentAlternatives.length)];
                    const criteria = currentCriteria[Math.floor(Math.random() * currentCriteria.length)];
                    
                    if (altA !== altB) {
                        sampleComparisons.push(`${criteria.name}: ${altA.name} vs ${altB.name}`);
                    }
                }
                
                matrixDiv.innerHTML = sampleComparisons.map(comp => `
                    <div class="matrix-cell">${comp}</div>
                `).join('');
                
                document.getElementById('comparison-preview').style.display = 'block';
            } else {
                document.getElementById('comparison-preview').style.display = 'none';
            }
        }

        // ëŒ€ì•ˆ ìˆ˜ì •
        function editAlternative(alternativeId) {
            const alternative = currentAlternatives.find(a => (a.id || currentAlternatives.indexOf(a)) == alternativeId);
            if (alternative) {
                document.getElementById('alternative-name').value = alternative.name;
                document.getElementById('alternative-description').value = alternative.description || '';
                
                // í¼ì„ ìˆ˜ì • ëª¨ë“œë¡œ ë³€ê²½ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë³„ë„ ëª¨ë‹¬ì´ë‚˜ ì¸ë¼ì¸ í¸ì§‘ ì‚¬ìš©)
                alert(`"${alternative.name}" ëŒ€ì•ˆ ìˆ˜ì • ê¸°ëŠ¥ì€ ë‹¤ìŒ ë²„ì „ì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.`);
            }
        }

        // ëŒ€ì•ˆ ì‚­ì œ
        async function deleteAlternative(alternativeId) {
            const alternative = currentAlternatives.find(a => (a.id || currentAlternatives.indexOf(a)) == alternativeId);
            if (!alternative) return;

            if (confirm(`"${alternative.name}" ëŒ€ì•ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                try {
                    // ì‹¤ì œ API í˜¸ì¶œ (í˜„ì¬ëŠ” ì‹œë®¬ë ˆì´ì…˜)
                    console.log(`ëŒ€ì•ˆ ì‚­ì œ: ${alternativeId}`);
                    
                    // ë¡œì»¬ì—ì„œ ì œê±° (ì‹¤ì œë¡œëŠ” API í˜¸ì¶œ í›„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨)
                    currentAlternatives = currentAlternatives.filter(a => (a.id || currentAlternatives.indexOf(a)) != alternativeId);
                    renderAlternatives();
                    updateComparisonPreview();
                    
                    // ì„±ê³µ ë©”ì‹œì§€
                    const successDiv = document.getElementById('add-success');
                    successDiv.textContent = `âœ… "${alternative.name}" ëŒ€ì•ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    successDiv.style.display = 'block';
                    setTimeout(() => successDiv.style.display = 'none', 3000);

                } catch (error) {
                    console.error('ëŒ€ì•ˆ ì‚­ì œ ì˜¤ë¥˜:', error);
                    alert('ëŒ€ì•ˆ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰
        function proceedToComparison() {
            if (currentAlternatives.length < 3) {
                alert('AHP ë¶„ì„ì„ ìœ„í•´ ìµœì†Œ 3ê°œ ì´ìƒì˜ ëŒ€ì•ˆì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            if (currentCriteria.length < 3) {
                alert('ìŒëŒ€ë¹„êµë¥¼ ìœ„í•´ ìµœì†Œ 3ê°œ ì´ìƒì˜ ê¸°ì¤€ì´ ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            const totalComparisons = currentCriteria.length * (currentAlternatives.length * (currentAlternatives.length - 1)) / 2;

            const confirmed = confirm(
                `í˜„ì¬ ì„¤ì • ìƒí™©:\n\n` +
                `â€¢ ê¸°ì¤€: ${currentCriteria.length}ê°œ\n` +
                `â€¢ ëŒ€ì•ˆ: ${currentAlternatives.length}ê°œ\n` +
                `â€¢ ì˜ˆìƒ ë¹„êµ íšŸìˆ˜: ${totalComparisons}íšŒ\n\n` +
                `ë‹¤ìŒ ë‹¨ê³„(ìŒëŒ€ë¹„êµ)ë¡œ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
            );

            if (confirmed) {
                // í”„ë¡œì íŠ¸, ê¸°ì¤€, ëŒ€ì•ˆ ì •ë³´ë¥¼ ì„¸ì…˜ì— ì €ì¥
                sessionStorage.setItem('currentProject', JSON.stringify(currentProject));
                sessionStorage.setItem('currentCriteria', JSON.stringify(currentCriteria));
                sessionStorage.setItem('currentAlternatives', JSON.stringify(currentAlternatives));
                
                // ìŒëŒ€ë¹„êµ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = '/ahp_app/pairwise-comparison.html';
            }
        }

        // ë°ëª¨ ëŒ€ì•ˆ ìë™ ì¶”ê°€ (ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©)
        function addDemoAlternatives() {
            const demoAlternatives = [
                {
                    id: 'demo-alt-1',
                    name: 'ëŒ€ì•ˆ A',
                    description: 'ì²« ë²ˆì§¸ ì„ íƒ ê°€ëŠ¥í•œ ëŒ€ì•ˆìœ¼ë¡œ, ë¹„ìš© íš¨ìœ¨ì ì¸ ì†”ë£¨ì…˜'
                },
                {
                    id: 'demo-alt-2', 
                    name: 'ëŒ€ì•ˆ B',
                    description: 'ë‘ ë²ˆì§¸ ëŒ€ì•ˆìœ¼ë¡œ, ê³ í’ˆì§ˆ í”„ë¦¬ë¯¸ì—„ ì˜µì…˜'
                },
                {
                    id: 'demo-alt-3',
                    name: 'ëŒ€ì•ˆ C',
                    description: 'ì„¸ ë²ˆì§¸ ëŒ€ì•ˆìœ¼ë¡œ, ê· í˜• ì¡íŒ ì¤‘ê°„ ìˆ˜ì¤€ì˜ ì„ íƒ'
                },
                {
                    id: 'demo-alt-4',
                    name: 'ëŒ€ì•ˆ D',
                    description: 'ë„¤ ë²ˆì§¸ ëŒ€ì•ˆìœ¼ë¡œ, í˜ì‹ ì ì´ê³  ë¯¸ë˜ì§€í–¥ì ì¸ ì†”ë£¨ì…˜'
                }
            ];

            currentAlternatives = demoAlternatives;
            renderAlternatives();
            updateComparisonPreview();
        }

        // ê°œë°œìš©: Ctrl+Dë¡œ ë°ëª¨ ë°ì´í„° ì¶”ê°€
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                addDemoAlternatives();
            }
        });
    </script>
</body>
</html>