<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - ê¸°ì¤€ ì„¤ì •</title>
    <link rel="stylesheet" href="styles/layout.css">
    <style>
        :root {
            --accent-primary: #C8A968;
            --accent-secondary: #A98C4B;
            --accent-light: #E5D5AA;
            --accent-hover: #B59A4D;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s;
            font-size: 0.9rem;
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .status-bar {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-light);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(200, 169, 104, 0.1);
        }

        .btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(200, 169, 104, 0.4);
        }

        .btn-secondary {
            background: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--text-primary);
        }

        .btn-danger {
            background: var(--error);
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .criteria-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .criteria-item {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 8px;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .criteria-item:hover {
            border-color: var(--accent-light);
            background: var(--bg-primary);
        }

        .criteria-info {
            flex: 1;
        }

        .criteria-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .criteria-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .criteria-weight {
            font-size: 0.85rem;
            color: var(--accent-primary);
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .criteria-actions {
            display: flex;
            gap: 0.5rem;
        }

        .drag-handle {
            background: var(--accent-light);
            color: var(--accent-primary);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            margin-right: 1rem;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .criteria-hierarchy {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 2px dashed var(--accent-light);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
            text-align: center;
        }

        .hierarchy-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .hierarchy-level {
            background: var(--accent-light);
            color: var(--accent-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            min-width: 200px;
            text-align: center;
        }

        .hierarchy-arrow {
            color: var(--accent-primary);
            font-size: 1.5rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .error {
            background: #fef2f2;
            color: var(--error);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .success {
            background: #f0fdf4;
            color: var(--success);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .progress-bar {
            background: var(--border-light);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .criteria-item {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .criteria-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="header">
        <div class="header-left">
            <a href="./personal-service-enhanced.html" class="logo">
                <div class="logo-icon">A</div>
                <span>AHP System</span>
            </a>
            <nav class="header-nav">
                <a href="./personal-service-enhanced.html" class="header-nav-item" data-page="dashboard">ëŒ€ì‹œë³´ë“œ</a>
                <a href="./project-management.html" class="header-nav-item" data-page="projects">í”„ë¡œì íŠ¸</a>
                <a href="./results-analysis.html" class="header-nav-item" data-page="analysis">ë¶„ì„</a>
                <a href="#" class="header-nav-item" data-page="reports">ë³´ê³ ì„œ</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">ê¹€</div>
                <div>
                    <div class="user-name">ê¹€ì² ìˆ˜</div>
                    <div class="user-role" id="userRole">ë¡œë”© ì¤‘...</div>
                </div>
            </div>
            <button onclick="handleLogout()" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </header>

    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-section-title">í”„ë¡œì íŠ¸ ê´€ë¦¬</div>
            <div class="sidebar-menu">
                <a href="./project-management.html" class="sidebar-item" data-menu="my-projects">
                    <span class="sidebar-icon">ğŸ“‹</span>
                    <span>ë‚´ í”„ë¡œì íŠ¸</span>
                    <span class="sidebar-badge">3</span>
                </a>
                <a href="./project-management.html" class="sidebar-item" data-menu="new-project">
                    <span class="sidebar-icon">â•</span>
                    <span>ìƒˆ í”„ë¡œì íŠ¸</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="trash">
                    <span class="sidebar-icon">ğŸ—‘ï¸</span>
                    <span>íœ´ì§€í†µ</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ëª¨ë¸ êµ¬ì¶•</div>
            <div class="sidebar-menu">
                <a href="./criteria-management.html" class="sidebar-item active" data-menu="criteria">
                    <span class="sidebar-icon">âš–ï¸</span>
                    <span>ê¸°ì¤€ ì„¤ì •</span>
                </a>
                <a href="./alternatives-management.html" class="sidebar-item" data-menu="alternatives">
                    <span class="sidebar-icon">ğŸ”„</span>
                    <span>ëŒ€ì•ˆ ê´€ë¦¬</span>
                </a>
                <a href="./pairwise-comparison.html" class="sidebar-item" data-menu="comparison">
                    <span class="sidebar-icon">âš¡</span>
                    <span>ìŒëŒ€ë¹„êµ</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="evaluators">
                    <span class="sidebar-icon">ğŸ‘¥</span>
                    <span>í‰ê°€ì ê´€ë¦¬</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ë¶„ì„ ë° ê²°ê³¼</div>
            <div class="sidebar-menu">
                <a href="./results-analysis.html" class="sidebar-item" data-menu="results">
                    <span class="sidebar-icon">ğŸ“ˆ</span>
                    <span>ê²°ê³¼ ë¶„ì„</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="monitoring">
                    <span class="sidebar-icon">ğŸ“Š</span>
                    <span>ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="reports">
                    <span class="sidebar-icon">ğŸ“„</span>
                    <span>ë³´ê³ ì„œ ìƒì„±</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="sensitivity">
                    <span class="sidebar-icon">ğŸ”</span>
                    <span>ë¯¼ê°ë„ ë¶„ì„</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ì„¤ì •</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-menu="settings">
                    <span class="sidebar-icon">âš™ï¸</span>
                    <span>ê°œì¸ ì„¤ì •</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="billing">
                    <span class="sidebar-icon">ğŸ’³</span>
                    <span>ìš”ê¸ˆì œ ê´€ë¦¬</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="guide">
                    <span class="sidebar-icon">ğŸ“š</span>
                    <span>ì‚¬ìš© ê°€ì´ë“œ</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <span id="toggle-icon">â—€</span>
    </button>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <div class="status-bar">
            <div>
                <strong>Django ë°±ì—”ë“œ:</strong> <span id="backend-status">ì—°ê²° í™•ì¸ì¤‘...</span>
            </div>
            <div>
                <strong>í˜„ì¬ í”„ë¡œì íŠ¸:</strong> <span id="current-project">í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            </div>
            <div>
                <strong>ë‹¨ê³„:</strong> <span style="color: var(--accent-primary);">2ë‹¨ê³„ - ê¸°ì¤€ ì„¤ì •</span>
            </div>
        </div>

        <!-- AHP ì§„í–‰ ìƒí™© -->
        <div class="section">
            <h2 class="section-title">ğŸ“Š AHP ì§„í–‰ ìƒí™©</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="ahp-progress" style="width: 25%;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">
                <span>í”„ë¡œì íŠ¸ ìƒì„±</span>
                <span style="color: var(--accent-primary); font-weight: 600;">ê¸°ì¤€ ì„¤ì •</span>
                <span>ëŒ€ì•ˆ ì…ë ¥</span>
                <span>ìŒëŒ€ë¹„êµ</span>
                <span>ê²°ê³¼ ë¶„ì„</span>
            </div>
        </div>

        <!-- ê¸°ì¤€ ì„¤ì • ê°€ì´ë“œ -->
        <div class="section">
            <h2 class="section-title">ğŸ“‹ ê¸°ì¤€ ì„¤ì • ê°€ì´ë“œ</h2>
            <div style="background: var(--accent-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">ğŸ’¡ ì¢‹ì€ ê¸°ì¤€ ì„¤ì •ì„ ìœ„í•œ íŒ</h3>
                <ul style="color: var(--text-primary); line-height: 1.6; margin-left: 1.5rem;">
                    <li><strong>êµ¬ì²´ì ìœ¼ë¡œ:</strong> ëª¨í˜¸í•˜ì§€ ì•Šê³  ëª…í™•í•œ ê¸°ì¤€ì„ ì„¤ì •í•˜ì„¸ìš”</li>
                    <li><strong>ì¸¡ì • ê°€ëŠ¥:</strong> ì •ëŸ‰ì  ë˜ëŠ” ì •ì„±ì ìœ¼ë¡œ í‰ê°€ ê°€ëŠ¥í•œ ê¸°ì¤€</li>
                    <li><strong>ë…ë¦½ì :</strong> ì„œë¡œ ê²¹ì¹˜ì§€ ì•ŠëŠ” ë…ë¦½ì ì¸ ê¸°ì¤€ë“¤</li>
                    <li><strong>ì™„ì „ì„±:</strong> ì˜ì‚¬ê²°ì •ì— ì¤‘ìš”í•œ ëª¨ë“  ì¸¡ë©´ì„ í¬í•¨</li>
                    <li><strong>ì ì • ìˆ˜ì¤€:</strong> ë³´í†µ 3-7ê°œ ê¸°ì¤€ì´ ì ë‹¹í•©ë‹ˆë‹¤</li>
                </ul>
            </div>
        </div>

        <!-- ìƒˆ ê¸°ì¤€ ì¶”ê°€ -->
        <div class="section">
            <h2 class="section-title">â• ìƒˆ ê¸°ì¤€ ì¶”ê°€</h2>
            <div id="add-error" class="error" style="display:none;"></div>
            <div id="add-success" class="success" style="display:none;"></div>
            
            <form id="add-criteria-form">
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; align-items: start;">
                    <div class="form-group">
                        <label for="criteria-name" class="form-label">ê¸°ì¤€ ì´ë¦„ *</label>
                        <input type="text" id="criteria-name" class="form-input" required 
                               placeholder="ì˜ˆ: í’ˆì§ˆ">
                    </div>

                    <div class="form-group">
                        <label for="criteria-description" class="form-label">ê¸°ì¤€ ì„¤ëª…</label>
                        <textarea id="criteria-description" class="form-textarea" rows="3" 
                                  placeholder="ì´ ê¸°ì¤€ì´ ë¬´ì—‡ì„ í‰ê°€í•˜ëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”..."></textarea>
                    </div>
                </div>

                <button type="submit" class="btn" id="add-btn">
                    â• ê¸°ì¤€ ì¶”ê°€
                </button>
            </form>
        </div>

        <!-- ê¸°ì¤€ ëª©ë¡ -->
        <div class="section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 class="section-title" style="margin-bottom: 0;">ğŸ“ ì„¤ì •ëœ ê¸°ì¤€ë“¤</h2>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-secondary btn-small" onclick="loadCriteria()">
                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button class="btn btn-small" onclick="proceedToAlternatives()" id="proceed-btn" style="display: none;">
                        ë‹¤ìŒ ë‹¨ê³„ â†’ ëŒ€ì•ˆ ì…ë ¥
                    </button>
                </div>
            </div>
            
            <div id="criteria-loading" class="loading">
                ê¸°ì¤€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
            
            <div id="criteria-error" class="error" style="display:none;"></div>
            
            <div id="criteria-container" style="display:none;">
                <div class="criteria-list" id="criteria-list">
                    <!-- ê¸°ì¤€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- AHP ê³„ì¸µêµ¬ì¡° ë¯¸ë¦¬ë³´ê¸° -->
        <div class="section" id="hierarchy-preview" style="display: none;">
            <h2 class="section-title">ğŸ—ï¸ AHP ê³„ì¸µêµ¬ì¡° ë¯¸ë¦¬ë³´ê¸°</h2>
            <div class="criteria-hierarchy">
                <div class="hierarchy-visual">
                    <div class="hierarchy-level">ì˜ì‚¬ê²°ì • ëª©í‘œ</div>
                    <div class="hierarchy-arrow">â†“</div>
                    <div id="criteria-hierarchy" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem;">
                        <!-- ê¸°ì¤€ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="hierarchy-arrow">â†“</div>
                    <div class="hierarchy-level">ëŒ€ì•ˆë“¤ (ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì„¤ì •)</div>
                </div>
                <p style="color: var(--text-secondary); margin-top: 1rem; font-size: 0.9rem;">
                    ìœ„ êµ¬ì¡°ë¡œ AHP ë¶„ì„ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤. ê¸°ì¤€ì´ ì„¤ì •ë˜ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </main>

    <script src="scripts/layout.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentCriteria = [];
        let currentProject = null;
        const API_BASE_URL = 'https://ahp-django-backend.onrender.com';

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ê¸°ì¤€ ì„¤ì • í˜ì´ì§€ ë¡œë“œë¨');
            
            // ë ˆì´ì•„ì›ƒ ì´ˆê¸°í™”
            if (window.layoutUtils) {
                window.layoutUtils.initializePage({
                    menuId: 'criteria',
                    pageId: 'projects',
                    title: 'ê¸°ì¤€ ì„¤ì •'
                });
            }
            
            checkBackendStatus();
            loadProject();
            loadCriteria();

            // í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('add-criteria-form').addEventListener('submit', handleAddCriteria);
        });

        // ë°±ì—”ë“œ ìƒíƒœ í™•ì¸
        async function checkBackendStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/service/status/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--success);">âœ… ì •ìƒ ì—°ê²°</span>';
                } else {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--warning);">âš ï¸ ì‘ë‹µ ì˜¤ë¥˜</span>';
                }
            } catch (error) {
                document.getElementById('backend-status').innerHTML = 
                    '<span style="color: var(--error);">âŒ ì—°ê²° ì‹¤íŒ¨</span>';
                console.error('ë°±ì—”ë“œ ì—°ê²° ì˜¤ë¥˜:', error);
            }
        }

        // í˜„ì¬ í”„ë¡œì íŠ¸ ì •ë³´ ë¡œë“œ
        function loadProject() {
            // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ í”„ë¡œì íŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const savedProject = sessionStorage.getItem('currentProject');
            if (savedProject) {
                try {
                    currentProject = JSON.parse(savedProject);
                    document.getElementById('current-project').textContent = currentProject.title;
                    return;
                } catch (e) {
                    console.error('í”„ë¡œì íŠ¸ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }
            
            // ê¸°ë³¸ê°’ìœ¼ë¡œ ë°ëª¨ í”„ë¡œì íŠ¸ ì„¤ì •
            currentProject = {
                id: 'demo-project',
                title: 'ìƒ˜í”Œ ì˜ì‚¬ê²°ì • í”„ë¡œì íŠ¸'
            };
            document.getElementById('current-project').textContent = currentProject.title;
        }

        // ê¸°ì¤€ ì¶”ê°€ ì²˜ë¦¬
        async function handleAddCriteria(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('add-btn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'ì¶”ê°€ ì¤‘...';
            submitBtn.disabled = true;

            // ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€ ì´ˆê¸°í™”
            document.getElementById('add-error').style.display = 'none';
            document.getElementById('add-success').style.display = 'none';

            try {
                const criteriaData = {
                    name: document.getElementById('criteria-name').value,
                    description: document.getElementById('criteria-description').value || '',
                    project_id: currentProject?.id || 'default',
                    weight: 0, // ì´ˆê¸° ê°€ì¤‘ì¹˜ëŠ” 0, ìŒëŒ€ë¹„êµ í›„ ê³„ì‚°ë¨
                    created_date: new Date().toISOString()
                };

                const response = await fetch(`${API_BASE_URL}/api/service/criteria/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(criteriaData)
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                    const successDiv = document.getElementById('add-success');
                    successDiv.textContent = `âœ… ê¸°ì¤€ "${criteriaData.name}"ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`;
                    successDiv.style.display = 'block';
                    
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('add-criteria-form').reset();
                    
                    // ê¸°ì¤€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    setTimeout(() => {
                        loadCriteria();
                        successDiv.style.display = 'none';
                    }, 2000);

                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ê¸°ì¤€ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('ê¸°ì¤€ ì¶”ê°€ ì˜¤ë¥˜:', error);
                const errorDiv = document.getElementById('add-error');
                errorDiv.textContent = `âŒ ì˜¤ë¥˜: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // ê¸°ì¤€ ëª©ë¡ ë¡œë“œ
        async function loadCriteria() {
            const loadingDiv = document.getElementById('criteria-loading');
            const errorDiv = document.getElementById('criteria-error');
            const containerDiv = document.getElementById('criteria-container');

            // UI ì´ˆê¸°í™”
            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            containerDiv.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE_URL}/api/service/criteria/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentCriteria = Array.isArray(data) ? data : (data.criteria || []);
                    renderCriteria();
                    updateHierarchyPreview();
                } else {
                    throw new Error('ê¸°ì¤€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('ê¸°ì¤€ ë¡œë“œ ì˜¤ë¥˜:', error);
                errorDiv.textContent = `âŒ ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        // ê¸°ì¤€ ëª©ë¡ ë Œë”ë§
        function renderCriteria() {
            const container = document.getElementById('criteria-container');
            const listElement = document.getElementById('criteria-list');
            
            if (currentCriteria.length === 0) {
                listElement.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">âš–ï¸</div>
                        <h3>ì•„ì§ ì„¤ì •ëœ ê¸°ì¤€ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ìœ„ì—ì„œ ìƒˆ ê¸°ì¤€ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
            } else {
                listElement.innerHTML = currentCriteria.map((criteria, index) => `
                    <div class="criteria-item" data-id="${criteria.id || index}">
                        <div class="drag-handle">â‰¡</div>
                        <div class="criteria-info">
                            <div class="criteria-name">${criteria.name}</div>
                            <div class="criteria-description">${criteria.description || 'ì„¤ëª… ì—†ìŒ'}</div>
                            <div class="criteria-weight">ê°€ì¤‘ì¹˜: ${criteria.weight ? (criteria.weight * 100).toFixed(1) + '%' : 'ë¯¸ì„¤ì •'}</div>
                        </div>
                        <div class="criteria-actions">
                            <button class="btn btn-secondary btn-small" onclick="editCriteria('${criteria.id || index}')">
                                âœï¸ ìˆ˜ì •
                            </button>
                            <button class="btn btn-danger btn-small" onclick="deleteCriteria('${criteria.id || index}')">
                                ğŸ—‘ï¸ ì‚­ì œ
                            </button>
                        </div>
                    </div>
                `).join('');

                // ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ í‘œì‹œ (3ê°œ ì´ìƒì˜ ê¸°ì¤€ì´ ìˆì„ ë•Œ)
                if (currentCriteria.length >= 3) {
                    document.getElementById('proceed-btn').style.display = 'block';
                }
            }
            
            container.style.display = 'block';
        }

        // ê³„ì¸µêµ¬ì¡° ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updateHierarchyPreview() {
            if (currentCriteria.length > 0) {
                const hierarchyDiv = document.getElementById('criteria-hierarchy');
                hierarchyDiv.innerHTML = currentCriteria.map(criteria => `
                    <div class="hierarchy-level" style="font-size: 0.9rem; min-width: 120px;">
                        ${criteria.name}
                    </div>
                `).join('');
                
                document.getElementById('hierarchy-preview').style.display = 'block';
            } else {
                document.getElementById('hierarchy-preview').style.display = 'none';
            }
        }

        // ê¸°ì¤€ ìˆ˜ì •
        function editCriteria(criteriaId) {
            const criteria = currentCriteria.find(c => (c.id || currentCriteria.indexOf(c)) == criteriaId);
            if (criteria) {
                document.getElementById('criteria-name').value = criteria.name;
                document.getElementById('criteria-description').value = criteria.description || '';
                
                // í¼ì„ ìˆ˜ì • ëª¨ë“œë¡œ ë³€ê²½ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë³„ë„ ëª¨ë‹¬ì´ë‚˜ ì¸ë¼ì¸ í¸ì§‘ ì‚¬ìš©)
                alert(`"${criteria.name}" ê¸°ì¤€ ìˆ˜ì • ê¸°ëŠ¥ì€ ë‹¤ìŒ ë²„ì „ì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.`);
            }
        }

        // ê¸°ì¤€ ì‚­ì œ
        async function deleteCriteria(criteriaId) {
            const criteria = currentCriteria.find(c => (c.id || currentCriteria.indexOf(c)) == criteriaId);
            if (!criteria) return;

            if (confirm(`"${criteria.name}" ê¸°ì¤€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                try {
                    // ì‹¤ì œ API í˜¸ì¶œ (í˜„ì¬ëŠ” ì‹œë®¬ë ˆì´ì…˜)
                    console.log(`ê¸°ì¤€ ì‚­ì œ: ${criteriaId}`);
                    
                    // ë¡œì»¬ì—ì„œ ì œê±° (ì‹¤ì œë¡œëŠ” API í˜¸ì¶œ í›„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨)
                    currentCriteria = currentCriteria.filter(c => (c.id || currentCriteria.indexOf(c)) != criteriaId);
                    renderCriteria();
                    updateHierarchyPreview();
                    
                    // ì„±ê³µ ë©”ì‹œì§€
                    const successDiv = document.getElementById('add-success');
                    successDiv.textContent = `âœ… "${criteria.name}" ê¸°ì¤€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    successDiv.style.display = 'block';
                    setTimeout(() => successDiv.style.display = 'none', 3000);

                } catch (error) {
                    console.error('ê¸°ì¤€ ì‚­ì œ ì˜¤ë¥˜:', error);
                    alert('ê¸°ì¤€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰
        function proceedToAlternatives() {
            if (currentCriteria.length < 3) {
                alert('AHP ë¶„ì„ì„ ìœ„í•´ ìµœì†Œ 3ê°œ ì´ìƒì˜ ê¸°ì¤€ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            const confirmed = confirm(
                `í˜„ì¬ ${currentCriteria.length}ê°œì˜ ê¸°ì¤€ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤:\n\n` +
                currentCriteria.map(c => `â€¢ ${c.name}`).join('\n') +
                `\n\në‹¤ìŒ ë‹¨ê³„(ëŒ€ì•ˆ ì…ë ¥)ë¡œ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
            );

            if (confirmed) {
                // í”„ë¡œì íŠ¸ì™€ ê¸°ì¤€ ì •ë³´ë¥¼ ì„¸ì…˜ì— ì €ì¥
                sessionStorage.setItem('currentProject', JSON.stringify(currentProject));
                sessionStorage.setItem('currentCriteria', JSON.stringify(currentCriteria));
                
                // ëŒ€ì•ˆ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = '/ahp_app/alternatives-management.html';
            }
        }

        // ë°ëª¨ ê¸°ì¤€ ìë™ ì¶”ê°€ (ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©)
        function addDemoCriteria() {
            const demoCriteria = [
                {
                    id: 'demo-1',
                    name: 'í’ˆì§ˆ',
                    description: 'ì œí’ˆì´ë‚˜ ì„œë¹„ìŠ¤ì˜ ì „ë°˜ì ì¸ í’ˆì§ˆ ìˆ˜ì¤€',
                    weight: 0.35
                },
                {
                    id: 'demo-2', 
                    name: 'ë¹„ìš©',
                    description: 'êµ¬ë§¤, ìœ ì§€ë³´ìˆ˜ ë“± ì´ ë¹„ìš©',
                    weight: 0.25
                },
                {
                    id: 'demo-3',
                    name: 'ì‹ ë¢°ì„±',
                    description: 'ì¥ê¸°ì ì¸ ì•ˆì •ì„±ê³¼ ì‹ ë¢°ë„',
                    weight: 0.20
                },
                {
                    id: 'demo-4',
                    name: 'ì‚¬ìš©ì„±',
                    description: 'ì‚¬ìš©ì ì¹œí™”ì„±ê³¼ í¸ì˜ì„±',
                    weight: 0.20
                }
            ];

            currentCriteria = demoCriteria;
            renderCriteria();
            updateHierarchyPreview();
        }

        // ê°œë°œìš©: Ctrl+Dë¡œ ë°ëª¨ ë°ì´í„° ì¶”ê°€
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                addDemoCriteria();
            }
        });
    </script>
</body>
</html>