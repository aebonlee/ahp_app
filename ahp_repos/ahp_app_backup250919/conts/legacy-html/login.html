<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ - AHP System</title>
    <style>
        :root {
            --accent-primary: #C8A968;
            --accent-secondary: #A98C4B;
            --accent-light: #E5D5AA;
            --accent-hover: #B59A4D;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-elevated: #f3f4f6;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --gradient-primary: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }

        /* ë‹¤í¬ ëª¨ë“œ */
        [data-theme="dark"] {
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-elevated: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --border-light: #374151;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, #fafaf9 0%, #f9f7f4 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            padding: 2rem;
        }

        .login-card {
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-light);
        }

        .logo-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--text-primary);
            text-decoration: none;
            margin-bottom: 0.5rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .login-subtitle {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(200, 169, 104, 0.1);
        }

        .form-input:invalid {
            border-color: #ef4444;
        }

        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox {
            width: 16px;
            height: 16px;
            accent-color: var(--accent-primary);
        }

        .checkbox-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .forgot-link {
            color: var(--accent-primary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .forgot-link:hover {
            text-decoration: underline;
        }

        .login-btn {
            width: 100%;
            padding: 0.875rem 1.5rem;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
        }

        .login-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(200, 169, 104, 0.4);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .divider {
            text-align: center;
            margin: 1.5rem 0;
            position: relative;
            color: var(--text-secondary);
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border-light);
        }

        .divider span {
            background: white;
            padding: 0 1rem;
        }

        .social-login {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .social-btn {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .social-btn:hover {
            border-color: var(--accent-primary);
            transform: translateY(-1px);
        }

        .register-link {
            text-align: center;
            color: var(--text-secondary);
        }

        .register-link a {
            color: var(--accent-primary);
            text-decoration: none;
            font-weight: 600;
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #16a34a;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        @media (max-width: 480px) {
            .login-container {
                padding: 1rem;
            }
            
            .login-card {
                padding: 1.5rem;
            }
            
            .social-login {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div class="logo-section">
                <a href="/ahp_app/" class="logo">
                    <div class="logo-icon">A</div>
                    <span>AHP System</span>
                </a>
            </div>

            <h1 class="login-title">ë¡œê·¸ì¸</h1>
            <p class="login-subtitle">ê³„ì •ì— ë¡œê·¸ì¸í•˜ì—¬ AHP ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”</p>

            <div id="messageContainer"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="email" class="form-label">ì´ë©”ì¼</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-input" 
                        placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        class="form-input" 
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        required
                    >
                </div>

                <div class="form-options">
                    <div class="checkbox-group">
                        <input type="checkbox" id="remember" name="remember" class="checkbox">
                        <label for="remember" class="checkbox-label">ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€</label>
                    </div>
                    <a href="/ahp_app/forgot-password.html" class="forgot-link">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
                </div>

                <button type="submit" class="login-btn" id="loginButton">
                    ë¡œê·¸ì¸
                </button>
            </form>

            <div class="divider">
                <span>ë˜ëŠ”</span>
            </div>

            <div class="social-login">
                <button class="social-btn" id="googleLogin">
                    <span>ğŸ”</span> Google
                </button>
                <button class="social-btn" id="kakaoLogin">
                    <span>ğŸ’¬</span> Kakao
                </button>
            </div>

            <p class="register-link">
                ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="/ahp_app/register.html">íšŒì›ê°€ì…</a>
            </p>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://ahp-django-backend.onrender.com';
        
        // DOM ìš”ì†Œ
        const loginForm = document.getElementById('loginForm');
        const loginButton = document.getElementById('loginButton');
        const messageContainer = document.getElementById('messageContainer');

        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage(message, type = 'error') {
            messageContainer.innerHTML = `
                <div class="${type}-message">
                    ${message}
                </div>
            `;
            setTimeout(() => {
                messageContainer.innerHTML = '';
            }, 5000);
        }

        // ë¡œê·¸ì¸ í¼ ì²˜ë¦¬
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(loginForm);
            const loginData = {
                email: formData.get('email'),
                password: formData.get('password'),
                remember: formData.get('remember') === 'on'
            };

            loginButton.disabled = true;
            loginButton.textContent = 'ë¡œê·¸ì¸ ì¤‘...';

            try {
                // ë¨¼ì € ì‹¤ì œ Django API ì‹œë„
                let response = await authenticateWithDjango(loginData);
                
                // Django API ì‹¤íŒ¨ì‹œ ë°ëª¨ ëª¨ë“œë¡œ í´ë°±
                if (!response.success) {
                    console.log('Django API ë¡œê·¸ì¸ ì‹¤íŒ¨, ë°ëª¨ ëª¨ë“œë¡œ ì „í™˜');
                    response = await mockLogin(loginData);
                }
                
                if (response.success) {
                    // ë¡œê·¸ì¸ ì„±ê³µ
                    localStorage.setItem('ahp_user', JSON.stringify(response.user));
                    localStorage.setItem('ahp_token', response.token);
                    localStorage.setItem('login_method', response.method || 'demo');
                    
                    // ì‚¬ìš©ì ì—­í• ì— ë”°ë¼ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²°ì •
                    const redirectUrl = response.user.role === 'admin' 
                        ? '/ahp_app/super-admin-dashboard.html'
                        : '/ahp_app/personal-service-enhanced.html';
                    
                    const dashboardName = response.user.role === 'admin' ? 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ' : 'ê°œì¸ì„œë¹„ìŠ¤';
                    const methodMsg = response.method === 'django' ? '(Django API)' : '(ë°ëª¨ ëª¨ë“œ)';
                    showMessage(`ë¡œê·¸ì¸ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤! ${dashboardName}ë¡œ ì´ë™í•©ë‹ˆë‹¤. ${methodMsg}`, 'success');
                    
                    setTimeout(() => {
                        window.location.href = redirectUrl;
                    }, 1500);
                } else {
                    showMessage(response.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                showMessage('ì„œë²„ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                loginButton.disabled = false;
                loginButton.textContent = 'ë¡œê·¸ì¸';
            }
        });

        // Django API ì¸ì¦ í•¨ìˆ˜
        async function authenticateWithDjango(loginData) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/login/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        username: loginData.email,
                        email: loginData.email,
                        password: loginData.password
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    // Django ì‘ë‹µì„ í”„ë¡ íŠ¸ì—”ë“œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    if (data.access_token || data.token) {
                        return {
                            success: true,
                            method: 'django',
                            user: {
                                id: data.user?.id || data.user_id || Math.floor(Math.random() * 1000),
                                email: data.user?.email || loginData.email,
                                name: data.user?.first_name || data.user?.username || 'ì‚¬ìš©ì',
                                role: data.user?.is_staff ? 'admin' : 'user'
                            },
                            token: data.access_token || data.token
                        };
                    }
                }
                
                // ì‘ë‹µì´ ì‹¤íŒ¨í•œ ê²½ìš°
                const errorData = await response.json().catch(() => ({}));
                return {
                    success: false,
                    message: errorData.message || errorData.detail || 'Django API ë¡œê·¸ì¸ ì‹¤íŒ¨'
                };

            } catch (error) {
                console.error('Django API ì—°ê²° ì˜¤ë¥˜:', error);
                return {
                    success: false,
                    message: 'Django API ì—°ê²° ì‹¤íŒ¨'
                };
            }
        }

        // ë°ëª¨ìš© ë¡œê·¸ì¸ í•¨ìˆ˜ (í´ë°±)
        async function mockLogin(loginData) {
            // ì‹œë®¬ë ˆì´ì…˜ì„ ìœ„í•œ ì§€ì—°
            await new Promise(resolve => setTimeout(resolve, 1000));

            // ë°ëª¨ ê³„ì •
            const demoUsers = [
                {
                    email: 'admin@ahp.com',
                    password: 'admin123',
                    name: 'ê´€ë¦¬ì',
                    role: 'admin'
                },
                {
                    email: 'user@ahp.com',
                    password: 'user123',
                    name: 'ì‚¬ìš©ì',
                    role: 'user'
                },
                {
                    email: 'demo@ahp.com',
                    password: 'demo123',
                    name: 'ë°ëª¨ ì‚¬ìš©ì',
                    role: 'user'
                },
                {
                    email: 'admin@ahp-platform.com',
                    password: 'ahp2025admin',
                    name: 'Django ê´€ë¦¬ì',
                    role: 'admin'
                }
            ];

            const user = demoUsers.find(u => 
                u.email === loginData.email && u.password === loginData.password
            );

            if (user) {
                return {
                    success: true,
                    method: 'demo',
                    user: {
                        id: Math.floor(Math.random() * 1000),
                        email: user.email,
                        name: user.name,
                        role: user.role
                    },
                    token: 'demo_token_' + Date.now()
                };
            } else {
                return {
                    success: false,
                    message: 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'
                };
            }
        }

        // ì†Œì…œ ë¡œê·¸ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('googleLogin').addEventListener('click', function() {
            showMessage('Google ë¡œê·¸ì¸ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        });

        document.getElementById('kakaoLogin').addEventListener('click', function() {
            showMessage('Kakao ë¡œê·¸ì¸ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        });

        // ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœì¸ì§€ í™•ì¸
        const token = localStorage.getItem('ahp_token');
        const user = localStorage.getItem('ahp_user');
        if (token && user) {
            try {
                const userData = JSON.parse(user);
                const dashboardUrl = userData.role === 'admin' 
                    ? '/ahp_app/super-admin-dashboard.html'
                    : '/ahp_app/personal-service-enhanced.html';
                
                showMessage(`ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ${userData.name}ë‹˜, ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, 'success');
                
                // 3ì´ˆ í›„ ìë™ ì´ë™í•˜ê±°ë‚˜ ì‚¬ìš©ìê°€ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ë²„íŠ¼ ì¶”ê°€
                setTimeout(() => {
                    if (confirm(`${userData.name}ë‹˜, ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        window.location.href = dashboardUrl;
                    }
                }, 1000);
                
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', error);
                localStorage.removeItem('ahp_user');
                localStorage.removeItem('ahp_token');
            }
        }

        // URLì—ì„œ ë©”ì‹œì§€ íŒŒë¼ë¯¸í„° í™•ì¸
        const urlParams = new URLSearchParams(window.location.search);
        const message = urlParams.get('message');
        if (message === 'registered') {
            showMessage('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'success');
        }

        console.log('âœ… AHP System ë¡œê·¸ì¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        console.log('ğŸ’¡ ë°ëª¨ ê³„ì •:');
        console.log('- admin@ahp.com / admin123');
        console.log('- user@ahp.com / user123');
        console.log('- demo@ahp.com / demo123');
    </script>
</body>
</html>