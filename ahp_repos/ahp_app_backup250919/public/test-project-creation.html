<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸ - AHP Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2rem;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        .btn-warning {
            background: #ed8936;
            color: white;
        }
        
        .btn-info {
            background: #4299e1;
            color: white;
        }
        
        .console {
            background: #1a202c;
            color: #68d391;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .console-line {
            margin-bottom: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .success {
            color: #68d391;
        }
        
        .error {
            color: #fc8181;
        }
        
        .info {
            color: #63b3ed;
        }
        
        .warning {
            color: #f6e05e;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #48bb78;
            animation: pulse 2s infinite;
        }
        
        .status-offline {
            background: #f56565;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª í”„ë¡œì íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸ ì½˜ì†”</h1>
        
        <!-- ì—°ê²° ìƒíƒœ -->
        <div class="section">
            <h2>ğŸ“¡ ì—°ê²° ìƒíƒœ</h2>
            <div>
                <span class="status-indicator status-online" id="statusIndicator"></span>
                <span id="statusText">ì˜¨ë¼ì¸</span>
            </div>
            <div style="margin-top: 10px;">
                <strong>API ì„œë²„:</strong> <span id="apiServer">https://ahp-django-backend.onrender.com</span>
            </div>
        </div>
        
        <!-- í”„ë¡œì íŠ¸ ì •ë³´ ì…ë ¥ -->
        <div class="section">
            <h2>ğŸ“ í”„ë¡œì íŠ¸ ì •ë³´</h2>
            <div class="form-group">
                <label for="projectTitle">í”„ë¡œì íŠ¸ ì œëª© *</label>
                <input type="text" id="projectTitle" value="í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸" placeholder="í”„ë¡œì íŠ¸ ì œëª© ì…ë ¥">
            </div>
            <div class="form-group">
                <label for="projectObjective">í”„ë¡œì íŠ¸ ëª©í‘œ *</label>
                <input type="text" id="projectObjective" value="ìµœì ì˜ ëŒ€ì•ˆ ì„ íƒ" placeholder="í”„ë¡œì íŠ¸ ëª©í‘œ ì…ë ¥">
            </div>
            <div class="form-group">
                <label for="projectDescription">ìƒì„¸ ì„¤ëª…</label>
                <textarea id="projectDescription" rows="3" placeholder="í”„ë¡œì íŠ¸ ìƒì„¸ ì„¤ëª… ì…ë ¥">í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.</textarea>
            </div>
            <div class="form-group">
                <label for="projectVisibility">ê³µê°œ ë²”ìœ„</label>
                <select id="projectVisibility">
                    <option value="private">ë¹„ê³µê°œ</option>
                    <option value="team">íŒ€ ê³µê°œ</option>
                    <option value="public">ì „ì²´ ê³µê°œ</option>
                </select>
            </div>
        </div>
        
        <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
        <div class="section">
            <h2>ğŸš€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</h2>
            <div class="button-group">
                <button class="btn-primary" onclick="testConnection()">1. ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                <button class="btn-info" onclick="testAuth()">2. ì¸ì¦ í…ŒìŠ¤íŠ¸</button>
                <button class="btn-success" onclick="testCreateProject()">3. í”„ë¡œì íŠ¸ ìƒì„±</button>
                <button class="btn-warning" onclick="testDirectAPI()">4. ì§ì ‘ API í˜¸ì¶œ</button>
            </div>
        </div>
        
        <!-- ì½˜ì†” ì¶œë ¥ -->
        <div class="console" id="console">
            <div class="console-line info">ğŸ¯ í”„ë¡œì íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸ ì½˜ì†” ì¤€ë¹„ ì™„ë£Œ</div>
            <div class="console-line info">ğŸ“… ${new Date().toLocaleString()}</div>
            <div class="console-line">-----------------------------------</div>
        </div>
    </div>
    
    <script>
        // ì½˜ì†” ë¡œê·¸ í•¨ìˆ˜
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }
        
        // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì²´í¬
        function updateNetworkStatus() {
            const indicator = document.getElementById('statusIndicator');
            const text = document.getElementById('statusText');
            
            if (navigator.onLine) {
                indicator.className = 'status-indicator status-online';
                text.textContent = 'ì˜¨ë¼ì¸';
            } else {
                indicator.className = 'status-indicator status-offline';
                text.textContent = 'ì˜¤í”„ë¼ì¸';
            }
        }
        
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
        
        // 1. ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testConnection() {
            log('ğŸ” API ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                const response = await fetch('https://ahp-django-backend.onrender.com/api/service/projects/', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                log(`âœ… ì„œë²„ ì‘ë‹µ: ${response.status} ${response.statusText}`, 'success');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`ğŸ“Š í”„ë¡œì íŠ¸ ìˆ˜: ${data.count || 0}ê°œ`, 'info');
                    log('âœ… API ì„œë²„ ì—°ê²° ì„±ê³µ!', 'success');
                } else {
                    log(`âš ï¸ ì„œë²„ ì‘ë‹µ ì½”ë“œ: ${response.status}`, 'warning');
                }
            } catch (error) {
                log(`âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // 2. ì¸ì¦ í…ŒìŠ¤íŠ¸
        async function testAuth() {
            log('ğŸ” ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
            
            try {
                // ì„¸ì…˜ ì¿ í‚¤ í™•ì¸
                const cookies = document.cookie;
                log(`ğŸª ì¿ í‚¤: ${cookies || '(ì—†ìŒ)'}`, 'info');
                
                // CSRF í† í° í™•ì¸
                const csrfToken = getCookie('csrftoken');
                if (csrfToken) {
                    log(`ğŸ”‘ CSRF í† í°: ${csrfToken.substring(0, 10)}...`, 'success');
                } else {
                    log('âš ï¸ CSRF í† í° ì—†ìŒ', 'warning');
                }
                
                // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹œë„
                const response = await fetch('https://ahp-django-backend.onrender.com/api/auth/user/', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    log(`âœ… ì¸ì¦ëœ ì‚¬ìš©ì: ${user.username || user.email}`, 'success');
                } else {
                    log('âš ï¸ ì¸ì¦ë˜ì§€ ì•Šì€ ìƒíƒœ (Anonymous)', 'warning');
                }
            } catch (error) {
                log(`âŒ ì¸ì¦ í™•ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // 3. í”„ë¡œì íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸
        async function testCreateProject() {
            log('ğŸš€ í”„ë¡œì íŠ¸ ìƒì„± ì‹œì‘...', 'info');
            
            const projectData = {
                title: document.getElementById('projectTitle').value + ' - ' + new Date().toLocaleTimeString(),
                objective: document.getElementById('projectObjective').value,
                description: document.getElementById('projectDescription').value,
                visibility: document.getElementById('projectVisibility').value,
                consistency_ratio_threshold: 0.1,
                tags: ['test', 'debug'],
                settings: {
                    evaluation_method: 'pairwise',
                    status: 'draft'
                }
            };
            
            log(`ğŸ“¤ ìš”ì²­ ë°ì´í„°: ${JSON.stringify(projectData, null, 2)}`, 'info');
            
            try {
                const csrfToken = getCookie('csrftoken');
                const headers = {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                };
                
                if (csrfToken) {
                    headers['X-CSRFToken'] = csrfToken;
                }
                
                const response = await fetch('https://ahp-django-backend.onrender.com/api/service/projects/', {
                    method: 'POST',
                    credentials: 'include',
                    headers: headers,
                    body: JSON.stringify(projectData)
                });
                
                log(`ğŸ“¥ ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                const responseText = await response.text();
                let responseData;
                
                try {
                    responseData = JSON.parse(responseText);
                    log(`ğŸ“¥ ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(responseData, null, 2)}`, response.ok ? 'success' : 'error');
                } catch {
                    log(`ğŸ“¥ ì‘ë‹µ í…ìŠ¤íŠ¸: ${responseText}`, 'warning');
                }
                
                if (response.ok) {
                    log('âœ… í”„ë¡œì íŠ¸ ìƒì„± ì„±ê³µ!', 'success');
                    if (responseData && responseData.id) {
                        log(`ğŸ†” í”„ë¡œì íŠ¸ ID: ${responseData.id}`, 'success');
                    }
                } else {
                    log(`âŒ í”„ë¡œì íŠ¸ ìƒì„± ì‹¤íŒ¨: ${response.status}`, 'error');
                    if (responseData && responseData.detail) {
                        log(`ğŸ’­ ì˜¤ë¥˜ ìƒì„¸: ${responseData.detail}`, 'error');
                    }
                }
            } catch (error) {
                log(`âŒ ìš”ì²­ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // 4. ì§ì ‘ API í˜¸ì¶œ (curl ìŠ¤íƒ€ì¼)
        async function testDirectAPI() {
            log('ğŸ”§ ì§ì ‘ API í˜¸ì¶œ (ìµëª… ì‚¬ìš©ìë¡œ)...', 'info');
            
            const projectData = {
                title: 'ìµëª… í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ ' + Date.now(),
                objective: 'ìµëª… ì‚¬ìš©ì í…ŒìŠ¤íŠ¸',
                description: 'ì¸ì¦ ì—†ì´ í”„ë¡œì íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸',
                visibility: 'private'
            };
            
            log(`ğŸ“¤ ìµœì†Œ ë°ì´í„°ë¡œ ì‹œë„: ${JSON.stringify(projectData)}`, 'info');
            
            try {
                const response = await fetch('https://ahp-django-backend.onrender.com/api/service/projects/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(projectData)
                });
                
                const responseText = await response.text();
                log(`ğŸ“¥ ì‘ë‹µ: ${response.status} - ${responseText}`, response.ok ? 'success' : 'error');
                
                if (!response.ok) {
                    log('ğŸ’¡ íŒíŠ¸: ì¸ì¦ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Django adminì—ì„œ ê¶Œí•œ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.', 'warning');
                }
            } catch (error) {
                log(`âŒ ì§ì ‘ í˜¸ì¶œ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // ì¿ í‚¤ ê°€ì ¸ì˜¤ê¸° í—¬í¼
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
        
        // ì´ˆê¸° ìƒíƒœ ì²´í¬
        updateNetworkStatus();
        log('ğŸ’¡ íŒ: ë²„íŠ¼ì„ ìˆœì„œëŒ€ë¡œ í´ë¦­í•˜ì—¬ ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ì„¸ìš”', 'info');
    </script>
</body>
</html>