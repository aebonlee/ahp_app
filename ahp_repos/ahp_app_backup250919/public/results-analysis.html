<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - ê²°ê³¼ ë¶„ì„</title>
    <link rel="stylesheet" href="styles/layout.css">
    <style>
        :root {
            --accent-primary: #C8A968;
            --accent-secondary: #A98C4B;
            --accent-light: #E5D5AA;
            --accent-hover: #B59A4D;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --rank-1: #FFD700;
            --rank-2: #C0C0C0;
            --rank-3: #CD7F32;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s;
            font-size: 0.9rem;
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .status-bar {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-light);
        }

        .progress-bar {
            background: var(--border-light);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .results-summary {
            background: linear-gradient(135deg, var(--accent-light), #f8f6f0);
            border: 2px solid var(--accent-primary);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .winner-announcement {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-primary);
            margin-bottom: 1rem;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .ranking-table th,
        .ranking-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        .ranking-table th {
            background: var(--accent-primary);
            color: white;
            font-weight: 600;
        }

        .ranking-table tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .rank-1 { background: var(--rank-1); color: #8B4513; }
        .rank-2 { background: var(--rank-2); color: #2C2C2C; }
        .rank-3 { background: var(--rank-3); color: white; }
        .rank-other { background: var(--text-secondary); }

        .weight-bar {
            background: var(--border-light);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .weight-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 10px;
            transition: width 0.8s ease;
        }

        .weight-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .criteria-weights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .criteria-card {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-light);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .criteria-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .criteria-weight {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-primary);
            margin: 0.5rem 0;
        }

        .detailed-scores {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .score-matrix {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .score-matrix th,
        .score-matrix td {
            padding: 0.75rem;
            text-align: center;
            border: 1px solid var(--border-light);
            background: white;
        }

        .score-matrix th {
            background: var(--accent-light);
            color: var(--accent-primary);
            font-weight: 600;
        }

        .chart-container {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 2rem;
            margin: 1.5rem 0;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-placeholder {
            text-align: center;
            color: var(--text-secondary);
        }

        .export-options {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        .btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(200, 169, 104, 0.4);
        }

        .btn-secondary {
            background: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--text-primary);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #059669;
        }

        .sensitivity-analysis {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 2px dashed var(--success);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .celebration {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, var(--accent-light), #fff);
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .trophy {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .export-options {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .ranking-table {
                font-size: 0.9rem;
            }
            
            .criteria-weights {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="header">
        <div class="header-left">
            <a href="./personal-service-enhanced.html" class="logo">
                <div class="logo-icon">A</div>
                <span>AHP System</span>
            </a>
            <nav class="header-nav">
                <a href="./personal-service-enhanced.html" class="header-nav-item" data-page="dashboard">ëŒ€ì‹œë³´ë“œ</a>
                <a href="./project-management.html" class="header-nav-item" data-page="projects">í”„ë¡œì íŠ¸</a>
                <a href="./results-analysis.html" class="header-nav-item active" data-page="analysis">ë¶„ì„</a>
                <a href="#" class="header-nav-item" data-page="reports">ë³´ê³ ì„œ</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">ê¹€</div>
                <div>
                    <div class="user-name">ê¹€ì² ìˆ˜</div>
                    <div class="user-role">Personal Admin</div>
                </div>
            </div>
            <button onclick="handleLogout()" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </header>

    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-section-title">í”„ë¡œì íŠ¸ ê´€ë¦¬</div>
            <div class="sidebar-menu">
                <a href="./project-management.html" class="sidebar-item" data-menu="my-projects">
                    <span class="sidebar-icon">ğŸ“‹</span>
                    <span>ë‚´ í”„ë¡œì íŠ¸</span>
                    <span class="sidebar-badge">3</span>
                </a>
                <a href="./project-management.html" class="sidebar-item" data-menu="new-project">
                    <span class="sidebar-icon">â•</span>
                    <span>ìƒˆ í”„ë¡œì íŠ¸</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="trash">
                    <span class="sidebar-icon">ğŸ—‘ï¸</span>
                    <span>íœ´ì§€í†µ</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ëª¨ë¸ êµ¬ì¶•</div>
            <div class="sidebar-menu">
                <a href="./criteria-management.html" class="sidebar-item" data-menu="criteria">
                    <span class="sidebar-icon">âš–ï¸</span>
                    <span>ê¸°ì¤€ ì„¤ì •</span>
                </a>
                <a href="./alternatives-management.html" class="sidebar-item" data-menu="alternatives">
                    <span class="sidebar-icon">ğŸ”„</span>
                    <span>ëŒ€ì•ˆ ê´€ë¦¬</span>
                </a>
                <a href="./pairwise-comparison.html" class="sidebar-item" data-menu="comparison">
                    <span class="sidebar-icon">âš¡</span>
                    <span>ìŒëŒ€ë¹„êµ</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="evaluators">
                    <span class="sidebar-icon">ğŸ‘¥</span>
                    <span>í‰ê°€ì ê´€ë¦¬</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ë¶„ì„ ë° ê²°ê³¼</div>
            <div class="sidebar-menu">
                <a href="./results-analysis.html" class="sidebar-item active" data-menu="results">
                    <span class="sidebar-icon">ğŸ“ˆ</span>
                    <span>ê²°ê³¼ ë¶„ì„</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="monitoring">
                    <span class="sidebar-icon">ğŸ“Š</span>
                    <span>ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="reports">
                    <span class="sidebar-icon">ğŸ“„</span>
                    <span>ë³´ê³ ì„œ ìƒì„±</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="sensitivity">
                    <span class="sidebar-icon">ğŸ”</span>
                    <span>ë¯¼ê°ë„ ë¶„ì„</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">ì„¤ì •</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-menu="settings">
                    <span class="sidebar-icon">âš™ï¸</span>
                    <span>ê°œì¸ ì„¤ì •</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="billing">
                    <span class="sidebar-icon">ğŸ’³</span>
                    <span>ìš”ê¸ˆì œ ê´€ë¦¬</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="guide">
                    <span class="sidebar-icon">ğŸ“š</span>
                    <span>ì‚¬ìš© ê°€ì´ë“œ</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <span id="toggle-icon">â—€</span>
    </button>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <div class="status-bar">
            <div>
                <strong>Django ë°±ì—”ë“œ:</strong> <span id="backend-status">ì—°ê²° í™•ì¸ì¤‘...</span>
            </div>
            <div>
                <strong>í˜„ì¬ í”„ë¡œì íŠ¸:</strong> <span id="current-project">í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            </div>
            <div>
                <strong>ë‹¨ê³„:</strong> <span style="color: var(--success);">5ë‹¨ê³„ - ê²°ê³¼ ë¶„ì„ ì™„ë£Œ</span>
            </div>
        </div>

        <!-- AHP ì§„í–‰ ìƒí™© -->
        <div class="section">
            <h2 class="section-title">ğŸ¯ AHP ë¶„ì„ ì™„ë£Œ</h2>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 100%;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">
                <span>í”„ë¡œì íŠ¸ ìƒì„±</span>
                <span>ê¸°ì¤€ ì„¤ì •</span>
                <span>ëŒ€ì•ˆ ì…ë ¥</span>
                <span>ìŒëŒ€ë¹„êµ</span>
                <span style="color: var(--success); font-weight: 600;">ê²°ê³¼ ë¶„ì„</span>
            </div>
        </div>

        <!-- ì¶•í•˜ ì„¹ì…˜ -->
        <div class="celebration">
            <div class="trophy">ğŸ†</div>
            <h2 style="color: var(--accent-primary); margin-bottom: 0.5rem;">ë¶„ì„ ì™„ë£Œ!</h2>
            <p style="color: var(--text-secondary);">AHP ì˜ì‚¬ê²°ì • ë¶„ì„ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
        </div>

        <!-- ê²°ê³¼ ìš”ì•½ -->
        <div class="section">
            <h2 class="section-title">ğŸ… ìµœì¢… ê²°ê³¼ ìš”ì•½</h2>
            <div class="results-summary">
                <div class="winner-announcement">
                    ğŸ¥‡ ìµœì  ì„ íƒ: <span id="winner-name">-</span>
                </div>
                <div style="color: var(--text-secondary); font-size: 1.1rem;">
                    ì¢…í•© ê°€ì¤‘ì¹˜: <strong id="winner-score" style="color: var(--accent-primary);">-</strong>
                </div>
            </div>

            <div id="ranking-loading" class="loading">
                ê²°ê³¼ë¥¼ ê³„ì‚°í•˜ëŠ” ì¤‘...
            </div>

            <table class="ranking-table" id="ranking-table" style="display: none;">
                <thead>
                    <tr>
                        <th>ìˆœìœ„</th>
                        <th>ëŒ€ì•ˆ</th>
                        <th>ì¢…í•© ê°€ì¤‘ì¹˜</th>
                        <th>ìƒëŒ€ì  ë¹„ìœ¨</th>
                        <th>ì‹œê°ì  í‘œí˜„</th>
                    </tr>
                </thead>
                <tbody id="ranking-tbody">
                    <!-- ìˆœìœ„ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
            </table>
        </div>

        <!-- ê¸°ì¤€ë³„ ê°€ì¤‘ì¹˜ -->
        <div class="section">
            <h2 class="section-title">âš–ï¸ ê¸°ì¤€ë³„ ê°€ì¤‘ì¹˜ ë¶„ì„</h2>
            <div class="criteria-weights" id="criteria-weights">
                <!-- ê¸°ì¤€ë³„ ê°€ì¤‘ì¹˜ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì„¸ë¶€ ì ìˆ˜í‘œ -->
        <div class="section">
            <h2 class="section-title">ğŸ“Š ì„¸ë¶€ ì ìˆ˜í‘œ</h2>
            <div class="detailed-scores">
                <table class="score-matrix" id="detailed-scores-table">
                    <thead>
                        <tr>
                            <th>ëŒ€ì•ˆ</th>
                            <!-- ê¸°ì¤€ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </tr>
                    </thead>
                    <tbody id="detailed-scores-tbody">
                        <!-- ì„¸ë¶€ ì ìˆ˜ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ì°¨íŠ¸ ì˜ì—­ -->
        <div class="section">
            <h2 class="section-title">ğŸ“ˆ ì‹œê°ì  ë¶„ì„</h2>
            <div class="chart-container">
                <div class="chart-placeholder">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“Š</div>
                    <h3>ì°¨íŠ¸ê°€ ê³§ êµ¬í˜„ë©ë‹ˆë‹¤</h3>
                    <p>ë§‰ëŒ€ ê·¸ë˜í”„, ì›í˜• ì°¨íŠ¸, ë ˆì´ë” ì°¨íŠ¸ ë“±ì„ í†µí•œ<br>ì‹œê°ì  ë¶„ì„ ê²°ê³¼ë¥¼ ì œê³µí•  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>

        <!-- ë¯¼ê°ë„ ë¶„ì„ -->
        <div class="section">
            <h2 class="section-title">ğŸ” ë¯¼ê°ë„ ë¶„ì„</h2>
            <div class="sensitivity-analysis">
                <h3 style="color: var(--success); margin-bottom: 1rem;">ğŸ“Š ê²°ê³¼ì˜ ì•ˆì •ì„±</h3>
                <div id="sensitivity-results">
                    <div style="margin: 1rem 0;">
                        <strong>ì¼ê´€ì„± ë¹„ìœ¨:</strong> <span id="overall-cr">0.05</span> (âœ… ì¼ê´€ì„± ìˆìŒ)
                    </div>
                    <div style="margin: 1rem 0;">
                        <strong>ìˆœìœ„ ì•ˆì •ì„±:</strong> <span style="color: var(--success);">ë†’ìŒ</span>
                    </div>
                    <div style="margin: 1rem 0; color: var(--text-secondary); font-size: 0.9rem;">
                        ê¸°ì¤€ ê°€ì¤‘ì¹˜ë¥¼ Â±10% ë³€ê²½í•´ë„ 1ìœ„ ìˆœìœ„ëŠ” ë³€í•˜ì§€ ì•Šì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </div>

        <!-- ë‚´ë³´ë‚´ê¸° ì˜µì…˜ -->
        <div class="section">
            <h2 class="section-title">ğŸ’¾ ê²°ê³¼ ì €ì¥ ë° ê³µìœ </h2>
            <div class="export-options">
                <button class="btn" onclick="exportToPDF()">
                    ğŸ“„ PDF ë³´ê³ ì„œ
                </button>
                <button class="btn btn-secondary" onclick="exportToExcel()">
                    ğŸ“Š Excel íŒŒì¼
                </button>
                <button class="btn btn-secondary" onclick="copyResults()">
                    ğŸ“‹ ê²°ê³¼ ë³µì‚¬
                </button>
                <button class="btn btn-success" onclick="saveToDatabase()">
                    ğŸ’¾ ê²°ê³¼ ì €ì¥
                </button>
            </div>
        </div>

        <!-- ìƒˆ ë¶„ì„ ì‹œì‘ -->
        <div class="section">
            <h2 class="section-title">ğŸ”„ ì¶”ê°€ ì‘ì—…</h2>
            <div style="text-align: center;">
                <p style="margin-bottom: 2rem; color: var(--text-secondary);">
                    ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ê±°ë‚˜ í˜„ì¬ ê²°ê³¼ë¥¼ í™œìš©í•´ë³´ì„¸ìš”.
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn" onclick="startNewProject()">
                        ğŸ†• ìƒˆ í”„ë¡œì íŠ¸ ì‹œì‘
                    </button>
                    <button class="btn btn-secondary" onclick="modifyCurrentProject()">
                        âœï¸ í˜„ì¬ í”„ë¡œì íŠ¸ ìˆ˜ì •
                    </button>
                    <a href="./personal-service.html" class="btn btn-secondary">
                        ğŸ  ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script src="scripts/layout.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentProject = null;
        let currentCriteria = [];
        let currentAlternatives = [];
        let comparisonResults = {};
        let finalResults = [];
        const API_BASE_URL = 'https://ahp-django-backend.onrender.com';

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ê²°ê³¼ ë¶„ì„ í˜ì´ì§€ ë¡œë“œë¨');
            
            // ë ˆì´ì•„ì›ƒ ì´ˆê¸°í™”
            if (window.layoutUtils) {
                window.layoutUtils.initializePage({
                    menuId: 'results',
                    pageId: 'analysis',
                    title: 'ê²°ê³¼ ë¶„ì„'
                });
            }
            
            checkBackendStatus();
            loadProjectData();
            calculateResults();
        });

        // ë°±ì—”ë“œ ìƒíƒœ í™•ì¸
        async function checkBackendStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/service/status/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--success);">âœ… ì •ìƒ ì—°ê²°</span>';
                } else {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--warning);">âš ï¸ ì‘ë‹µ ì˜¤ë¥˜</span>';
                }
            } catch (error) {
                document.getElementById('backend-status').innerHTML = 
                    '<span style="color: var(--error);">âŒ ì—°ê²° ì‹¤íŒ¨</span>';
                console.error('ë°±ì—”ë“œ ì—°ê²° ì˜¤ë¥˜:', error);
            }
        }

        // í”„ë¡œì íŠ¸ ë°ì´í„° ë¡œë“œ
        function loadProjectData() {
            const savedProject = sessionStorage.getItem('currentProject');
            const savedCriteria = sessionStorage.getItem('currentCriteria');
            const savedAlternatives = sessionStorage.getItem('currentAlternatives');
            const savedComparisons = sessionStorage.getItem('comparisonResults');

            if (savedProject) {
                try {
                    currentProject = JSON.parse(savedProject);
                    document.getElementById('current-project').textContent = currentProject.title;
                } catch (e) {
                    console.error('í”„ë¡œì íŠ¸ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }

            if (savedCriteria) {
                try {
                    currentCriteria = JSON.parse(savedCriteria);
                } catch (e) {
                    console.error('ê¸°ì¤€ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }

            if (savedAlternatives) {
                try {
                    currentAlternatives = JSON.parse(savedAlternatives);
                } catch (e) {
                    console.error('ëŒ€ì•ˆ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }

            if (savedComparisons) {
                try {
                    comparisonResults = JSON.parse(savedComparisons);
                } catch (e) {
                    console.error('ë¹„êµ ê²°ê³¼ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }

            // ë°ëª¨ ë°ì´í„° ì„¤ì •
            if (currentCriteria.length === 0) {
                currentCriteria = [
                    { id: 'demo-1', name: 'í’ˆì§ˆ', weight: 0.35 },
                    { id: 'demo-2', name: 'ë¹„ìš©', weight: 0.25 },
                    { id: 'demo-3', name: 'ì‹ ë¢°ì„±', weight: 0.20 },
                    { id: 'demo-4', name: 'ì‚¬ìš©ì„±', weight: 0.20 }
                ];
            }

            if (currentAlternatives.length === 0) {
                currentAlternatives = [
                    { id: 'demo-alt-1', name: 'ëŒ€ì•ˆ A', description: 'ì²« ë²ˆì§¸ ì„ íƒ ê°€ëŠ¥í•œ ëŒ€ì•ˆ' },
                    { id: 'demo-alt-2', name: 'ëŒ€ì•ˆ B', description: 'ë‘ ë²ˆì§¸ ëŒ€ì•ˆ' },
                    { id: 'demo-alt-3', name: 'ëŒ€ì•ˆ C', description: 'ì„¸ ë²ˆì§¸ ëŒ€ì•ˆ' },
                    { id: 'demo-alt-4', name: 'ëŒ€ì•ˆ D', description: 'ë„¤ ë²ˆì§¸ ëŒ€ì•ˆ' }
                ];
            }
        }

        // ê²°ê³¼ ê³„ì‚°
        function calculateResults() {
            setTimeout(() => {
                // ë°ëª¨ìš© ê²°ê³¼ ê³„ì‚°
                finalResults = currentAlternatives.map(alt => ({
                    ...alt,
                    totalScore: Math.random() * 0.4 + 0.15, // 0.15-0.55 ë²”ìœ„
                    criteriaScores: currentCriteria.reduce((scores, criteria) => {
                        scores[criteria.id] = Math.random() * 0.8 + 0.1; // 0.1-0.9 ë²”ìœ„
                        return scores;
                    }, {})
                }));

                // ì ìˆ˜ë¡œ ì •ë ¬
                finalResults.sort((a, b) => b.totalScore - a.totalScore);

                // ê²°ê³¼ í‘œì‹œ
                displayResults();
                displayCriteriaWeights();
                displayDetailedScores();
                
                document.getElementById('ranking-loading').style.display = 'none';
                document.getElementById('ranking-table').style.display = 'table';
            }, 2000);
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults() {
            const winner = finalResults[0];
            document.getElementById('winner-name').textContent = winner.name;
            document.getElementById('winner-score').textContent = (winner.totalScore * 100).toFixed(1) + '%';

            const tbody = document.getElementById('ranking-tbody');
            tbody.innerHTML = finalResults.map((result, index) => {
                const rank = index + 1;
                const percentage = (result.totalScore * 100).toFixed(1);
                const relativeScore = ((result.totalScore / finalResults[0].totalScore) * 100).toFixed(0);
                
                let rankClass = 'rank-other';
                if (rank === 1) rankClass = 'rank-1';
                else if (rank === 2) rankClass = 'rank-2';
                else if (rank === 3) rankClass = 'rank-3';

                return `
                    <tr>
                        <td>
                            <div class="rank-badge ${rankClass}">${rank}</div>
                        </td>
                        <td>
                            <div style="font-weight: 600;">${result.name}</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">${result.description || 'ì„¤ëª… ì—†ìŒ'}</div>
                        </td>
                        <td style="font-weight: 600; color: var(--accent-primary);">${percentage}%</td>
                        <td style="color: var(--text-secondary);">${relativeScore}%</td>
                        <td>
                            <div class="weight-bar">
                                <div class="weight-fill" style="width: ${relativeScore}%;"></div>
                                <div class="weight-text">${percentage}%</div>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ê¸°ì¤€ë³„ ê°€ì¤‘ì¹˜ í‘œì‹œ
        function displayCriteriaWeights() {
            const container = document.getElementById('criteria-weights');
            container.innerHTML = currentCriteria.map(criteria => `
                <div class="criteria-card">
                    <div class="criteria-name">${criteria.name}</div>
                    <div class="criteria-weight">${(criteria.weight * 100).toFixed(1)}%</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        ${criteria.description || 'í‰ê°€ ê¸°ì¤€'}
                    </div>
                </div>
            `).join('');
        }

        // ì„¸ë¶€ ì ìˆ˜í‘œ í‘œì‹œ
        function displayDetailedScores() {
            const table = document.getElementById('detailed-scores-table');
            
            // í—¤ë” ìƒì„±
            let headerHTML = '<thead><tr><th>ëŒ€ì•ˆ</th>';
            currentCriteria.forEach(criteria => {
                headerHTML += `<th>${criteria.name}<br><small>(${(criteria.weight * 100).toFixed(0)}%)</small></th>`;
            });
            headerHTML += '<th>ì¢…í•©ì ìˆ˜</th></tr></thead>';

            // ë°”ë”” ìƒì„±
            let bodyHTML = '<tbody>';
            finalResults.forEach(result => {
                bodyHTML += `<tr><td style="font-weight: 600;">${result.name}</td>`;
                currentCriteria.forEach(criteria => {
                    const score = result.criteriaScores[criteria.id];
                    bodyHTML += `<td>${(score * 100).toFixed(1)}%</td>`;
                });
                bodyHTML += `<td style="font-weight: 600; color: var(--accent-primary);">${(result.totalScore * 100).toFixed(1)}%</td></tr>`;
            });
            bodyHTML += '</tbody>';

            table.innerHTML = headerHTML + bodyHTML;
        }

        // ë‚´ë³´ë‚´ê¸° í•¨ìˆ˜ë“¤
        function exportToPDF() {
            alert('PDF ë³´ê³ ì„œ ìƒì„± ê¸°ëŠ¥ì´ ê³§ êµ¬í˜„ë©ë‹ˆë‹¤.\n\ní¬í•¨ë  ë‚´ìš©:\nâ€¢ í”„ë¡œì íŠ¸ ìš”ì•½\nâ€¢ ìµœì¢… ìˆœìœ„ ê²°ê³¼\nâ€¢ ê¸°ì¤€ë³„ ë¶„ì„\nâ€¢ ì¼ê´€ì„± ê²€ì¦ ê²°ê³¼');
        }

        function exportToExcel() {
            alert('Excel íŒŒì¼ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì´ ê³§ êµ¬í˜„ë©ë‹ˆë‹¤.\n\ní¬í•¨ë  ë‚´ìš©:\nâ€¢ ìˆœìœ„í‘œ\nâ€¢ ì„¸ë¶€ ì ìˆ˜í‘œ\nâ€¢ ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤\nâ€¢ ê¸°ì¤€ ê°€ì¤‘ì¹˜');
        }

        function copyResults() {
            const winner = finalResults[0];
            const results = `AHP ë¶„ì„ ê²°ê³¼ ìš”ì•½

í”„ë¡œì íŠ¸: ${currentProject.title}
ë¶„ì„ ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}

=== ìµœì¢… ìˆœìœ„ ===
${finalResults.map((result, index) => 
    `${index + 1}ìœ„. ${result.name} (${(result.totalScore * 100).toFixed(1)}%)`
).join('\n')}

=== ê¸°ì¤€ë³„ ê°€ì¤‘ì¹˜ ===
${currentCriteria.map(criteria => 
    `${criteria.name}: ${(criteria.weight * 100).toFixed(1)}%`
).join('\n')}

ìµœì  ì„ íƒ: ${winner.name}
`;

            navigator.clipboard.writeText(results).then(() => {
                alert('âœ… ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(() => {
                alert('âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

        async function saveToDatabase() {
            try {
                const resultData = {
                    project_id: currentProject.id,
                    results: finalResults,
                    criteria_weights: currentCriteria,
                    analysis_date: new Date().toISOString()
                };

                // ì‹¤ì œ API í˜¸ì¶œ ëŒ€ì‹  ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                const savedResults = JSON.parse(localStorage.getItem('ahp_saved_results') || '[]');
                savedResults.push(resultData);
                localStorage.setItem('ahp_saved_results', JSON.stringify(savedResults));

                alert('âœ… ê²°ê³¼ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì €ì¥ëœ ê²°ê³¼ëŠ” ë‚˜ì¤‘ì— ëŒ€ì‹œë³´ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ê²°ê³¼ ì €ì¥ ì˜¤ë¥˜:', error);
                alert('âŒ ê²°ê³¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¶”ê°€ ì‘ì—… í•¨ìˆ˜ë“¤
        function startNewProject() {
            if (confirm('ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní˜„ì¬ ì„¸ì…˜ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.')) {
                // ì„¸ì…˜ ë°ì´í„° ì •ë¦¬
                sessionStorage.clear();
                window.location.href = '/ahp_app/project-management.html';
            }
        }

        function modifyCurrentProject() {
            alert('í”„ë¡œì íŠ¸ ìˆ˜ì • ê¸°ëŠ¥ì´ ê³§ êµ¬í˜„ë©ë‹ˆë‹¤.\n\nê°€ëŠ¥í•œ ìˆ˜ì •ì‚¬í•­:\nâ€¢ ê¸°ì¤€ ì¶”ê°€/ì‚­ì œ/ìˆ˜ì •\nâ€¢ ëŒ€ì•ˆ ì¶”ê°€/ì‚­ì œ/ìˆ˜ì •\nâ€¢ ìŒëŒ€ë¹„êµ ì¬ìˆ˜í–‰');
        }

        // ê°œë°œìš©: Ctrl+Rë¡œ ê²°ê³¼ ì¬ê³„ì‚°
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                document.getElementById('ranking-loading').style.display = 'block';
                document.getElementById('ranking-table').style.display = 'none';
                calculateResults();
            }
        });
    </script>
</body>
</html>